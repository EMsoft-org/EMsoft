<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="EMsoft main library">
    
    <meta name="author" content="Marc De Graef Research Group/Carnegie Mellon University" >
    <link rel="icon" href="../favicon.png">

    <title>so3.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>so3.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 2.6% of total for source files.">790 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/so3.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">so3.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/so3.html">so3</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/so3.f90.html#src">so3.f90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~so3.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileso3f90EfferentGraph" width="173pt" height="32pt"
 viewBox="0.00 0.00 173.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~so3.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~so3.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 169,-28 169,4 -4,4"/>
<!-- sourcefile~so3.f90 -->
<g id="sourcefile~~so3.f90~~EfferentGraph_node1" class="node"><title>sourcefile~so3.f90</title>
<polygon fill="none" stroke="black" points="165,-24 111,-24 111,-0 165,-0 165,-24"/>
<text text-anchor="middle" x="138" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">so3.f90</text>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~so3.f90~~EfferentGraph_node2" class="node"><title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~so3.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="75,-24 0,-24 0,-0 75,-0 75,-24"/>
<text text-anchor="middle" x="37.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~so3.f90 -->
<g id="sourcefile~~so3.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~so3.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M75.1778,-12C83.4849,-12 92.3035,-12 100.599,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.749,-15.5001 110.749,-12 100.749,-8.5001 100.749,-15.5001"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~so3.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileso3f90AfferentGraph" width="287pt" height="32pt"
 viewBox="0.00 0.00 287.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~so3.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~so3.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 283,-28 283,4 -4,4"/>
<!-- sourcefile~so3.f90 -->
<g id="sourcefile~~so3.f90~~AfferentGraph_node1" class="node"><title>sourcefile~so3.f90</title>
<polygon fill="none" stroke="black" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">so3.f90</text>
</g>
<!-- sourcefile~dictmod.f90 -->
<g id="sourcefile~~so3.f90~~AfferentGraph_node2" class="node"><title>sourcefile~dictmod.f90</title>
<g id="a_sourcefile~~so3.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/dictmod.f90.html" xlink:title="dictmod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="157,-24 90,-24 90,-0 157,-0 157,-24"/>
<text text-anchor="middle" x="123.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dictmod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~so3.f90&#45;&gt;sourcefile~dictmod.f90 -->
<g id="sourcefile~~so3.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~so3.f90&#45;&gt;sourcefile~dictmod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M54.0727,-12C62.0045,-12 70.9403,-12 79.6727,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="79.7582,-15.5001 89.7582,-12 79.7582,-8.5001 79.7582,-15.5001"/>
</g>
<!-- sourcefile~pfinversion.f90 -->
<g id="sourcefile~~so3.f90~~AfferentGraph_node3" class="node"><title>sourcefile~pfinversion.f90</title>
<g id="a_sourcefile~~so3.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/pfinversion.f90.html" xlink:title="PFInversion.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="279,-24 193,-24 193,-0 279,-0 279,-24"/>
<text text-anchor="middle" x="236" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">PFInversion.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dictmod.f90&#45;&gt;sourcefile~pfinversion.f90 -->
<g id="sourcefile~~so3.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~dictmod.f90&#45;&gt;sourcefile~pfinversion.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M157.056,-12C165.109,-12 173.941,-12 182.675,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="182.831,-15.5001 192.831,-12 182.831,-8.5001 182.831,-15.5001"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/so3.html">so3</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/so3.f90.html#src">so3.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! ###################################################################</span>
<a name="ln-2"></a><span class="c">! Copyright (c) 2013-2014, Marc De Graef/Carnegie Mellon University</span>
<a name="ln-3"></a><span class="c">! All rights reserved.</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">! Redistribution and use in source and binary forms, with or without modification, are </span>
<a name="ln-6"></a><span class="c">! permitted provided that the following conditions are met:</span>
<a name="ln-7"></a><span class="c">!</span>
<a name="ln-8"></a><span class="c">!     - Redistributions of source code must retain the above copyright notice, this list </span>
<a name="ln-9"></a><span class="c">!        of conditions and the following disclaimer.</span>
<a name="ln-10"></a><span class="c">!     - Redistributions in binary form must reproduce the above copyright notice, this </span>
<a name="ln-11"></a><span class="c">!        list of conditions and the following disclaimer in the documentation and/or </span>
<a name="ln-12"></a><span class="c">!        other materials provided with the distribution.</span>
<a name="ln-13"></a><span class="c">!     - Neither the names of Marc De Graef, Carnegie Mellon University nor the names </span>
<a name="ln-14"></a><span class="c">!        of its contributors may be used to endorse or promote products derived from </span>
<a name="ln-15"></a><span class="c">!        this software without specific prior written permission.</span>
<a name="ln-16"></a><span class="c">!</span>
<a name="ln-17"></a><span class="c">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; </span>
<a name="ln-18"></a><span class="c">! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE </span>
<a name="ln-19"></a><span class="c">! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE </span>
<a name="ln-20"></a><span class="c">! ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE </span>
<a name="ln-21"></a><span class="c">! LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL </span>
<a name="ln-22"></a><span class="c">! DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR </span>
<a name="ln-23"></a><span class="c">! SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER </span>
<a name="ln-24"></a><span class="c">! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, </span>
<a name="ln-25"></a><span class="c">! OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE </span>
<a name="ln-26"></a><span class="c">! USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="ln-27"></a><span class="c">! ###################################################################</span>
<a name="ln-28"></a>
<a name="ln-29"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-30"></a><span class="c">! EMsoft:so3.f90</span>
<a name="ln-31"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-32"></a><span class="c">!</span>
<a name="ln-33"></a><span class="c">! MODULE: so3</span>
<a name="ln-34"></a><span class="c">!</span>
<a name="ln-35"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-36"></a><span class="c">!</span>
<a name="ln-37"></a><span class="c">!&gt; @brief everything that has to do with sampling of rotation space SO(3)</span>
<a name="ln-38"></a><span class="c">!</span>
<a name="ln-39"></a><span class="c">!&gt; @todo verify that this is correct for point groups with multiple settings, eg, 3m, 32, ...</span>
<a name="ln-40"></a><span class="c">!</span>
<a name="ln-41"></a><span class="c">!&gt; @date 05/29/14 MDG 1.0 original</span>
<a name="ln-42"></a><span class="c">!&gt; @date 10/02/14 MDG 2.0 removed globals + rewrite</span>
<a name="ln-43"></a><span class="c">!&gt; @date 01/01/15 MDG 2.1 added IsinsideFZ function, also used in dictionary indexing approach</span>
<a name="ln-44"></a><span class="c">!&gt; @date 01/17/15 MDG 2.2 added gridtype option to SampleRFZ</span>
<a name="ln-45"></a><span class="c">!&gt; @date 03/03/16 MDG 2.3 added uniform sampling for constant misorientations</span>
<a name="ln-46"></a><span class="c">!&gt; @date 04/01/17 MDG 3.0 start to add FZs for two-phase systems (e.g., cubic-hexagonal, etc.)</span>
<a name="ln-47"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-48"></a><span class="k">module </span><span class="n">so3</span>
<a name="ln-49"></a>
<a name="ln-50"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-51"></a>
<a name="ln-52"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-53"></a>
<a name="ln-54"></a><span class="c">! sampler routine</span>
<a name="ln-55"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">SampleRFZ</span><span class="p">,</span> <span class="n">IsinsideFZ</span><span class="p">,</span> <span class="n">CubochoricNeighbors</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="c">! logical functions to determine if point is inside specific FZ</span>
<a name="ln-58"></a><span class="c">!private :: insideCyclicFZ, insideDihedralFZ, insideCubicFZ</span>
<a name="ln-59"></a><span class="k">public</span><span class="kd">::</span> <span class="n">insideCyclicFZ</span><span class="p">,</span> <span class="n">insideDihedralFZ</span><span class="p">,</span> <span class="n">insideCubicFZ</span>
<a name="ln-60"></a>
<a name="ln-61"></a>
<a name="ln-62"></a><span class="k">contains</span>
<a name="ln-63"></a>
<a name="ln-64"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-65"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-66"></a><span class="c">! Routine to return the FZtype and FZorder parameters for single or two-phase</span>
<a name="ln-67"></a><span class="c">! fundamental zone (FZ) computations; this includes all the FZ types from the </span>
<a name="ln-68"></a><span class="c">! following paper:</span>
<a name="ln-69"></a><span class="c">!</span>
<a name="ln-70"></a><span class="c">! &quot;Representation of Orientation and Disorientation data for Cubic, Hexagonal, </span>
<a name="ln-71"></a><span class="c">! Tetragonal, and Orthorhombic Crystals&quot;, A. Heinz and P. Neumann, Acta Cryst. A47, </span>
<a name="ln-72"></a><span class="c">! 780-789 (1991)</span>
<a name="ln-73"></a><span class="c">!</span>
<a name="ln-74"></a><span class="c">! this routine also allows for icosahedral symmetry, although this is not part </span>
<a name="ln-75"></a><span class="c">! of the paper above.</span>
<a name="ln-76"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-77"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-78"></a>
<a name="ln-79"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-80"></a><span class="c">!</span>
<a name="ln-81"></a><span class="c">! SUBROUTINE: getFZtypeandorder</span>
<a name="ln-82"></a><span class="c">!</span>
<a name="ln-83"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-84"></a><span class="c">!</span>
<a name="ln-85"></a><span class="c">!&gt; @brief does Rodrigues point lie inside the relevant FZ</span>
<a name="ln-86"></a><span class="c">!</span>
<a name="ln-87"></a><span class="c">!&gt; @param pgnum1 point group number for phase 1</span>
<a name="ln-88"></a><span class="c">!&gt; @param FZtype FZ type</span>
<a name="ln-89"></a><span class="c">!&gt; @param FZorder FZ order</span>
<a name="ln-90"></a><span class="c">!&gt; @param pgnum2 point group number for phase 2 (optional)</span>
<a name="ln-91"></a><span class="c">!</span>
<a name="ln-92"></a><span class="c">!&gt; @date 04/02/17 MDG 1.0 new routine, needed for two-phase disorientations</span>
<a name="ln-93"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-94"></a><span class="k">recursive subroutine </span><span class="n">getFZtypeandorder</span><span class="p">(</span><span class="n">pgnum1</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">,</span><span class="n">pgnum2</span><span class="p">)</span> 
<a name="ln-95"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: getFZtypeandorder</span>
<a name="ln-96"></a>
<a name="ln-97"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-98"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-99"></a>
<a name="ln-100"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-101"></a>
<a name="ln-102"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">pgnum1</span>
<a name="ln-103"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">FZtype</span>
<a name="ln-104"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">FZorder</span>
<a name="ln-105"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">),</span><span class="k">OPTIONAL</span>     <span class="kd">::</span> <span class="n">pgnum2</span>
<a name="ln-106"></a>
<a name="ln-107"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">thisFZType</span>
<a name="ln-108"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">twophase</span>
<a name="ln-109"></a>
<a name="ln-110"></a><span class="c">! 0 -&gt; x  (no symmetry or unbounded FZ for the cyclic symmetries)</span>
<a name="ln-111"></a><span class="c">! 1 -&gt; a  mixed cubic-hexagonal FZ  -&gt; FZtype = 6</span>
<a name="ln-112"></a><span class="c">! 2 -&gt; b  mixed FZ -&gt; FZtype = 7</span>
<a name="ln-113"></a><span class="c">! 3 -&gt; c  octahedral FZ</span>
<a name="ln-114"></a><span class="c">! 4 -&gt; d  tetrahedral FZ</span>
<a name="ln-115"></a><span class="c">! 5 -&gt; e  24-sided prismatic FZ -&gt; FZtype = 8</span>
<a name="ln-116"></a><span class="c">! 6 -&gt; f  622 hexagonal dihedral FZ</span>
<a name="ln-117"></a><span class="c">! 7 -&gt; g  422 octagonal dihedral FZ</span>
<a name="ln-118"></a><span class="c">! 8 -&gt; h  32 trigonal dihedral FZ</span>
<a name="ln-119"></a><span class="c">! 9 -&gt; i  222 dihedral FZ</span>
<a name="ln-120"></a>
<a name="ln-121"></a><span class="c">! we reserve FZtype = 5 for icosahedral symmetry, which is under development on a separate code branch</span>
<a name="ln-122"></a>
<a name="ln-123"></a><span class="n">twophase</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-124"></a><span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">pgnum2</span><span class="p">))</span> <span class="n">twophase</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-125"></a>
<a name="ln-126"></a><span class="k">if</span> <span class="p">(</span><span class="n">twophase</span><span class="p">.</span><span class="n">eqv</span><span class="p">..</span><span class="n">TRUE</span><span class="p">.)</span> <span class="k">then</span>
<a name="ln-127"></a><span class="k">  </span><span class="n">thisFZtype</span> <span class="o">=</span> <span class="n">FZtypeTable</span><span class="p">(</span><span class="n">pgnum1</span><span class="p">,</span><span class="n">pgnum2</span><span class="p">)</span>
<a name="ln-128"></a>
<a name="ln-129"></a>  <span class="k">select case</span><span class="p">(</span><span class="n">thisFZtype</span><span class="p">)</span>
<a name="ln-130"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-131"></a>      <span class="c">! this needs some more work since we need to properly handle the cyclic groups of FZtype = 1 ...</span>
<a name="ln-132"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-133"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-134"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-135"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-136"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-137"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-138"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">7</span>
<a name="ln-139"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-140"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-141"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-142"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-143"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-144"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-145"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-146"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-147"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">8</span>
<a name="ln-148"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-149"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-150"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-151"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-152"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-153"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-154"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">4</span>
<a name="ln-155"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-156"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-157"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-158"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<a name="ln-159"></a>      <span class="n">FZtype</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-160"></a>      <span class="n">FZorder</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-161"></a>  <span class="k">end select</span>
<a name="ln-162"></a><span class="k">else</span>  <span class="c">! single phase so use the old way of doing things...</span>
<a name="ln-163"></a>  <span class="n">FZtype</span> <span class="o">=</span> <span class="n">FZtarray</span><span class="p">(</span><span class="n">pgnum1</span><span class="p">)</span>
<a name="ln-164"></a>  <span class="n">FZorder</span> <span class="o">=</span> <span class="n">FZoarray</span><span class="p">(</span><span class="n">pgnum1</span><span class="p">)</span>
<a name="ln-165"></a><span class="k">end if</span>
<a name="ln-166"></a>
<a name="ln-167"></a><span class="k">end subroutine </span><span class="n">getFZtypeandorder</span>
<a name="ln-168"></a>
<a name="ln-169"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-170"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-171"></a><span class="c">! We define a number of logical routines, that decide whether or not </span>
<a name="ln-172"></a><span class="c">! a point in Rodrigues representation lies inside the fundamental zone (FZ)</span>
<a name="ln-173"></a><span class="c">! for a given crystal symmetry. This follows the Morawiec@Field paper:</span>
<a name="ln-174"></a><span class="c">!</span>
<a name="ln-175"></a><span class="c">! A. Morawiec &amp; D. P. Field (1996) Rodrigues parameterization for orientation </span>
<a name="ln-176"></a><span class="c">! and misorientation distributions, Philosophical Magazine A, 73:4, 1113-1130, </span>
<a name="ln-177"></a><span class="c">! DOI: 10.1080/01418619608243708</span>
<a name="ln-178"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-179"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-180"></a>
<a name="ln-181"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-182"></a><span class="c">!</span>
<a name="ln-183"></a><span class="c">! FUNCTION: IsinsideFZ</span>
<a name="ln-184"></a><span class="c">!</span>
<a name="ln-185"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-186"></a><span class="c">!</span>
<a name="ln-187"></a><span class="c">!&gt; @brief does Rodrigues point lie inside the relevant FZ</span>
<a name="ln-188"></a><span class="c">!</span>
<a name="ln-189"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-190"></a><span class="c">!&gt; @param FZtype FZ type</span>
<a name="ln-191"></a><span class="c">!&gt; @param FZorder FZ order</span>
<a name="ln-192"></a><span class="c">!</span>
<a name="ln-193"></a><span class="c">!&gt; @date 01/01/15 MDG 1.0 new routine, needed for dictionary indexing approach</span>
<a name="ln-194"></a><span class="c">!&gt; @date 06/04/15 MDG 1.1 corrected infty to inftyd (double precision infinity)</span>
<a name="ln-195"></a><span class="c">!&gt; @date 04/02/17 MDG 1.2 expanded FZ types to include misorientation FZs and icosahedral</span>
<a name="ln-196"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-197"></a><span class="k">recursive function </span><span class="n">IsinsideFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">insideFZ</span><span class="p">)</span>
<a name="ln-198"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: IsinsideFZ</span>
<a name="ln-199"></a>
<a name="ln-200"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-201"></a>
<a name="ln-202"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-203"></a>
<a name="ln-204"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-205"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">FZtype</span>
<a name="ln-206"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">FZorder</span>
<a name="ln-207"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">insideFZ</span>
<a name="ln-208"></a>
<a name="ln-209"></a><span class="n">insideFZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-210"></a>
<a name="ln-211"></a><span class="c">! dealing with 180 rotations is needed only for </span>
<a name="ln-212"></a><span class="c">! FZtypes 0 and 1; the other FZs are always finite.</span>
<a name="ln-213"></a>  <span class="k">select case</span> <span class="p">(</span><span class="n">FZtype</span><span class="p">)</span>
<a name="ln-214"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-215"></a>      <span class="n">insideFZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>   <span class="c">! all points are inside the FZ</span>
<a name="ln-216"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-217"></a>      <span class="n">insideFZ</span> <span class="o">=</span> <span class="n">insideCyclicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)</span>        <span class="c">! infinity is checked inside this function</span>
<a name="ln-218"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-219"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideFZ</span> <span class="o">=</span> <span class="n">insideDihedralFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)</span>
<a name="ln-220"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-221"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideFZ</span> <span class="o">=</span> <span class="n">insideCubicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="s1">&#39;tet&#39;</span><span class="p">)</span>
<a name="ln-222"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-223"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideFZ</span> <span class="o">=</span> <span class="n">insideCubicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="s1">&#39;oct&#39;</span><span class="p">)</span>
<a name="ln-224"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c">! icosahedral symmetry</span>
<a name="ln-225"></a><span class="c">!     if (rod(4).ne.inftyd) insideFZ = insideCubicFZ(rod,&#39;oct&#39;)</span>
<a name="ln-226"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c">! cubic-hexagonal misorientation FZ</span>
<a name="ln-227"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideFZ</span> <span class="o">=</span> <span class="n">insideCubeHexFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span>
<a name="ln-228"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-229"></a><span class="c">!     if (rod(4).ne.inftyd) insideFZ = insideCubicFZ(rod,&#39;oct&#39;)</span>
<a name="ln-230"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<a name="ln-231"></a><span class="c">!     if (rod(4).ne.inftyd) insideFZ = insideCubicFZ(rod,&#39;oct&#39;)</span>
<a name="ln-232"></a>  <span class="k">end select</span>
<a name="ln-233"></a>
<a name="ln-234"></a><span class="k">end function </span><span class="n">IsinsideFZ</span>
<a name="ln-235"></a>
<a name="ln-236"></a>
<a name="ln-237"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-238"></a><span class="c">!</span>
<a name="ln-239"></a><span class="c">! FUNCTION: insideCyclicFZ</span>
<a name="ln-240"></a><span class="c">!</span>
<a name="ln-241"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-242"></a><span class="c">!</span>
<a name="ln-243"></a><span class="c">!&gt; @brief does Rodrigues point lie inside cyclic FZ (for 2, 3, 4, and 6-fold)?</span>
<a name="ln-244"></a><span class="c">!</span>
<a name="ln-245"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-246"></a><span class="c">!&gt; @param FZtype symmetry type</span>
<a name="ln-247"></a><span class="c">!&gt; @param FZorder depending on main symmetry axis</span>
<a name="ln-248"></a><span class="c">!</span>
<a name="ln-249"></a><span class="c">!&gt; @date 05/12/14 MDG 1.0 original</span>
<a name="ln-250"></a><span class="c">!&gt; @date 10/02/14 MDG 2.0 rewrite</span>
<a name="ln-251"></a><span class="c">!&gt; @date 06/04/15 MDG 2.1 corrected infty to inftyd (double precision infinity)</span>
<a name="ln-252"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-253"></a><span class="k">recursive function </span><span class="n">insideCyclicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-254"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideCyclicFZ</span>
<a name="ln-255"></a>
<a name="ln-256"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-257"></a>
<a name="ln-258"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-259"></a>
<a name="ln-260"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-261"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">FZtype</span>
<a name="ln-262"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">FZorder</span>
<a name="ln-263"></a>
<a name="ln-264"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span>
<a name="ln-265"></a>
<a name="ln-266"></a><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-267"></a>
<a name="ln-268"></a><span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-269"></a><span class="k">  if</span> <span class="p">((</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-270"></a><span class="c">! check the y-component vs. tan(pi/2n)</span>
<a name="ln-271"></a>    <span class="n">res</span> <span class="o">=</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">LPs</span><span class="p">%</span><span class="n">BP</span><span class="p">(</span><span class="n">FZorder</span><span class="p">)</span>
<a name="ln-272"></a>  <span class="k">else</span>
<a name="ln-273"></a><span class="c">! check the z-component vs. tan(pi/2n)</span>
<a name="ln-274"></a>    <span class="n">res</span> <span class="o">=</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">LPs</span><span class="p">%</span><span class="n">BP</span><span class="p">(</span><span class="n">FZorder</span><span class="p">)</span>
<a name="ln-275"></a>  <span class="k">end if</span>
<a name="ln-276"></a><span class="k">else</span>
<a name="ln-277"></a><span class="k">  if</span> <span class="p">((</span><span class="n">FZtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">FZorder</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-278"></a><span class="k">    if</span><span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mf">0.D0</span><span class="p">)</span> <span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-279"></a>  <span class="k">else</span>
<a name="ln-280"></a><span class="k">    if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span> <span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-281"></a>  <span class="k">end if</span>
<a name="ln-282"></a><span class="n">endif</span>
<a name="ln-283"></a>
<a name="ln-284"></a><span class="k">end function </span><span class="n">insideCyclicFZ</span>
<a name="ln-285"></a>
<a name="ln-286"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-287"></a><span class="c">!</span>
<a name="ln-288"></a><span class="c">! FUNCTION: insideDihedralFZ</span>
<a name="ln-289"></a><span class="c">!</span>
<a name="ln-290"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-291"></a><span class="c">!</span>
<a name="ln-292"></a><span class="c">!&gt; @brief does Rodrigues point lie inside dihedral FZ (for 2, 3, 4, and 6-fold)?</span>
<a name="ln-293"></a><span class="c">!</span>
<a name="ln-294"></a><span class="c">!&gt; @param rod Rodrigues coordinates (double precision)</span>
<a name="ln-295"></a><span class="c">!&gt; @param order depending on main symmetry axis</span>
<a name="ln-296"></a><span class="c">!</span>
<a name="ln-297"></a><span class="c">!&gt; @todo for now, we ignore here the fact that, among others, the 3m point group can be oriented in two ways;</span>
<a name="ln-298"></a><span class="c">!&gt; @todo this should be fixable in the future with an additional optional argument</span>
<a name="ln-299"></a><span class="c">!</span>
<a name="ln-300"></a><span class="c">!&gt; @date 05/12/14  MDG 1.0 original</span>
<a name="ln-301"></a><span class="c">!&gt; @date 10/02/14  MDG 2.0 rewrite</span>
<a name="ln-302"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-303"></a><span class="k">recursive function </span><span class="n">insideDihedralFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">order</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-304"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideDihedralFZ</span>
<a name="ln-305"></a>
<a name="ln-306"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-307"></a>
<a name="ln-308"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-309"></a>
<a name="ln-310"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-311"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">order</span>
<a name="ln-312"></a>
<a name="ln-313"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<a name="ln-314"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-315"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">r1</span> <span class="o">=</span> <span class="mf">1.00D0</span>
<a name="ln-316"></a>
<a name="ln-317"></a><span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">1.5</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-318"></a><span class="k">  </span><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-319"></a><span class="k">else</span>
<a name="ln-320"></a><span class="k">  </span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-321"></a>
<a name="ln-322"></a>  <span class="c">! first, check the z-component vs. tan(pi/2n)  (same as insideCyclicFZ)</span>
<a name="ln-323"></a>  <span class="n">c1</span> <span class="o">=</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">LPs</span><span class="p">%</span><span class="n">BP</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<a name="ln-324"></a>  <span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-325"></a>
<a name="ln-326"></a>  <span class="c">! check the square boundary planes if c1=.TRUE.</span>
<a name="ln-327"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-328"></a><span class="k">    select case</span> <span class="p">(</span><span class="n">order</span><span class="p">)</span>
<a name="ln-329"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-330"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">)</span>
<a name="ln-331"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-332"></a>        <span class="n">c2</span> <span class="o">=</span>          <span class="nb">dabs</span><span class="p">(</span> <span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span>
<a name="ln-333"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span> <span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-334"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-335"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-336"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">)</span>
<a name="ln-337"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.((</span><span class="n">LPs</span><span class="p">%</span><span class="n">r22</span><span class="o">*</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">LPs</span><span class="p">%</span><span class="n">r22</span><span class="o">*</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span><span class="p">))</span>
<a name="ln-338"></a>      <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-339"></a>        <span class="n">c2</span> <span class="o">=</span>          <span class="nb">dabs</span><span class="p">(</span> <span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span>
<a name="ln-340"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span> <span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-341"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span> <span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-342"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span> <span class="mf">0.5D0</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">LPs</span><span class="p">%</span><span class="n">srt</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-343"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-344"></a>        <span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span> <span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="n">r1</span> <span class="p">)</span>
<a name="ln-345"></a>    <span class="k">end select</span>
<a name="ln-346"></a><span class="k">    </span><span class="n">res</span> <span class="o">=</span> <span class="n">c2</span>
<a name="ln-347"></a>  <span class="k">end if</span>
<a name="ln-348"></a><span class="k">end if</span>
<a name="ln-349"></a>
<a name="ln-350"></a><span class="k">end function </span><span class="n">insideDihedralFZ</span>
<a name="ln-351"></a>
<a name="ln-352"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-353"></a><span class="c">!</span>
<a name="ln-354"></a><span class="c">! FUNCTION: insideCubicFZ</span>
<a name="ln-355"></a><span class="c">!</span>
<a name="ln-356"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-357"></a><span class="c">!</span>
<a name="ln-358"></a><span class="c">!&gt; @brief does Rodrigues point lie inside cubic FZ (octahedral or tetrahedral)?</span>
<a name="ln-359"></a><span class="c">!</span>
<a name="ln-360"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-361"></a><span class="c">!&gt; @param ot &#39;oct&#39; or &#39;tet&#39;, depending on symmetry</span>
<a name="ln-362"></a><span class="c">!</span>
<a name="ln-363"></a><span class="c">!&gt; @date 05/12/14 MDG 1.0 original</span>
<a name="ln-364"></a><span class="c">!&gt; @date 10/02/14 MDG 2.0 rewrite</span>
<a name="ln-365"></a><span class="c">!&gt; @date 01/03/15 MDG 2.1 correction of boundary error; simplification of octahedral planes</span>
<a name="ln-366"></a><span class="c">!&gt; @date 06/04/15 MDG 2.2 simplified handling of components of r</span>
<a name="ln-367"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-368"></a><span class="k">recursive function </span><span class="n">insideCubicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">ot</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-369"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideCubicFZ</span>
<a name="ln-370"></a>
<a name="ln-371"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-372"></a>
<a name="ln-373"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-374"></a>
<a name="ln-375"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-376"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-377"></a>
<a name="ln-378"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<a name="ln-379"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-380"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">r1</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-381"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0D-6</span>
<a name="ln-382"></a>
<a name="ln-383"></a><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-384"></a>
<a name="ln-385"></a><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-386"></a>
<a name="ln-387"></a><span class="c">! primary cube planes (only needed for octahedral case)</span>
<a name="ln-388"></a><span class="k">if</span> <span class="p">(</span><span class="n">ot</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;oct&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-389"></a><span class="k">  </span><span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">-</span> <span class="n">LPS</span><span class="p">%</span><span class="n">BP</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span> 
<a name="ln-390"></a><span class="k">else </span>
<a name="ln-391"></a><span class="k">  </span><span class="n">c1</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-392"></a><span class="k">end if</span>
<a name="ln-393"></a>
<a name="ln-394"></a><span class="c">! octahedral truncation planes, both for tetrahedral and octahedral point groups</span>
<a name="ln-395"></a><span class="n">c2</span> <span class="o">=</span> <span class="p">((</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> <span class="o">-</span> <span class="n">r1</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span>
<a name="ln-396"></a>
<a name="ln-397"></a><span class="c">! if both c1 and c2, then the point is inside</span>
<a name="ln-398"></a><span class="k">if</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">c2</span><span class="p">)</span> <span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-399"></a>
<a name="ln-400"></a><span class="k">end function </span><span class="n">insideCubicFZ</span>
<a name="ln-401"></a>
<a name="ln-402"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-403"></a><span class="c">!</span>
<a name="ln-404"></a><span class="c">! FUNCTION: insideCubeHexFZ</span>
<a name="ln-405"></a><span class="c">!</span>
<a name="ln-406"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-407"></a><span class="c">!</span>
<a name="ln-408"></a><span class="c">!&gt; @brief does Rodrigues point lie inside combined cubic-hexagonal FZ?</span>
<a name="ln-409"></a><span class="c">!</span>
<a name="ln-410"></a><span class="c">!&gt; @note For details on this test, see section 8 in &quot;Representation of Orientation and</span>
<a name="ln-411"></a><span class="c">!&gt; Disorientation data for Cubic, Hexagonal, Tetragonal, and Orthorhombic Crystals&quot;, A. Heinz</span>
<a name="ln-412"></a><span class="c">!&gt; and P. Neumann, Acta Cryst. A47, 780-789 (1991)</span>
<a name="ln-413"></a><span class="c">!</span>
<a name="ln-414"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-415"></a><span class="c">!</span>
<a name="ln-416"></a><span class="c">!&gt; @date 04/01/17 MDG 1.0 original</span>
<a name="ln-417"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-418"></a><span class="k">recursive function </span><span class="n">insideCubeHexFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-419"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideCubeHexFZ</span>
<a name="ln-420"></a>
<a name="ln-421"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-422"></a>
<a name="ln-423"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-424"></a>
<a name="ln-425"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-426"></a>
<a name="ln-427"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span>
<a name="ln-428"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-429"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.414213562373095D0</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="mf">0.131652497587396D0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-430"></a>                                             <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.267949192431123D0</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.464101615137755D0</span>
<a name="ln-431"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0D-6</span>
<a name="ln-432"></a>
<a name="ln-433"></a>
<a name="ln-434"></a><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-435"></a>
<a name="ln-436"></a><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-437"></a>
<a name="ln-438"></a><span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span> <span class="p">)</span> <span class="k">then </span>
<a name="ln-439"></a><span class="k">  if</span> <span class="p">(</span> <span class="p">((</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">beta</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">beta</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span> <span class="p">)</span> <span class="k">then </span>
<a name="ln-440"></a><span class="k">    if</span> <span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">r2</span> <span class="p">.</span><span class="n">le</span><span class="p">.</span> <span class="n">eps</span><span class="p">)</span> <span class="p">)</span> <span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-441"></a>  <span class="k">end if</span>
<a name="ln-442"></a><span class="k">end if </span>
<a name="ln-443"></a>
<a name="ln-444"></a><span class="k">end function </span><span class="n">insideCubeHexFZ</span>
<a name="ln-445"></a>
<a name="ln-446"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-447"></a><span class="c">!</span>
<a name="ln-448"></a><span class="c">! FUNCTION: delete_FZlist</span>
<a name="ln-449"></a><span class="c">!</span>
<a name="ln-450"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-451"></a><span class="c">!</span>
<a name="ln-452"></a><span class="c">!&gt; @brief delete a linked list of rodrigues vectors</span>
<a name="ln-453"></a><span class="c">!</span>
<a name="ln-454"></a><span class="c">!&gt; @param FZlist linked list</span>
<a name="ln-455"></a><span class="c">!</span>
<a name="ln-456"></a><span class="c">!&gt; @date 02/20/16 MDG 1.0 original</span>
<a name="ln-457"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-458"></a><span class="k">recursive subroutine </span><span class="n">delete_FZlist</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
<a name="ln-459"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: delete_FZlist</span>
<a name="ln-460"></a>
<a name="ln-461"></a><span class="k">use </span><span class="n">typedefs</span> 
<a name="ln-462"></a>
<a name="ln-463"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">top</span>
<a name="ln-466"></a>
<a name="ln-467"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                <span class="kd">::</span> <span class="n">ltail</span><span class="p">,</span> <span class="n">ltmp</span>
<a name="ln-468"></a>
<a name="ln-469"></a><span class="c">! deallocate the entire linked list before returning, to prevent memory leaks</span>
<a name="ln-470"></a><span class="n">ltail</span> <span class="o">=&gt;</span> <span class="n">top</span>
<a name="ln-471"></a><span class="n">ltmp</span> <span class="o">=&gt;</span> <span class="n">ltail</span> <span class="p">%</span> <span class="n">next</span>
<a name="ln-472"></a><span class="k">do </span>
<a name="ln-473"></a><span class="k">  deallocate</span><span class="p">(</span><span class="n">ltail</span><span class="p">)</span>
<a name="ln-474"></a>  <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">ltmp</span><span class="p">))</span> <span class="k">EXIT</span>
<a name="ln-475"></a><span class="k">  </span><span class="n">ltail</span> <span class="o">=&gt;</span> <span class="n">ltmp</span>
<a name="ln-476"></a>  <span class="n">ltmp</span> <span class="o">=&gt;</span> <span class="n">ltail</span> <span class="p">%</span> <span class="n">next</span>
<a name="ln-477"></a><span class="k">end do</span>
<a name="ln-478"></a>
<a name="ln-479"></a><span class="k">end subroutine </span><span class="n">delete_FZlist</span>
<a name="ln-480"></a>
<a name="ln-481"></a>
<a name="ln-482"></a>
<a name="ln-483"></a>
<a name="ln-484"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-485"></a><span class="c">!</span>
<a name="ln-486"></a><span class="c">! FUNCTION: SampleRFZ</span>
<a name="ln-487"></a><span class="c">!</span>
<a name="ln-488"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-489"></a><span class="c">!</span>
<a name="ln-490"></a><span class="c">!&gt; @brief Generate a uniform sampling of a Rodriguess FZ</span>
<a name="ln-491"></a><span class="c">!</span>
<a name="ln-492"></a><span class="c">!&gt; @note This routine fills in a linked list FZlist of Rodrigues points that </span>
<a name="ln-493"></a><span class="c">!&gt; are inside a specific fundamental zone determined by the sample point group;</span>
<a name="ln-494"></a><span class="c">!&gt; this list can then be further dealt with in the calling program.  </span>
<a name="ln-495"></a><span class="c">!&gt;</span>
<a name="ln-496"></a><span class="c">!&gt; Here&#39;s how you would use this routine in a main program:</span>
<a name="ln-497"></a><span class="c">!&gt;</span>
<a name="ln-498"></a><span class="c">!&gt; use so3</span>
<a name="ln-499"></a><span class="c">!&gt;</span>
<a name="ln-500"></a><span class="c">!&gt; integer(kind=irg)       :: FZcnt, nsteps, pgnum</span>
<a name="ln-501"></a><span class="c">!&gt; type(FZpointd),pointer  :: FZlist, FZtmp</span>
<a name="ln-502"></a><span class="c">!&gt; </span>
<a name="ln-503"></a><span class="c">!&gt; nullify(FZlist)</span>
<a name="ln-504"></a><span class="c">!&gt; FZcnt = 0</span>
<a name="ln-505"></a><span class="c">!&gt; nsteps = 10</span>
<a name="ln-506"></a><span class="c">!&gt; pgnum = 32</span>
<a name="ln-507"></a><span class="c">!&gt; call sampleRFZ(nsteps, pgnum, FZcnt, FZlist)</span>
<a name="ln-508"></a><span class="c">!&gt; </span>
<a name="ln-509"></a><span class="c">!&gt; Then you can access all the entries in the list and, for instance, convert them to Euler angles...</span>
<a name="ln-510"></a><span class="c">!&gt;</span>
<a name="ln-511"></a><span class="c">!&gt; FZtmp =&gt; FZlist                        ! point to the top of the list</span>
<a name="ln-512"></a><span class="c">!&gt; do i = 1, FZcnt                        ! loop over all entries</span>
<a name="ln-513"></a><span class="c">!&gt;   eu = ro2eu(FZtmp%rod)                ! convert to Euler angles</span>
<a name="ln-514"></a><span class="c">!&gt;   do something with eu                 ! for instance, write eu to a file</span>
<a name="ln-515"></a><span class="c">!&gt;   FZtmp =&gt; FZtmp%next                  ! point to the next entry</span>
<a name="ln-516"></a><span class="c">!&gt; end do</span>
<a name="ln-517"></a><span class="c">!&gt;</span>
<a name="ln-518"></a><span class="c">!&gt; If you just want to look at the first 10 entries on the list and show all other orientation representations:</span>
<a name="ln-519"></a><span class="c">!&gt;</span>
<a name="ln-520"></a><span class="c">!&gt; type(orientationtyped):: ot</span>
<a name="ln-521"></a><span class="c">!&gt; </span>
<a name="ln-522"></a><span class="c">!&gt; FZtmp =&gt; FZlist</span>
<a name="ln-523"></a><span class="c">!&gt; do i = 1,10</span>
<a name="ln-524"></a><span class="c">!&gt;   ot = init_orientation(FZtmp%rod,&#39;ro&#39;)</span>
<a name="ln-525"></a><span class="c">!&gt;   call print_orientation(ot)</span>
<a name="ln-526"></a><span class="c">!&gt;   FZtmp =&gt; FZtmp%next</span>
<a name="ln-527"></a><span class="c">!&gt; end do</span>
<a name="ln-528"></a><span class="c">!</span>
<a name="ln-529"></a><span class="c">!&gt; @param nsteps number of steps along semi-edge in cubochoric grid</span>
<a name="ln-530"></a><span class="c">!&gt; @param pgnum point group number to determine the appropriate Rodrigues fundamental zone</span>
<a name="ln-531"></a><span class="c">!&gt; @param gridtype (input) 0 for origin-centered grid; 1 for grid with origin at box center</span>
<a name="ln-532"></a><span class="c">!&gt; @param FZcnt (output) number of points inside fundamental zone</span>
<a name="ln-533"></a><span class="c">!&gt; @param FZlist (output) linked list of points inside fundamental zone</span>
<a name="ln-534"></a><span class="c">!</span>
<a name="ln-535"></a><span class="c">!&gt; @date 05/12/14 MDG 1.0 original</span>
<a name="ln-536"></a><span class="c">!&gt; @date 10/02/14 MDG 2.0 rewrite, removed all globals, added function arguments</span>
<a name="ln-537"></a><span class="c">!&gt; @date 09/15/15 MDG 2.1 removed explicit origin allocation; changed while to do loops.</span>
<a name="ln-538"></a><span class="c">!&gt; @date 01/17/15 MDG 2.2 added gridtype option</span>
<a name="ln-539"></a><span class="c">!&gt; @date 05/22/16 MDG 2.3 correction for monoclinic symmetry with twofold axis along b, not c !!!</span>
<a name="ln-540"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-541"></a><span class="k">recursive subroutine </span><span class="n">SampleRFZ</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span><span class="n">pgnum</span><span class="p">,</span><span class="n">gridtype</span><span class="p">,</span><span class="n">FZcnt</span><span class="p">,</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-542"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: SampleRFZ</span>
<a name="ln-543"></a>
<a name="ln-544"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-545"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-546"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-547"></a>
<a name="ln-548"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-549"></a>
<a name="ln-550"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">nsteps</span>
<a name="ln-551"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">pgnum</span>
<a name="ln-552"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">gridtype</span>
<a name="ln-553"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">FZcnt</span>                <span class="c">! counts number of entries in linked list</span>
<a name="ln-554"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">FZlist</span>               <span class="c">! pointers</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">delta</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">sedge</span><span class="p">,</span> <span class="n">ztmp</span>
<a name="ln-557"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span> <span class="k">pointer</span>              <span class="kd">::</span> <span class="n">FZtmp</span><span class="p">,</span> <span class="n">FZtmp2</span>
<a name="ln-558"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">FZtype</span><span class="p">,</span> <span class="n">FZorder</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-559"></a><span class="kt">logical</span>                              <span class="kd">::</span> <span class="n">b</span>
<a name="ln-560"></a>
<a name="ln-561"></a><span class="c">! cube semi-edge length s = 0.5D0 * LPs%ap</span>
<a name="ln-562"></a><span class="c">! step size for sampling of grid; total number of samples = (2*nsteps+1)**3</span>
<a name="ln-563"></a><span class="n">sedge</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-564"></a><span class="n">delta</span> <span class="o">=</span> <span class="n">sedge</span> <span class="o">/</span> <span class="nb">dble</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
<a name="ln-565"></a><span class="k">if</span> <span class="p">(</span><span class="n">gridtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-566"></a><span class="k">  </span><span class="n">shift</span> <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-567"></a><span class="k">else</span>
<a name="ln-568"></a><span class="k">  </span><span class="n">shift</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-569"></a><span class="k">end if</span>
<a name="ln-570"></a>
<a name="ln-571"></a><span class="c">! set the counter to zero</span>
<a name="ln-572"></a><span class="n">FZcnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-573"></a>
<a name="ln-574"></a><span class="c">! make sure the linked lists are empty</span>
<a name="ln-575"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">FZlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-576"></a><span class="k">  </span><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-577"></a>  <span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-578"></a>  <span class="k">do</span>
<a name="ln-579"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">FZtmp2</span><span class="p">)</span>  
<a name="ln-580"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-581"></a><span class="k">    </span><span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span>
<a name="ln-582"></a>    <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-583"></a>  <span class="k">end do</span>
<a name="ln-584"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-585"></a><span class="k">else</span>
<a name="ln-586"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-587"></a><span class="k">end if</span>
<a name="ln-588"></a>
<a name="ln-589"></a><span class="c">! determine which function we should call for this point group symmetry</span>
<a name="ln-590"></a><span class="n">FZtype</span> <span class="o">=</span> <span class="n">FZtarray</span><span class="p">(</span><span class="n">pgnum</span><span class="p">)</span>
<a name="ln-591"></a><span class="n">FZorder</span> <span class="o">=</span> <span class="n">FZoarray</span><span class="p">(</span><span class="n">pgnum</span><span class="p">)</span>
<a name="ln-592"></a>
<a name="ln-593"></a><span class="c">! note that when FZtype is cyclic (1) and FZorder is 2, then we must rotate the </span>
<a name="ln-594"></a><span class="c">! rotation axis to lie along the b (y) direction, not z !!!!</span>
<a name="ln-595"></a>
<a name="ln-596"></a><span class="c">! loop over the cube of volume pi^2; note that we do not want to include</span>
<a name="ln-597"></a><span class="c">! the opposite edges/facets of the cube, to avoid double counting rotations</span>
<a name="ln-598"></a><span class="c">! with a rotation angle of 180 degrees.  This only affects the cyclic groups.</span>
<a name="ln-599"></a>
<a name="ln-600"></a> <span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nsteps</span>
<a name="ln-601"></a>  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span>
<a name="ln-602"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nsteps</span>
<a name="ln-603"></a>   <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span>
<a name="ln-604"></a>   <span class="k">do </span><span class="n">k</span><span class="o">=-</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nsteps</span>
<a name="ln-605"></a>    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">shift</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span>
<a name="ln-606"></a><span class="c">! make sure that this point lies inside the cubochoric cell</span>
<a name="ln-607"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">maxval</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span> <span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="n">sedge</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-608"></a>
<a name="ln-609"></a><span class="c">! convert to Rodrigues representation</span>
<a name="ln-610"></a>      <span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-611"></a>
<a name="ln-612"></a><span class="c">! If insideFZ=.TRUE., then add this point to the linked list FZlist and keep</span>
<a name="ln-613"></a><span class="c">! track of how many points there are on this list</span>
<a name="ln-614"></a>       <span class="n">b</span> <span class="o">=</span> <span class="n">IsinsideFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)</span>
<a name="ln-615"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-616"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">associated</span><span class="p">(</span><span class="n">FZlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-617"></a><span class="k">          allocate</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-618"></a>          <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-619"></a><span class="c">! in DEBUG mode, there is a strange error here ... </span>
<a name="ln-620"></a><span class="c">! if gridtype = 0 then we must add the identity rotation here</span>
<a name="ln-621"></a><span class="c">! currently, the identity is not automatically recognized since the </span>
<a name="ln-622"></a><span class="c">! returns from several rotation routines also equal the identity when</span>
<a name="ln-623"></a><span class="c">! the point is actually invalid... </span>
<a name="ln-624"></a><span class="c">!          if (gridtype.eq.0) then</span>
<a name="ln-625"></a><span class="c">!            FZcnt = 1</span>
<a name="ln-626"></a><span class="c">!            FZtmp%rod = (/ 0.D0, 0.D0, 1.D0, 0.D0 /)</span>
<a name="ln-627"></a><span class="c">!            allocate(FZtmp%next)</span>
<a name="ln-628"></a><span class="c">!            FZtmp =&gt; FZtmp%next</span>
<a name="ln-629"></a><span class="c">!            nullify(FZtmp%next)</span>
<a name="ln-630"></a><span class="c">!          end if </span>
<a name="ln-631"></a>        <span class="k">else</span>
<a name="ln-632"></a><span class="k">          allocate</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-633"></a>          <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-634"></a>        <span class="k">end if</span>
<a name="ln-635"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-636"></a><span class="c">! if monoclinic, then reorder the components !!!</span>
<a name="ln-637"></a><span class="c">!        if ((FZtype.eq.1).and.(FZorder.eq.2)) then</span>
<a name="ln-638"></a><span class="c">!          ztmp = rod(3)</span>
<a name="ln-639"></a><span class="c">!          rod(3) = rod(1)</span>
<a name="ln-640"></a><span class="c">!          rod(1) = rod(2)</span>
<a name="ln-641"></a><span class="c">!          rod(2) = ztmp</span>
<a name="ln-642"></a><span class="c">!        end if</span>
<a name="ln-643"></a>        <span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">rod</span>
<a name="ln-644"></a>        <span class="n">FZcnt</span> <span class="o">=</span> <span class="n">FZcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-645"></a>       <span class="k">end if</span>
<a name="ln-646"></a><span class="k">    end if</span>
<a name="ln-647"></a><span class="k">  end do</span>
<a name="ln-648"></a><span class="k"> end do</span>
<a name="ln-649"></a><span class="k">end do</span>
<a name="ln-650"></a>
<a name="ln-651"></a><span class="k">end subroutine </span><span class="n">SampleRFZ</span>
<a name="ln-652"></a>
<a name="ln-653"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-654"></a><span class="c">!</span>
<a name="ln-655"></a><span class="c">! SUBROUTINE: CubochoricNeighbors</span>
<a name="ln-656"></a><span class="c">!</span>
<a name="ln-657"></a><span class="c">!&gt; @author Saransh Singh, Carnegie Mellon University</span>
<a name="ln-658"></a><span class="c">!</span>
<a name="ln-659"></a><span class="c">!&gt; @brief find the nearest neighbors of a point in s03 space, given the point</span>
<a name="ln-660"></a><span class="c">!&gt; and the step size used in the previous meshing. to be used in multi resolution</span>
<a name="ln-661"></a><span class="c">!&gt; indexing programs, specifically the PED, ECP and EBSD indexing. we&#39;re not worrying</span>
<a name="ln-662"></a><span class="c">!&gt; about keeping the neighbors in the FZ. that can just be done later.</span>
<a name="ln-663"></a><span class="c">!</span>
<a name="ln-664"></a><span class="c">!&gt; @param cub cubochoric coordinates  (double precision)</span>
<a name="ln-665"></a><span class="c">!&gt; @param stepsize stepsize of last mesh. the mesh will be stepsize/2</span>
<a name="ln-666"></a><span class="c">!</span>
<a name="ln-667"></a><span class="c">!&gt; @date 04/07/15 SS 1.0 original</span>
<a name="ln-668"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-669"></a><span class="k">recursive subroutine </span><span class="n">CubochoricNeighbors</span><span class="p">(</span><span class="n">cubneighbor</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">cub</span><span class="p">,</span><span class="n">stepsize</span><span class="p">)</span>
<a name="ln-670"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: CubochoricNeighbors</span>
<a name="ln-671"></a>
<a name="ln-672"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-673"></a>
<a name="ln-674"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-675"></a>
<a name="ln-676"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">cubneighbor</span><span class="p">(</span><span class="mi">3</span><span class="p">,(</span><span class="mi">2</span><span class="o">*</span><span class="n">nn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-677"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">nn</span> <span class="c">! number of nearest neighbor in each direction (should be an odd number for symmetric meshing)</span>
<a name="ln-678"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">cub</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-679"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">stepsize</span>
<a name="ln-680"></a>
<a name="ln-681"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span>
<a name="ln-682"></a>
<a name="ln-683"></a><span class="k">if</span> <span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-684"></a><span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;ERROR in subroutine CubochoricNeighbors: Step size is larger than edge length of the cube&quot;</span>
<a name="ln-685"></a>    <span class="k">stop</span>
<a name="ln-686"></a><span class="k">end if</span>
<a name="ln-687"></a>
<a name="ln-688"></a><span class="k">do </span><span class="n">ii</span> <span class="o">=</span> <span class="o">-</span><span class="n">nn</span><span class="p">,</span><span class="n">nn</span>
<a name="ln-689"></a>    <span class="k">do </span><span class="n">jj</span> <span class="o">=</span> <span class="o">-</span><span class="n">nn</span><span class="p">,</span><span class="n">nn</span>
<a name="ln-690"></a>        <span class="k">do </span><span class="n">kk</span> <span class="o">=</span> <span class="o">-</span><span class="n">nn</span><span class="p">,</span><span class="n">nn</span>
<a name="ln-691"></a>            <span class="n">idx</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="n">nn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="n">nn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">kk</span> <span class="o">+</span> <span class="n">nn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-692"></a>            <span class="n">cubneighbor</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">cub</span> <span class="o">+</span> <span class="n">stepsize</span><span class="o">/</span><span class="mf">2.D0</span><span class="o">*</span><span class="p">(</span><span class="o">/</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="o">/</span><span class="p">)</span>
<a name="ln-693"></a>            <span class="k">do </span><span class="n">ll</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-694"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="p">.</span><span class="n">lt</span><span class="p">.</span>  <span class="o">-</span><span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-695"></a><span class="k">                    </span><span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-696"></a>                <span class="k">else if</span> <span class="p">(</span><span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span>  <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-697"></a><span class="k">                    </span><span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">cubneighbor</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">idx</span><span class="p">)</span> <span class="o">-</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-698"></a>                <span class="k">end if</span>
<a name="ln-699"></a><span class="k">            end do</span>
<a name="ln-700"></a><span class="k">        end do</span>
<a name="ln-701"></a><span class="k">    end do</span>
<a name="ln-702"></a><span class="k">end do</span>
<a name="ln-703"></a>
<a name="ln-704"></a>
<a name="ln-705"></a><span class="k">end subroutine </span><span class="n">CubochoricNeighbors</span>
<a name="ln-706"></a>
<a name="ln-707"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-708"></a><span class="c">!</span>
<a name="ln-709"></a><span class="c">! SUBROUTINE: SamplefcctwinRFZ</span>
<a name="ln-710"></a><span class="c">!</span>
<a name="ln-711"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-712"></a><span class="c">!</span>
<a name="ln-713"></a><span class="c">!&gt; @brief uniformly sample the 32-based FZ for an fcc twin.</span>
<a name="ln-714"></a><span class="c">!</span>
<a name="ln-715"></a><span class="c">!&gt; @param nsteps number of steps along semi-edge in cubochoric grid</span>
<a name="ln-716"></a><span class="c">!&gt; @param FZcnt (output) number of points inside fundamental zone</span>
<a name="ln-717"></a><span class="c">!&gt; @param FZlist (output) linked list of points inside fundamental zone</span>
<a name="ln-718"></a><span class="c">!</span>
<a name="ln-719"></a><span class="c">!&gt; @date 09/17/16 MDG 1.0 fcc twin FZ for 60@[111] (also MacKenzie cell)</span>
<a name="ln-720"></a><span class="c">!--------------------------------------------------------------- -----------</span>
<a name="ln-721"></a><span class="k">recursive subroutine </span><span class="n">SamplefcctwinRFZ</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span><span class="n">FZcnt</span><span class="p">,</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-722"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: SamplefcctwinRFZ</span>
<a name="ln-723"></a>
<a name="ln-724"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-725"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-726"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-727"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-728"></a><span class="k">use </span><span class="n">quaternions</span>
<a name="ln-729"></a>
<a name="ln-730"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-731"></a>
<a name="ln-732"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">nsteps</span>
<a name="ln-733"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">FZcnt</span>                <span class="c">! counts number of entries in linked list</span>
<a name="ln-734"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">FZlist</span>                <span class="c">! pointers</span>
<a name="ln-735"></a>
<a name="ln-736"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">allocatable</span>           <span class="kd">::</span> <span class="n">vertex</span><span class="p">(:,:),</span> <span class="n">normals</span><span class="p">(:,:)</span>
<a name="ln-737"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">allocatable</span>        <span class="kd">::</span> <span class="n">faces</span><span class="p">(:,:)</span>
<a name="ln-738"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">r21</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">r23</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">rv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-739"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nn</span>
<a name="ln-740"></a>
<a name="ln-741"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rodt</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">delta</span><span class="p">,</span> <span class="n">rval</span><span class="p">,</span> <span class="n">ro</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dp</span>
<a name="ln-742"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span> <span class="k">pointer</span>              <span class="kd">::</span> <span class="n">FZtmp</span><span class="p">,</span> <span class="n">FZtmp2</span>
<a name="ln-743"></a><span class="kt">logical</span>                              <span class="kd">::</span> <span class="n">inside</span>
<a name="ln-744"></a>
<a name="ln-745"></a>
<a name="ln-746"></a><span class="c">! a point is inside a polyhedron if the dot product of a vector from that</span>
<a name="ln-747"></a><span class="c">! point to any vertex of each face with the face normal is positive</span>
<a name="ln-748"></a>
<a name="ln-749"></a><span class="c">! this routine is specifically written for the fcc twin 60@[111]; the FZ in </span>
<a name="ln-750"></a><span class="c">! that case has the following vertex positions with respect to the standard</span>
<a name="ln-751"></a><span class="c">! 432 rfz (determined with the EMRFZ program):</span>
<a name="ln-752"></a><span class="n">nv</span> <span class="o">=</span> <span class="mi">14</span>
<a name="ln-753"></a><span class="n">nf</span> <span class="o">=</span> <span class="mi">18</span>
<a name="ln-754"></a><span class="n">nn</span> <span class="o">=</span> <span class="mi">18</span>
<a name="ln-755"></a><span class="k">allocate</span><span class="p">(</span><span class="n">vertex</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nv</span><span class="p">),</span> <span class="n">faces</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">nf</span><span class="p">),</span> <span class="n">normals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nn</span><span class="p">))</span>
<a name="ln-756"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.3333334</span><span class="p">,</span> <span class="mf">0.3333333</span><span class="p">,</span> <span class="mf">0.3333333</span><span class="o">/</span><span class="p">);</span>
<a name="ln-757"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0906927</span><span class="p">,</span> <span class="mf">0.0906927</span><span class="p">,</span> <span class="mf">0.3333333</span><span class="o">/</span><span class="p">);</span>
<a name="ln-758"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0098125</span><span class="p">,</span> <span class="mf">0.2524531</span><span class="p">,</span> <span class="mf">0.2524532</span><span class="o">/</span><span class="p">);</span>
<a name="ln-759"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.0906928</span><span class="p">,</span> <span class="mf">0.3333333</span><span class="p">,</span> <span class="mf">0.0906928</span><span class="o">/</span><span class="p">);</span>
<a name="ln-760"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.2524532</span><span class="p">,</span> <span class="mf">0.2524531</span><span class="p">,</span> <span class="mf">0.0098125</span><span class="o">/</span><span class="p">);</span>
<a name="ln-761"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.3333334</span><span class="p">,</span> <span class="mf">0.0906927</span><span class="p">,</span> <span class="mf">0.0906927</span><span class="o">/</span><span class="p">);</span>
<a name="ln-762"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="mf">0.2524532</span><span class="p">,</span> <span class="mf">0.0098125</span><span class="p">,</span> <span class="mf">0.2524531</span><span class="o">/</span><span class="p">);</span>
<a name="ln-763"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.2524531</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2524531</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0098124</span><span class="o">/</span><span class="p">);</span>
<a name="ln-764"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.3333333</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0906927</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0906926</span><span class="o">/</span><span class="p">);</span>
<a name="ln-765"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.2524531</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0098124</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2524531</span><span class="o">/</span><span class="p">);</span>
<a name="ln-766"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.0906926</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0906926</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3333333</span><span class="o">/</span><span class="p">);</span>
<a name="ln-767"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.0098124</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2524531</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2524530</span><span class="o">/</span><span class="p">);</span>
<a name="ln-768"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.0906926</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3333333</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0906926</span><span class="o">/</span><span class="p">);</span>
<a name="ln-769"></a><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/-</span><span class="mf">0.3333333</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3333333</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3333333</span><span class="o">/</span><span class="p">);</span>
<a name="ln-770"></a>
<a name="ln-771"></a>
<a name="ln-772"></a><span class="c">! next, get the face vertex numbers (triangles and squares) in counterclockwise</span>
<a name="ln-773"></a><span class="c">! order when looking towards the origin; triangle faces first, then the rectangles</span>
<a name="ln-774"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-775"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-776"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-777"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-778"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-779"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-780"></a>
<a name="ln-781"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-782"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-783"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-784"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-785"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-786"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-787"></a>
<a name="ln-788"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-789"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-790"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-791"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-792"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-793"></a><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span><span class="mi">13</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-794"></a>
<a name="ln-795"></a><span class="c">! next we get the outward normal for each of the faces</span>
<a name="ln-796"></a><span class="c">! we&#39;ll get the outward normal by computing the cross product of 2-1 and 2-3</span>
<a name="ln-797"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span>
<a name="ln-798"></a>  <span class="n">r21</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-799"></a>  <span class="n">r23</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-800"></a>  <span class="n">normals</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">r21</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">r21</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">r21</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">r21</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">r21</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">r21</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r23</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-801"></a>  <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">i</span><span class="p">,</span> <span class="nb">dot_product</span><span class="p">(</span><span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)),</span><span class="n">normals</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
<a name="ln-802"></a><span class="k">end do</span>
<a name="ln-803"></a>
<a name="ln-804"></a><span class="c">! here we do the regular cubochoric sampling, but use the dot product test to </span>
<a name="ln-805"></a><span class="c">! determine whether or not the point is inside the twin RFZ</span>
<a name="ln-806"></a>
<a name="ln-807"></a><span class="c">! cube semi-edge length</span>
<a name="ln-808"></a><span class="n">s</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-809"></a>
<a name="ln-810"></a><span class="c">! step size for sampling of grid; total number of samples = (2*nsteps+1)**3</span>
<a name="ln-811"></a><span class="n">delta</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
<a name="ln-812"></a>
<a name="ln-813"></a><span class="c">! set the counter to zero</span>
<a name="ln-814"></a><span class="n">FZcnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-815"></a>
<a name="ln-816"></a><span class="c">! make sure the linked lists are empty</span>
<a name="ln-817"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">FZlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-818"></a><span class="k">  </span><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-819"></a>  <span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-820"></a>  <span class="k">do</span>
<a name="ln-821"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">FZtmp2</span><span class="p">)</span>  
<a name="ln-822"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-823"></a><span class="k">    </span><span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span>
<a name="ln-824"></a>    <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-825"></a>  <span class="k">end do</span>
<a name="ln-826"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-827"></a><span class="k">end if</span>
<a name="ln-828"></a>
<a name="ln-829"></a><span class="c">! we always want the identity rotation to be the first one on the list</span>
<a name="ln-830"></a><span class="c">! it is automatically skipped later on...</span>
<a name="ln-831"></a><span class="k">allocate</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-832"></a><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-833"></a><span class="k">nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-834"></a><span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-835"></a><span class="n">FZcnt</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-836"></a>
<a name="ln-837"></a><span class="c">! loop over the cube of volume pi^2; note that we do not want to include</span>
<a name="ln-838"></a><span class="c">! the opposite edges/facets of the cube, to avoid double counting rotations</span>
<a name="ln-839"></a><span class="c">! with a rotation angle of 180 degrees.  This only affects the cyclic groups.</span>
<a name="ln-840"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-841"></a><span class="k">do while</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-842"></a>  <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-843"></a>  <span class="k">do while</span> <span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-844"></a>    <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-845"></a>    <span class="k">do while</span> <span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-846"></a>
<a name="ln-847"></a>     <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">y</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">z</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-848"></a><span class="c">! convert to Rodrigues representation</span>
<a name="ln-849"></a>      <span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-850"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-851"></a>
<a name="ln-852"></a><span class="c">! assume the point is inside and start the tests for each of the face normals</span>
<a name="ln-853"></a>      <span class="n">inside</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-854"></a>      <span class="n">FACELOOP</span><span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nn</span>
<a name="ln-855"></a>         <span class="n">rv</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">faces</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-856"></a>         <span class="n">dp</span> <span class="o">=</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">normals</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> 
<a name="ln-857"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">dp</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-858"></a><span class="k">           </span><span class="n">inside</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-859"></a>           <span class="k">exit </span><span class="n">FACELOOP</span>
<a name="ln-860"></a>         <span class="k">end if</span>
<a name="ln-861"></a><span class="k">      end do </span><span class="n">FACELOOP</span>
<a name="ln-862"></a>
<a name="ln-863"></a><span class="c">! If inside=.TRUE., then add this point to the linked list FZlist and keep</span>
<a name="ln-864"></a><span class="c">! track how many points there are on this list</span>
<a name="ln-865"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">inside</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-866"></a><span class="k">        allocate</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-867"></a>        <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-868"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-869"></a>        <span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">rod</span>
<a name="ln-870"></a>        <span class="n">FZcnt</span> <span class="o">=</span> <span class="n">FZcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-871"></a>       <span class="k">end if</span>
<a name="ln-872"></a><span class="k">     </span>
<a name="ln-873"></a><span class="k">     end if</span>
<a name="ln-874"></a><span class="k">    </span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-875"></a>  <span class="k">end do</span>
<a name="ln-876"></a><span class="k">  </span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-877"></a> <span class="k">end do</span>
<a name="ln-878"></a><span class="k"> </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-879"></a><span class="k">end do</span>
<a name="ln-880"></a>
<a name="ln-881"></a><span class="c">! that&#39;s it.</span>
<a name="ln-882"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nsteps, delta, s = &#39;</span><span class="p">,</span><span class="n">nsteps</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="n">s</span>
<a name="ln-883"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;FZcnt = &#39;</span><span class="p">,</span><span class="n">FZcnt</span>
<a name="ln-884"></a>
<a name="ln-885"></a><span class="k">end subroutine </span><span class="n">SamplefcctwinRFZ</span>
<a name="ln-886"></a>
<a name="ln-887"></a>
<a name="ln-888"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-889"></a><span class="c">!</span>
<a name="ln-890"></a><span class="c">! SUBROUTINE: SampleRFZtwin</span>
<a name="ln-891"></a><span class="c">!</span>
<a name="ln-892"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-893"></a><span class="c">!</span>
<a name="ln-894"></a><span class="c">!&gt; @brief use a quaternion to rotate the fundamental zone, then sample it </span>
<a name="ln-895"></a><span class="c">!&gt; this is useful for twins etc, hence the name of the routine...</span>
<a name="ln-896"></a><span class="c">!</span>
<a name="ln-897"></a><span class="c">!&gt; @param nsteps number of steps along semi-edge in cubochoric grid</span>
<a name="ln-898"></a><span class="c">!&gt; @param pgnum point group number to determine the appropriate Rodrigues fundamental zone</span>
<a name="ln-899"></a><span class="c">!&gt; @param qt rotation quaternion</span>
<a name="ln-900"></a><span class="c">!&gt; @param FZcnt (output) number of points inside fundamental zone</span>
<a name="ln-901"></a><span class="c">!&gt; @param FZlist (output) linked list of points inside fundamental zone</span>
<a name="ln-902"></a>
<a name="ln-903"></a><span class="c">!</span>
<a name="ln-904"></a><span class="c">!&gt; @date 04/07/15 SS  1.0 original</span>
<a name="ln-905"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-906"></a><span class="k">recursive subroutine </span><span class="n">SampleRFZtwin</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,</span><span class="n">pgnum</span><span class="p">,</span><span class="n">qt</span><span class="p">,</span><span class="n">FZcnt</span><span class="p">,</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-907"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: SampleRFZtwin</span>
<a name="ln-908"></a>
<a name="ln-909"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-910"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-911"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-912"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-913"></a><span class="k">use </span><span class="n">quaternions</span>
<a name="ln-914"></a>
<a name="ln-915"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-916"></a>
<a name="ln-917"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">nsteps</span>
<a name="ln-918"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">pgnum</span>
<a name="ln-919"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">sgl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">qt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-920"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">FZcnt</span>                <span class="c">! counts number of entries in linked list</span>
<a name="ln-921"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">FZlist</span>               <span class="c">! pointers</span>
<a name="ln-922"></a>
<a name="ln-923"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">rodt</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">delta</span><span class="p">,</span> <span class="n">rval</span><span class="p">,</span> <span class="n">ro</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-924"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span> <span class="k">pointer</span>              <span class="kd">::</span> <span class="n">FZtmp</span><span class="p">,</span> <span class="n">FZtmp2</span>
<a name="ln-925"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">FZtype</span><span class="p">,</span> <span class="n">FZorder</span>
<a name="ln-926"></a>
<a name="ln-927"></a><span class="c">! cube semi-edge length</span>
<a name="ln-928"></a><span class="n">s</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-929"></a>
<a name="ln-930"></a><span class="c">! step size for sampling of grid; total number of samples = (2*nsteps+1)**3</span>
<a name="ln-931"></a><span class="n">delta</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
<a name="ln-932"></a>
<a name="ln-933"></a><span class="c">! set the counter to zero</span>
<a name="ln-934"></a><span class="n">FZcnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-935"></a>
<a name="ln-936"></a><span class="c">! make sure the linked lists are empty</span>
<a name="ln-937"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">FZlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-938"></a><span class="k">  </span><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-939"></a>  <span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-940"></a>  <span class="k">do</span>
<a name="ln-941"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">FZtmp2</span><span class="p">)</span>  
<a name="ln-942"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-943"></a><span class="k">    </span><span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span>
<a name="ln-944"></a>    <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-945"></a>  <span class="k">end do</span>
<a name="ln-946"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-947"></a><span class="k">end if</span>
<a name="ln-948"></a>
<a name="ln-949"></a><span class="c">! we always want the identity rotation to be the first one on the list</span>
<a name="ln-950"></a><span class="c">! it is automatically skipped later on...</span>
<a name="ln-951"></a><span class="k">allocate</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-952"></a><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-953"></a><span class="k">nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-954"></a><span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-955"></a><span class="n">FZcnt</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-956"></a>
<a name="ln-957"></a><span class="c">! determine which function we should call for this point group symmetry</span>
<a name="ln-958"></a><span class="n">FZtype</span> <span class="o">=</span> <span class="n">FZtarray</span><span class="p">(</span><span class="n">pgnum</span><span class="p">)</span>
<a name="ln-959"></a><span class="n">FZorder</span> <span class="o">=</span> <span class="n">FZoarray</span><span class="p">(</span><span class="n">pgnum</span><span class="p">)</span>
<a name="ln-960"></a>
<a name="ln-961"></a><span class="c">! loop over the cube of volume pi^2; note that we do not want to include</span>
<a name="ln-962"></a><span class="c">! the opposite edges/facets of the cube, to avoid double counting rotations</span>
<a name="ln-963"></a><span class="c">! with a rotation angle of 180 degrees.  This only affects the cyclic groups.</span>
<a name="ln-964"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-965"></a><span class="k">do while</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-966"></a>  <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-967"></a>  <span class="k">do while</span> <span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-968"></a>    <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-969"></a>    <span class="k">do while</span> <span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-970"></a>
<a name="ln-971"></a>     <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">y</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">z</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-972"></a><span class="c">! convert to Rodrigues representation</span>
<a name="ln-973"></a>      <span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-974"></a><span class="c">! convert to an actual vector</span>
<a name="ln-975"></a>      <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-976"></a><span class="c">! then apply the twinning quaternion</span>
<a name="ln-977"></a>      <span class="n">ro</span> <span class="o">=</span> <span class="n">quat_Lp</span><span class="p">(</span><span class="nb">dble</span><span class="p">(</span><span class="n">qt</span><span class="p">),</span> <span class="n">ro</span><span class="p">)</span>
<a name="ln-978"></a><span class="c">! convert back to a Rodrigues vector</span>
<a name="ln-979"></a>      <span class="n">rodt</span> <span class="o">=</span> <span class="n">rod</span>
<a name="ln-980"></a>      <span class="n">rodt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ro</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-981"></a>
<a name="ln-982"></a><span class="c">! If insideFZ=.TRUE., then add this point to the linked list FZlist and keep</span>
<a name="ln-983"></a><span class="c">! track of how many points there are on this list</span>
<a name="ln-984"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">IsinsideFZ</span><span class="p">(</span><span class="n">rodt</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">))</span> <span class="k">then </span>
<a name="ln-985"></a><span class="k">        allocate</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-986"></a>        <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-987"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-988"></a>        <span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">rod</span>
<a name="ln-989"></a>        <span class="n">FZcnt</span> <span class="o">=</span> <span class="n">FZcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-990"></a>       <span class="k">end if</span>
<a name="ln-991"></a><span class="k">     </span>
<a name="ln-992"></a><span class="k">     end if</span>
<a name="ln-993"></a><span class="k">    </span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-994"></a>  <span class="k">end do</span>
<a name="ln-995"></a><span class="k">  </span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-996"></a> <span class="k">end do</span>
<a name="ln-997"></a><span class="k"> </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-998"></a><span class="k">end do</span>
<a name="ln-999"></a>
<a name="ln-1000"></a><span class="c">! that&#39;s it.</span>
<a name="ln-1001"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;pgnum, nsteps, delta, s = &#39;</span><span class="p">,</span><span class="n">pgnum</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="n">s</span>
<a name="ln-1002"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;FZtype, FZorder = &#39;</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span>
<a name="ln-1003"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;FZcnt = &#39;</span><span class="p">,</span><span class="n">FZcnt</span>
<a name="ln-1004"></a>
<a name="ln-1005"></a><span class="k">end subroutine </span><span class="n">SampleRFZtwin</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1008"></a><span class="c">!</span>
<a name="ln-1009"></a><span class="c">! SUBROUTINE: sample_isoCube</span>
<a name="ln-1010"></a><span class="c">!</span>
<a name="ln-1011"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1012"></a><span class="c">!</span>
<a name="ln-1013"></a><span class="c">!&gt; @brief sample a centered cube surface inside the Cubochoric cube for a given misorientation angle</span>
<a name="ln-1014"></a><span class="c">!</span>
<a name="ln-1015"></a><span class="c">!&gt; @details linked list wil have a length of 6(N-1)^2+2 entries</span>
<a name="ln-1016"></a><span class="c">!</span>
<a name="ln-1017"></a><span class="c">!&gt; @param misang the misorientation angle [degrees]</span>
<a name="ln-1018"></a><span class="c">!&gt; @param N number of points along cube semi-edge</span>
<a name="ln-1019"></a><span class="c">!&gt; @param CMcnt the number of components in the returned linked list</span>
<a name="ln-1020"></a><span class="c">!&gt; @param CMlist (output) linked list of Rodrigues vectors</span>
<a name="ln-1021"></a><span class="c">!</span>
<a name="ln-1022"></a><span class="c">!&gt; @date 03/03/16 MDG 1.0 original</span>
<a name="ln-1023"></a><span class="c">!&gt; @date 04/19/16 MDG 1.1 changed value of N to be along the semi-edge instead of the edge</span>
<a name="ln-1024"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1025"></a><span class="k">recursive subroutine </span><span class="n">sample_isoCube</span><span class="p">(</span><span class="n">misang</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">CMcnt</span><span class="p">,</span> <span class="n">CMlist</span><span class="p">)</span> <span class="c">! CM = Constant Misorientation</span>
<a name="ln-1026"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: sample_isoCube</span>
<a name="ln-1027"></a>
<a name="ln-1028"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1029"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1030"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-1031"></a>
<a name="ln-1032"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1033"></a>
<a name="ln-1034"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">misang</span>       <span class="c">! desired misorientation angle (degrees)</span>
<a name="ln-1035"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">N</span>            <span class="c">! desired number of sampling points along cube edge</span>
<a name="ln-1036"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CMcnt</span>        <span class="c">! number of entries in linked list</span>
<a name="ln-1037"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMlist</span>       <span class="c">! pointer to start of linked list</span>
<a name="ln-1038"></a>
<a name="ln-1039"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMtmp</span><span class="p">,</span> <span class="n">CMtmp2</span>
<a name="ln-1040"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">edge</span><span class="p">,</span> <span class="n">misangr</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
<a name="ln-1041"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-1042"></a>
<a name="ln-1043"></a><span class="c">! initialize parameters</span>
<a name="ln-1044"></a><span class="n">CMcnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1045"></a>
<a name="ln-1046"></a><span class="c">! convert the misorientation angle to radians</span>
<a name="ln-1047"></a><span class="n">misangr</span> <span class="o">=</span> <span class="n">misang</span> <span class="o">*</span> <span class="n">cPi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.D0</span>
<a name="ln-1048"></a>
<a name="ln-1049"></a><span class="c">! make sure the linked list is empty</span>
<a name="ln-1050"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">CMlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1051"></a><span class="k">  </span><span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1052"></a>  <span class="n">CMtmp2</span> <span class="o">=&gt;</span> <span class="n">CMlist</span>
<a name="ln-1053"></a>  <span class="k">do</span>
<a name="ln-1054"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">CMtmp2</span><span class="p">)</span>  
<a name="ln-1055"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1056"></a><span class="k">    </span><span class="n">CMtmp2</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span>
<a name="ln-1057"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1058"></a>  <span class="k">end do</span>
<a name="ln-1059"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">CMlist</span><span class="p">)</span>
<a name="ln-1060"></a><span class="k">end if</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a><span class="c">! allocate the linked list</span>
<a name="ln-1063"></a><span class="k">allocate</span><span class="p">(</span><span class="n">CMlist</span><span class="p">)</span>
<a name="ln-1064"></a><span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMlist</span>
<a name="ln-1065"></a>
<a name="ln-1066"></a><span class="c">! set the cube edge length based on the misorientation angle</span>
<a name="ln-1067"></a><span class="n">edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">cPi</span> <span class="o">*</span> <span class="p">(</span><span class="n">misangr</span><span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">misangr</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.D0</span><span class="o">/</span><span class="mf">3.D0</span><span class="p">)</span>  <span class="o">*</span> <span class="mf">0.5D0</span>
<a name="ln-1068"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">/</span> <span class="nb">dble</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1069"></a>
<a name="ln-1070"></a><span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; edge = &#39;</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="s1">&#39;; delta = &#39;</span><span class="p">,</span> <span class="n">dx</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a><span class="c">! and generate the linked list of surface points</span>
<a name="ln-1073"></a>
<a name="ln-1074"></a><span class="c">! do the x-y bottom and top planes first (each have N^2 points)</span>
<a name="ln-1075"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1076"></a>  <span class="n">x</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1077"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1078"></a>    <span class="n">y</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1079"></a><span class="c">! add the point to the list </span>
<a name="ln-1080"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">edge</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1081"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1082"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1083"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1084"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1085"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1086"></a><span class="c">! and its mirror image in the top plane</span>
<a name="ln-1087"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">edge</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1088"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1089"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1090"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1091"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1092"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1093"></a>  <span class="k">end do</span>
<a name="ln-1094"></a><span class="k">end do</span>
<a name="ln-1095"></a>
<a name="ln-1096"></a><span class="c">! then we do the y-z planes; each have N*(N-2) points</span>
<a name="ln-1097"></a><span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1098"></a>  <span class="n">y</span> <span class="o">=</span>  <span class="nb">dble</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1099"></a>  <span class="k">do </span><span class="n">k</span><span class="o">=-</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1100"></a>    <span class="n">z</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1101"></a><span class="c">! add the point to the list </span>
<a name="ln-1102"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">edge</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1103"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1104"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1105"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1106"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1107"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1108"></a><span class="c">! and its mirror image in the top plane</span>
<a name="ln-1109"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="o">-</span><span class="n">edge</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1110"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1111"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1112"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1113"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1114"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1115"></a>  <span class="k">end do</span>
<a name="ln-1116"></a><span class="k">end do</span>
<a name="ln-1117"></a>
<a name="ln-1118"></a><span class="c">! and finally the x-z planes, with (N-2)^2 points each</span>
<a name="ln-1119"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1120"></a>  <span class="n">x</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1121"></a>  <span class="k">do </span><span class="n">k</span><span class="o">=-</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1122"></a>    <span class="n">z</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1123"></a><span class="c">! add the point to the list </span>
<a name="ln-1124"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1125"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1126"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1127"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1128"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1129"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1130"></a><span class="c">! and its mirror image in the top plane</span>
<a name="ln-1131"></a>    <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">edge</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1132"></a>    <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1133"></a>    <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1134"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1135"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1136"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1137"></a>  <span class="k">end do</span>
<a name="ln-1138"></a><span class="k">end do</span>
<a name="ln-1139"></a>
<a name="ln-1140"></a><span class="k">end subroutine </span><span class="n">sample_isoCube</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1143"></a><span class="c">!</span>
<a name="ln-1144"></a><span class="c">! SUBROUTINE: sample_isoCubeFilled</span>
<a name="ln-1145"></a><span class="c">!</span>
<a name="ln-1146"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1147"></a><span class="c">!</span>
<a name="ln-1148"></a><span class="c">!&gt; @brief sample a centered cube inside the Cubochoric cube for a given misorientation angle</span>
<a name="ln-1149"></a><span class="c">!</span>
<a name="ln-1150"></a><span class="c">!&gt; @details This routine is different from the sample_isoCube routine in that it </span>
<a name="ln-1151"></a><span class="c">!&gt; generates ALL the points inside the centered cube instead of just the points on</span>
<a name="ln-1152"></a><span class="c">!&gt; the outer surface.  This can be useful to uniformly sample a small volume of orientation</span>
<a name="ln-1153"></a><span class="c">!&gt; space around some point out to a given misorientation angle.  Since the sampling has concentric</span>
<a name="ln-1154"></a><span class="c">!&gt; cubes, all the samples can be subdivided into discrete misorientation classes.</span>
<a name="ln-1155"></a><span class="c">!&gt; The linked list wil have a length of N^3</span>
<a name="ln-1156"></a><span class="c">!</span>
<a name="ln-1157"></a><span class="c">!&gt; @param misang the misorientation angle [degrees]</span>
<a name="ln-1158"></a><span class="c">!&gt; @param N number of points along cube edge</span>
<a name="ln-1159"></a><span class="c">!&gt; @param CMcnt the number of components in the returned linked list</span>
<a name="ln-1160"></a><span class="c">!&gt; @param CMlist (output) linked list of Rodrigues vectors</span>
<a name="ln-1161"></a><span class="c">!</span>
<a name="ln-1162"></a><span class="c">!&gt; @date 04/08/16 MDG 1.0 original</span>
<a name="ln-1163"></a><span class="c">!&gt; @date 04/19/16 MDG 1.1 changed value of N to be along the semi-edge instead of the edge</span>
<a name="ln-1164"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1165"></a><span class="k">recursive subroutine </span><span class="n">sample_isoCubeFilled</span><span class="p">(</span><span class="n">misang</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">CMcnt</span><span class="p">,</span> <span class="n">CMlist</span><span class="p">)</span> <span class="c">! CM = Constant Misorientation</span>
<a name="ln-1166"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: sample_isoCubeFilled</span>
<a name="ln-1167"></a>
<a name="ln-1168"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1169"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1170"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-1171"></a>
<a name="ln-1172"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1173"></a>
<a name="ln-1174"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">misang</span>       <span class="c">! desired misorientation angle (degrees)</span>
<a name="ln-1175"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">N</span>            <span class="c">! desired number of sampling points along cube edge</span>
<a name="ln-1176"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CMcnt</span>        <span class="c">! number of entries in linked list</span>
<a name="ln-1177"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMlist</span>       <span class="c">! pointer to start of linked list</span>
<a name="ln-1178"></a>
<a name="ln-1179"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMtmp</span><span class="p">,</span> <span class="n">CMtmp2</span>
<a name="ln-1180"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">edge</span><span class="p">,</span> <span class="n">misangr</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">cu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span>
<a name="ln-1181"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span>
<a name="ln-1182"></a>
<a name="ln-1183"></a><span class="c">! initialize parameters</span>
<a name="ln-1184"></a><span class="n">CMcnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1185"></a>
<a name="ln-1186"></a><span class="c">! convert the misorientation angle to radians</span>
<a name="ln-1187"></a><span class="n">misangr</span> <span class="o">=</span> <span class="n">misang</span> <span class="o">*</span> <span class="n">cPi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.D0</span>
<a name="ln-1188"></a>
<a name="ln-1189"></a><span class="c">! make sure the linked list is empty</span>
<a name="ln-1190"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">CMlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1191"></a><span class="k">  </span><span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1192"></a>  <span class="n">CMtmp2</span> <span class="o">=&gt;</span> <span class="n">CMlist</span>
<a name="ln-1193"></a>  <span class="k">do</span>
<a name="ln-1194"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">CMtmp2</span><span class="p">)</span>  
<a name="ln-1195"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1196"></a><span class="k">    </span><span class="n">CMtmp2</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span>
<a name="ln-1197"></a>    <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1198"></a>  <span class="k">end do</span>
<a name="ln-1199"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">CMlist</span><span class="p">)</span>
<a name="ln-1200"></a><span class="k">end if</span>
<a name="ln-1201"></a>
<a name="ln-1202"></a><span class="c">! allocate the linked list</span>
<a name="ln-1203"></a><span class="k">allocate</span><span class="p">(</span><span class="n">CMlist</span><span class="p">)</span>
<a name="ln-1204"></a><span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMlist</span>
<a name="ln-1205"></a>
<a name="ln-1206"></a><span class="c">! set the cube edge length based on the misorientation angle</span>
<a name="ln-1207"></a><span class="n">edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">cPi</span> <span class="o">*</span> <span class="p">(</span><span class="n">misangr</span><span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">misangr</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.D0</span><span class="o">/</span><span class="mf">3.D0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5D0</span>
<a name="ln-1208"></a><span class="n">dx</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">/</span> <span class="nb">dble</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1209"></a>
<a name="ln-1210"></a><span class="c">! and generate the linked list of surface points</span>
<a name="ln-1211"></a><span class="c">! loop over the (2N+1)^3 points</span>
<a name="ln-1212"></a><span class="k">do </span><span class="n">i</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1213"></a>  <span class="n">x</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1214"></a>  <span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1215"></a>    <span class="n">y</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1216"></a>    <span class="k">do </span><span class="n">k</span><span class="o">=-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1217"></a>      <span class="n">z</span> <span class="o">=</span> <span class="nb">dble</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span>
<a name="ln-1218"></a><span class="c">! add the point to the list </span>
<a name="ln-1219"></a>      <span class="n">cu</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1220"></a>      <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span><span class="n">cu</span><span class="p">)</span>
<a name="ln-1221"></a>      <span class="n">CMcnt</span> <span class="o">=</span> <span class="n">CMcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1222"></a>      <span class="k">allocate</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1223"></a>      <span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1224"></a>      <span class="k">nullify</span><span class="p">(</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1225"></a>    <span class="k">end do</span>
<a name="ln-1226"></a><span class="k">  end do</span>
<a name="ln-1227"></a><span class="k">end do</span>
<a name="ln-1228"></a>
<a name="ln-1229"></a><span class="k">end subroutine </span><span class="n">sample_isoCubeFilled</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1232"></a><span class="c">!</span>
<a name="ln-1233"></a><span class="c">! SUBROUTINE: sample_Cone</span>
<a name="ln-1234"></a><span class="c">!</span>
<a name="ln-1235"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1236"></a><span class="c">!</span>
<a name="ln-1237"></a><span class="c">!&gt; @brief sample a cone centered on a unit vector with apex in the origin and given opening angle</span>
<a name="ln-1238"></a><span class="c">!</span>
<a name="ln-1239"></a><span class="c">!&gt; @param unitvector  unit vector describing the cone axis</span>
<a name="ln-1240"></a><span class="c">!&gt; @param dpmax = cosine of half the cone angle</span>
<a name="ln-1241"></a><span class="c">!&gt; @param N number of points along cube edge</span>
<a name="ln-1242"></a><span class="c">!&gt; @param CMcnt the number of components in the returned linked list</span>
<a name="ln-1243"></a><span class="c">!&gt; @param CMlist (output) linked list of Rodrigues vectors</span>
<a name="ln-1244"></a><span class="c">!</span>
<a name="ln-1245"></a><span class="c">!&gt; @date 02/01/17 MDG 1.0 original</span>
<a name="ln-1246"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1247"></a><span class="k">recursive subroutine </span><span class="n">sample_Cone</span><span class="p">(</span><span class="n">unitvector</span><span class="p">,</span> <span class="n">dpmax</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">FZtype</span><span class="p">,</span> <span class="n">FZorder</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> 
<a name="ln-1248"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: sample_Cone</span>
<a name="ln-1249"></a>
<a name="ln-1250"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1251"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1252"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-1253"></a>
<a name="ln-1254"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1255"></a>
<a name="ln-1256"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">unitvector</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="c">! axis of cone</span>
<a name="ln-1257"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">dpmax</span>        <span class="c">! maximum dot product</span>
<a name="ln-1258"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">N</span>            <span class="c">! number of sampling points along cube semi edge</span>
<a name="ln-1259"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">FZtype</span>
<a name="ln-1260"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">FZorder</span>
<a name="ln-1261"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">cnt</span>          <span class="c">! number of entries in linked list</span>
<a name="ln-1262"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">list</span>         <span class="c">! pointer to start of linked list</span>
<a name="ln-1263"></a>
<a name="ln-1264"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">tmp2</span>
<a name="ln-1265"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">dx</span><span class="p">,</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1266"></a>
<a name="ln-1267"></a><span class="c">! initialize parameters</span>
<a name="ln-1268"></a><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1269"></a><span class="c">! cube semi-edge length</span>
<a name="ln-1270"></a><span class="n">s</span> <span class="o">=</span> <span class="mf">0.5D0</span> <span class="o">*</span> <span class="n">LPs</span><span class="p">%</span><span class="n">ap</span>
<a name="ln-1271"></a><span class="c">! step size for sampling of grid; total number of samples = (2*nsteps+1)**3</span>
<a name="ln-1272"></a><span class="n">delta</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">dble</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1273"></a>
<a name="ln-1274"></a><span class="c">! make sure the linked list is empty</span>
<a name="ln-1275"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">list</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1276"></a><span class="k">  </span><span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">list</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1277"></a>  <span class="n">tmp2</span> <span class="o">=&gt;</span> <span class="n">list</span>
<a name="ln-1278"></a>  <span class="k">do</span>
<a name="ln-1279"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">tmp2</span><span class="p">)</span>  
<a name="ln-1280"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1281"></a><span class="k">    </span><span class="n">tmp2</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-1282"></a>    <span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1283"></a>  <span class="k">end do</span>
<a name="ln-1284"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<a name="ln-1285"></a><span class="k">end if</span>
<a name="ln-1286"></a>
<a name="ln-1287"></a><span class="c">! allocate the linked list and insert the origin</span>
<a name="ln-1288"></a><span class="k">allocate</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<a name="ln-1289"></a><span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">list</span>
<a name="ln-1290"></a><span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1291"></a><span class="n">tmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1292"></a><span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1293"></a>
<a name="ln-1294"></a><span class="c">! and generate the linked list of points inside the cone</span>
<a name="ln-1295"></a><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-1296"></a><span class="k">do while</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-1297"></a>  <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-1298"></a>  <span class="k">do while</span> <span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-1299"></a>    <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
<a name="ln-1300"></a>    <span class="k">do while</span> <span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">s</span><span class="p">)</span>
<a name="ln-1301"></a>
<a name="ln-1302"></a>     <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">y</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">z</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1303"></a><span class="c">! convert to Rodrigues representation</span>
<a name="ln-1304"></a>      <span class="n">rod</span> <span class="o">=</span> <span class="n">cu2ro</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1305"></a>      <span class="n">r</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-1306"></a><span class="c">! compute the dot product of this vector and the unitvector</span>
<a name="ln-1307"></a>      <span class="n">dp</span> <span class="o">=</span> <span class="n">unitvector</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">unitvector</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">unitvector</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1308"></a><span class="c">! conditionally add the point to the list if it lies inside the cone (dpmax &lt;= dp)</span>
<a name="ln-1309"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">dp</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="n">dpmax</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">IsinsideFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">FZtype</span><span class="p">,</span><span class="n">FZorder</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-1310"></a><span class="k">        allocate</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1311"></a>        <span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1312"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1313"></a>        <span class="n">tmp</span><span class="p">%</span><span class="n">trod</span> <span class="o">=</span> <span class="n">rod</span>
<a name="ln-1314"></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1315"></a>      <span class="k">end if</span>
<a name="ln-1316"></a><span class="k">     end if</span>
<a name="ln-1317"></a>
<a name="ln-1318"></a><span class="k">    </span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-1319"></a>  <span class="k">end do</span>
<a name="ln-1320"></a><span class="k">  </span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-1321"></a> <span class="k">end do</span>
<a name="ln-1322"></a><span class="k"> </span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta</span>
<a name="ln-1323"></a><span class="k">end do</span>
<a name="ln-1324"></a>
<a name="ln-1325"></a><span class="k">end subroutine </span><span class="n">sample_Cone</span>
<a name="ln-1326"></a>
<a name="ln-1327"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1328"></a><span class="c">!</span>
<a name="ln-1329"></a><span class="c">! SUBROUTINE: SampleIsoMisorientation</span>
<a name="ln-1330"></a><span class="c">!</span>
<a name="ln-1331"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1332"></a><span class="c">!</span>
<a name="ln-1333"></a><span class="c">!&gt; @brief Constant Misorientation sampling routine; input list must be generated by sampleCubeSurface</span>
<a name="ln-1334"></a><span class="c">!</span>
<a name="ln-1335"></a><span class="c">!&gt; @param rhozero central Rodrigues point around which constant misorientation sample is requested</span>
<a name="ln-1336"></a><span class="c">!&gt; @param misang the misorientation angle [degrees]</span>
<a name="ln-1337"></a><span class="c">!&gt; @param CMcnt the number of components in the returned linked list</span>
<a name="ln-1338"></a><span class="c">!&gt; @param CMlist (output) linked list of Rodrigues vectors, with transformed vectors in trod(4) entries</span>
<a name="ln-1339"></a><span class="c">!</span>
<a name="ln-1340"></a><span class="c">!&gt; @date 03/03/16 SS/MDG 1.0 original (merged from two separate implementations)</span>
<a name="ln-1341"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1342"></a><span class="k">recursive subroutine </span><span class="n">SampleIsoMisorientation</span><span class="p">(</span><span class="n">rhozero</span><span class="p">,</span> <span class="n">misang</span><span class="p">,</span> <span class="n">CMcnt</span><span class="p">,</span> <span class="n">CMlist</span><span class="p">)</span> <span class="c">! CM = Constant Misorientation</span>
<a name="ln-1343"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: SampleIsoMisorientation</span>
<a name="ln-1344"></a>
<a name="ln-1345"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1346"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1347"></a><span class="k">use </span><span class="n">math</span>
<a name="ln-1348"></a>
<a name="ln-1349"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1350"></a>
<a name="ln-1351"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">rhozero</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="c">! center Rodrigues vector</span>
<a name="ln-1352"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">misang</span>       <span class="c">! desired misorientation angle (degrees)</span>
<a name="ln-1353"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">CMcnt</span>        <span class="c">! number of entries in linked list</span>
<a name="ln-1354"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMlist</span>       <span class="c">! pointer to start of linked list</span>
<a name="ln-1355"></a>
<a name="ln-1356"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">CMtmp</span>
<a name="ln-1357"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">rhovec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="n">vv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1358"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1359"></a>
<a name="ln-1360"></a><span class="c">! go through the list and transform all points to the spheroid misorientation surface</span>
<a name="ln-1361"></a><span class="c">! the resulting Rodrigues vectors are stored in the trod(4) entry.</span>
<a name="ln-1362"></a>
<a name="ln-1363"></a><span class="n">rhovec</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rhozero</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rhozero</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1364"></a>
<a name="ln-1365"></a><span class="n">CMtmp</span> <span class="o">=&gt;</span> <span class="n">CMlist</span>
<a name="ln-1366"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">CMcnt</span>
<a name="ln-1367"></a><span class="c">! get the actual Rodrigues vector</span>
<a name="ln-1368"></a>  <span class="n">vv</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">CMtmp</span><span class="p">%</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1369"></a><span class="c">! apply the Rodrigues transformation formula</span>
<a name="ln-1370"></a>  <span class="n">vv</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">vv</span> <span class="o">+</span> <span class="n">rhovec</span> <span class="o">+</span> <span class="n">cross3</span><span class="p">(</span><span class="n">rhovec</span><span class="p">,</span><span class="n">vv</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.D0</span> <span class="o">+</span> <span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">rhovec</span><span class="p">))</span>
<a name="ln-1371"></a><span class="c">! and convert back to the 4-component format</span>
<a name="ln-1372"></a>  <span class="n">s</span> <span class="o">=</span> <span class="nb">dsqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">vv</span><span class="o">*</span><span class="n">vv</span><span class="p">))</span>
<a name="ln-1373"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-1374"></a><span class="k">    </span><span class="n">CMtmp</span><span class="p">%</span><span class="n">trod</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="n">vv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">vv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">vv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1375"></a>  <span class="k">else</span>
<a name="ln-1376"></a><span class="k">    </span><span class="n">CMtmp</span><span class="p">%</span><span class="n">trod</span> <span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">0.D0</span><span class="p">,</span> <span class="mf">1.D0</span><span class="p">,</span> <span class="mf">0.D0</span> <span class="o">/</span><span class="p">)</span>
<a name="ln-1377"></a>  <span class="k">end if</span>
<a name="ln-1378"></a><span class="k">  </span><span class="n">CMtmp</span><span class="o">=&gt;</span><span class="n">CMtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1379"></a><span class="k">end do</span>
<a name="ln-1380"></a>
<a name="ln-1381"></a><span class="k">end subroutine </span><span class="n">SampleIsoMisorientation</span>
<a name="ln-1382"></a>
<a name="ln-1383"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1384"></a><span class="c">!</span>
<a name="ln-1385"></a><span class="c">! SUBROUTINE: getEulersfromFile</span>
<a name="ln-1386"></a><span class="c">!</span>
<a name="ln-1387"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1388"></a><span class="c">!</span>
<a name="ln-1389"></a><span class="c">!&gt; @brief read a list of Euler angles from a text file and insert them in a linked list</span>
<a name="ln-1390"></a><span class="c">!</span>
<a name="ln-1391"></a><span class="c">!&gt; @param eulerfile name of the Euler angle file (with usual path handling)</span>
<a name="ln-1392"></a><span class="c">!&gt; @param FZcnt the number of components in the returned linked list</span>
<a name="ln-1393"></a><span class="c">!&gt; @param FZlist (output) linked list of Rodrigues vectors, with transformed vectors in trod(4) entries</span>
<a name="ln-1394"></a><span class="c">!</span>
<a name="ln-1395"></a><span class="c">!&gt; @date 12/22/16 MDG 1.0 original</span>
<a name="ln-1396"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1397"></a><span class="k">recursive subroutine </span><span class="n">getEulersfromFile</span><span class="p">(</span><span class="n">eulerfile</span><span class="p">,</span> <span class="n">FZcnt</span><span class="p">,</span> <span class="n">FZlist</span><span class="p">)</span>
<a name="ln-1398"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: getEulersfromFile</span>
<a name="ln-1399"></a>
<a name="ln-1400"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1401"></a><span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1402"></a><span class="k">use </span><span class="n">rotations</span>
<a name="ln-1403"></a>
<a name="ln-1404"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1405"></a>
<a name="ln-1406"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">eulerfile</span>
<a name="ln-1407"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">FZcnt</span>        <span class="c">! number of entries in linked list</span>
<a name="ln-1408"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">FZlist</span>       <span class="c">! pointer to start of linked list</span>
<a name="ln-1409"></a>
<a name="ln-1410"></a><span class="kt">character</span><span class="p">(</span><span class="n">fnlen</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">filepath</span>
<a name="ln-1411"></a><span class="kt">character</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">anglemode</span>
<a name="ln-1412"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">numang</span><span class="p">,</span> <span class="n">i</span>
<a name="ln-1413"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">eu</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtor</span>
<a name="ln-1414"></a><span class="k">type</span><span class="p">(</span><span class="n">FZpointd</span><span class="p">),</span><span class="k">pointer</span>                  <span class="kd">::</span> <span class="n">FZtmp</span><span class="p">,</span> <span class="n">FZtmp2</span>
<a name="ln-1415"></a>
<a name="ln-1416"></a><span class="n">dtor</span> <span class="o">=</span> <span class="n">cPi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.D0</span>
<a name="ln-1417"></a>
<a name="ln-1418"></a><span class="c">! set the file path</span>
<a name="ln-1419"></a><span class="n">filepath</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">EMsoft_getEMdatapathname</span><span class="p">())</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">eulerfile</span><span class="p">)</span>
<a name="ln-1420"></a><span class="n">filepath</span> <span class="o">=</span> <span class="n">EMsoft_toNativePath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<a name="ln-1421"></a>
<a name="ln-1422"></a><span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">)</span>
<a name="ln-1423"></a><span class="k">read</span> <span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">anglemode</span>
<a name="ln-1424"></a><span class="k">read</span> <span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">numang</span>
<a name="ln-1425"></a>
<a name="ln-1426"></a><span class="c">! make sure the linked list is empty</span>
<a name="ln-1427"></a><span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">FZlist</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1428"></a><span class="k">  </span><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1429"></a>  <span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-1430"></a>  <span class="k">do</span>
<a name="ln-1431"></a><span class="k">    deallocate</span><span class="p">(</span><span class="n">FZtmp2</span><span class="p">)</span>  
<a name="ln-1432"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">)</span> <span class="p">)</span> <span class="k">EXIT</span>
<a name="ln-1433"></a><span class="k">    </span><span class="n">FZtmp2</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span>
<a name="ln-1434"></a>    <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1435"></a>  <span class="k">end do</span>
<a name="ln-1436"></a><span class="k">  nullify</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-1437"></a><span class="k">end if</span>
<a name="ln-1438"></a>
<a name="ln-1439"></a><span class="c">! allocate the linked list</span>
<a name="ln-1440"></a><span class="k">allocate</span><span class="p">(</span><span class="n">FZlist</span><span class="p">)</span>
<a name="ln-1441"></a><span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZlist</span>
<a name="ln-1442"></a>
<a name="ln-1443"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">numang</span>
<a name="ln-1444"></a>  <span class="k">read</span> <span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">eu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1445"></a>  <span class="n">FZtmp</span><span class="p">%</span><span class="n">rod</span> <span class="o">=</span> <span class="n">eu2ro</span><span class="p">(</span><span class="n">eu</span><span class="o">*</span><span class="n">dtor</span><span class="p">)</span>
<a name="ln-1446"></a>  <span class="n">FZcnt</span> <span class="o">=</span> <span class="n">FZcnt</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1447"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1448"></a>  <span class="n">FZtmp</span> <span class="o">=&gt;</span> <span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span>
<a name="ln-1449"></a>  <span class="k">nullify</span><span class="p">(</span><span class="n">FZtmp</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1450"></a><span class="k">end do</span>
<a name="ln-1451"></a>
<a name="ln-1452"></a><span class="k">close</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
<a name="ln-1453"></a>
<a name="ln-1454"></a><span class="k">end subroutine </span><span class="n">getEulersfromFile</span>
<a name="ln-1455"></a>
<a name="ln-1456"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1457"></a><span class="c">!</span>
<a name="ln-1458"></a><span class="c">! FUNCTION: IsinsideMFZ</span>
<a name="ln-1459"></a><span class="c">!</span>
<a name="ln-1460"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1461"></a><span class="c">!</span>
<a name="ln-1462"></a><span class="c">!&gt; @brief does Rodrigues point lie inside the relevant Mackenzie (disorientation) FZ</span>
<a name="ln-1463"></a><span class="c">!</span>
<a name="ln-1464"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-1465"></a><span class="c">!&gt; @param MFZtype MFZ type</span>
<a name="ln-1466"></a><span class="c">!&gt; @param MFZorder MFZ order</span>
<a name="ln-1467"></a><span class="c">!</span>
<a name="ln-1468"></a><span class="c">!&gt; @date 09/09/16 MDG 1.0 new routine</span>
<a name="ln-1469"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1470"></a><span class="k">recursive function </span><span class="n">IsinsideMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">MFZtype</span><span class="p">,</span><span class="n">MFZorder</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">insideMFZ</span><span class="p">)</span>
<a name="ln-1471"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: IsinsideMFZ</span>
<a name="ln-1472"></a>
<a name="ln-1473"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1474"></a>
<a name="ln-1475"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1476"></a>
<a name="ln-1477"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1478"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MFZtype</span>
<a name="ln-1479"></a><span class="kt">integer</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">irg</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">MFZorder</span>
<a name="ln-1480"></a><span class="kt">logical</span>                                 <span class="kd">::</span> <span class="n">insideMFZ</span>
<a name="ln-1481"></a>
<a name="ln-1482"></a>  <span class="k">select case</span> <span class="p">(</span><span class="n">MFZtype</span><span class="p">)</span>
<a name="ln-1483"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-1484"></a>      <span class="n">insideMFZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>   <span class="c">! all points are inside the FZ</span>
<a name="ln-1485"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1486"></a>      <span class="n">insideMFZ</span> <span class="o">=</span> <span class="n">insideCyclicFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">MFZtype</span><span class="p">,</span><span class="n">MFZorder</span><span class="p">)</span>        <span class="c">! infinity is checked inside this function</span>
<a name="ln-1487"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1488"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideMFZ</span> <span class="o">=</span> <span class="n">insideDihedralMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">MFZorder</span><span class="p">)</span>
<a name="ln-1489"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1490"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideMFZ</span> <span class="o">=</span> <span class="n">insideCubicMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="s1">&#39;tet&#39;</span><span class="p">)</span>
<a name="ln-1491"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1492"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">inftyd</span><span class="p">)</span> <span class="n">insideMFZ</span> <span class="o">=</span> <span class="n">insideCubicMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="s1">&#39;oct&#39;</span><span class="p">)</span>
<a name="ln-1493"></a>  <span class="k">end select</span>
<a name="ln-1494"></a>
<a name="ln-1495"></a><span class="k">end function </span><span class="n">IsinsideMFZ</span>
<a name="ln-1496"></a>
<a name="ln-1497"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1498"></a><span class="c">!</span>
<a name="ln-1499"></a><span class="c">! FUNCTION: insideCubicMFZ</span>
<a name="ln-1500"></a><span class="c">!</span>
<a name="ln-1501"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1502"></a><span class="c">!</span>
<a name="ln-1503"></a><span class="c">!&gt; @brief does Rodrigues point lie inside cubic MacKenzie FZ (octahedral or tetrahedral)?</span>
<a name="ln-1504"></a><span class="c">!</span>
<a name="ln-1505"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-1506"></a><span class="c">!&gt; @param ot &#39;oct&#39; or &#39;tet&#39;, depending on symmetry</span>
<a name="ln-1507"></a><span class="c">!</span>
<a name="ln-1508"></a><span class="c">!&gt; @date 09/09/16 MDG 1.0 original</span>
<a name="ln-1509"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1510"></a><span class="k">recursive function </span><span class="n">insideCubicMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">ot</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-1511"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideCubicMFZ</span>
<a name="ln-1512"></a>
<a name="ln-1513"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1514"></a>
<a name="ln-1515"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1516"></a>
<a name="ln-1517"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1518"></a><span class="kt">character</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">ot</span>
<a name="ln-1519"></a>
<a name="ln-1520"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span>
<a name="ln-1521"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1522"></a>
<a name="ln-1523"></a><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1524"></a>
<a name="ln-1525"></a><span class="c">! first of all, we need to be inside the regular FZ</span>
<a name="ln-1526"></a><span class="n">c0</span> <span class="o">=</span> <span class="n">insideCubicFz</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">ot</span><span class="p">)</span>
<a name="ln-1527"></a>
<a name="ln-1528"></a><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1529"></a>
<a name="ln-1530"></a><span class="k">if</span> <span class="p">(</span><span class="n">ot</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;oct&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1531"></a><span class="k">  </span><span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">))</span>
<a name="ln-1532"></a>  <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-1533"></a>  <span class="n">c3</span> <span class="o">=</span> <span class="p">(</span><span class="n">c2</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> 
<a name="ln-1534"></a><span class="k">else </span>
<a name="ln-1535"></a><span class="k">  </span><span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="nb">minval</span><span class="p">(</span><span class="n">r</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">))</span>  <span class="c">! in the first octant</span>
<a name="ln-1536"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1537"></a><span class="k">    </span><span class="n">c3</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-1538"></a>  <span class="k">else</span>
<a name="ln-1539"></a><span class="k">    </span><span class="n">c3</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<a name="ln-1540"></a>  <span class="k">end if</span>
<a name="ln-1541"></a><span class="k">end if</span>
<a name="ln-1542"></a>
<a name="ln-1543"></a><span class="n">res</span> <span class="o">=</span> <span class="n">c3</span>
<a name="ln-1544"></a>
<a name="ln-1545"></a><span class="k">end function </span><span class="n">insideCubicMFZ</span>
<a name="ln-1546"></a>
<a name="ln-1547"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1548"></a><span class="c">!</span>
<a name="ln-1549"></a><span class="c">! FUNCTION: insideDihedralMFZ</span>
<a name="ln-1550"></a><span class="c">!</span>
<a name="ln-1551"></a><span class="c">!&gt; @author Marc De Graef, Carnegie Mellon University</span>
<a name="ln-1552"></a><span class="c">!</span>
<a name="ln-1553"></a><span class="c">!&gt; @brief does Rodrigues point lie inside cubic MacKenzie FZ (octahedral or tetrahedral)?</span>
<a name="ln-1554"></a><span class="c">!</span>
<a name="ln-1555"></a><span class="c">!&gt; @param rod Rodrigues coordinates  (double precision)</span>
<a name="ln-1556"></a><span class="c">!&gt; @param ot &#39;oct&#39; or &#39;tet&#39;, depending on symmetry</span>
<a name="ln-1557"></a><span class="c">!</span>
<a name="ln-1558"></a><span class="c">!&gt; @date 09/09/16 MDG 1.0 original</span>
<a name="ln-1559"></a><span class="c">!&gt; @date 09/15/16 MDG 1.0 completed all orders</span>
<a name="ln-1560"></a><span class="c">!--------------------------------------------------------------------------</span>
<a name="ln-1561"></a><span class="k">recursive function </span><span class="n">insideDihedralMFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">MFZorder</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-1562"></a><span class="c">!DEC$ ATTRIBUTES DLLEXPORT :: insideDihedralMFZ</span>
<a name="ln-1563"></a>
<a name="ln-1564"></a><span class="k">use </span><span class="n">constants</span>
<a name="ln-1565"></a>
<a name="ln-1566"></a><span class="k">IMPLICIT NONE</span>
<a name="ln-1567"></a>
<a name="ln-1568"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1569"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">MFZorder</span>
<a name="ln-1570"></a>
<a name="ln-1571"></a><span class="kt">logical</span>                                   <span class="kd">::</span> <span class="n">res</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span>
<a name="ln-1572"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1573"></a><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dbl</span><span class="p">),</span><span class="k">parameter</span>                  <span class="kd">::</span> <span class="n">v</span> <span class="o">=</span> <span class="mf">0.57735026918962584D0</span>
<a name="ln-1574"></a>
<a name="ln-1575"></a><span class="c">! v = 1.0/dsqrt(3.D0)</span>
<a name="ln-1576"></a>
<a name="ln-1577"></a><span class="n">res</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1578"></a>
<a name="ln-1579"></a><span class="c">! first of all, we need to be inside the regular FZ</span>
<a name="ln-1580"></a><span class="n">c0</span> <span class="o">=</span> <span class="n">insideDihedralFZ</span><span class="p">(</span><span class="n">rod</span><span class="p">,</span><span class="n">MFZorder</span><span class="p">)</span>
<a name="ln-1581"></a>
<a name="ln-1582"></a><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">rod</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">rod</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1583"></a>
<a name="ln-1584"></a><span class="k">if</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1585"></a><span class="k">select case</span> <span class="p">(</span><span class="n">MFZorder</span><span class="p">)</span>
<a name="ln-1586"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1587"></a>      <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">r</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span>
<a name="ln-1588"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1589"></a>      <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span> <span class="p">(</span><span class="o">/</span> <span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span><span class="p">)</span> <span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span>
<a name="ln-1590"></a>      <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="nb">dabs</span><span class="p">(</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">v</span><span class="p">))</span> 
<a name="ln-1591"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1592"></a>      <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">r</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span>
<a name="ln-1593"></a>      <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> 
<a name="ln-1594"></a>    <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-1595"></a>      <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">r</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mf">0.D0</span><span class="p">)</span>
<a name="ln-1596"></a>      <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">))</span> 
<a name="ln-1597"></a>  <span class="k">end select</span>
<a name="ln-1598"></a><span class="k">end if</span>
<a name="ln-1599"></a>
<a name="ln-1600"></a><span class="n">res</span> <span class="o">=</span> <span class="n">c2</span>
<a name="ln-1601"></a>
<a name="ln-1602"></a><span class="k">end function </span><span class="n">insideDihedralMFZ</span>
<a name="ln-1603"></a>
<a name="ln-1604"></a>
<a name="ln-1605"></a>
<a name="ln-1606"></a>
<a name="ln-1607"></a>
<a name="ln-1608"></a><span class="k">end module </span><span class="n">so3</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a></p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Fortran Program was developed by Marc De Graef Research Group/Carnegie Mellon University</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>