<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="EMsoft main library">
    
    <meta name="author" content="Marc De Graef Research Group/Carnegie Mellon University" >
    <link rel="icon" href="../favicon.png">

    <title>simulated_annealing.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>simulated_annealing.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 4.9% of total for source files.">1486 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/simulated_annealing.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">simulated_annealing.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/simann.html">SimAnn</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html#src">simulated_annealing.f90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: sourcefile~~simulated_annealing.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilesimulated_annealingf90EfferentGraph" width="527pt" height="352pt"
 viewBox="0.00 0.00 527.00 352.42" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 348.424)">
<title>sourcefile~~simulated_annealing.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-348.424 523,-348.424 523,4 -4,4"/>
<!-- sourcefile~simulated_annealing.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node1" class="node"><title>sourcefile~simulated_annealing.f90</title>
<polygon fill="none" stroke="black" points="519,-211 393,-211 393,-187 519,-187 519,-211"/>
<text text-anchor="middle" x="456" y="-196.6" font-family="Helvetica,sans-Serif" font-size="10.50">simulated_annealing.f90</text>
</g>
<!-- sourcefile~others.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node2" class="node"><title>sourcefile~others.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/others.f90.html" xlink:title="others.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="348,-232 289,-232 289,-208 348,-208 348,-232"/>
<text text-anchor="middle" x="318.5" y="-217.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">others.f90</text>
</a>
</g>
</g>
<!-- sourcefile~others.f90&#45;&gt;sourcefile~simulated_annealing.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge14" class="edge"><title>sourcefile~others.f90&#45;&gt;sourcefile~simulated_annealing.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M348.236,-215.546C358.534,-213.95 370.657,-212.072 382.968,-210.164"/>
<polygon fill="#ff0000" stroke="#ff0000" points="383.506,-213.622 392.852,-208.632 382.433,-206.705 383.506,-213.622"/>
</g>
<!-- sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node3" class="node"><title>sourcefile~emdymod.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/emdymod.f90.html" xlink:title="EMdymod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="357,-190 280,-190 280,-166 357,-166 357,-190"/>
<text text-anchor="middle" x="318.5" y="-175.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">EMdymod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~emdymod.f90&#45;&gt;sourcefile~simulated_annealing.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge15" class="edge"><title>sourcefile~emdymod.f90&#45;&gt;sourcefile~simulated_annealing.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M357.244,-183.85C365.267,-185.093 373.992,-186.445 382.818,-187.813"/>
<polygon fill="#ff0000" stroke="#ff0000" points="382.376,-191.286 392.794,-189.359 383.448,-184.369 382.376,-191.286"/>
</g>
<!-- sourcefile~indexingmod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node4" class="node"><title>sourcefile~indexingmod.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node4"><a xlink:href="../sourcefile/indexingmod.f90.html" xlink:title="Indexingmod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="244,-310 154,-310 154,-286 244,-286 244,-310"/>
<text text-anchor="middle" x="199" y="-295.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Indexingmod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~indexingmod.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge5" class="edge"><title>sourcefile~indexingmod.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M226.034,-285.963C232.453,-282.144 238.933,-277.466 244,-272 268.595,-245.472 255.098,-225.24 280,-199 280.896,-198.056 281.843,-197.144 282.832,-196.262"/>
<polygon fill="#00ffff" stroke="#00ffff" points="285.121,-198.921 291.02,-190.12 280.92,-193.321 285.121,-198.921"/>
</g>
<!-- sourcefile~timing.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node5" class="node"><title>sourcefile~timing.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node5"><a xlink:href="../sourcefile/timing.f90.html" xlink:title="timing.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="228,-230 170,-230 170,-206 228,-206 228,-230"/>
<text text-anchor="middle" x="199" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timing.f90</text>
</a>
</g>
</g>
<!-- sourcefile~timing.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge6" class="edge"><title>sourcefile~timing.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M228.144,-208.419C241.399,-203.907 257.538,-198.413 272.434,-193.342"/>
<polygon fill="#00ffff" stroke="#00ffff" points="273.662,-196.621 282.001,-190.085 271.406,-189.994 273.662,-196.621"/>
</g>
<!-- sourcefile~filters.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node6" class="node"><title>sourcefile~filters.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node6"><a xlink:href="../sourcefile/filters.f90.html" xlink:title="filters.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="226.5,-150 171.5,-150 171.5,-126 226.5,-126 226.5,-150"/>
<text text-anchor="middle" x="199" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">filters.f90</text>
</a>
</g>
</g>
<!-- sourcefile~filters.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge7" class="edge"><title>sourcefile~filters.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M226.663,-147.077C240.104,-151.652 256.778,-157.329 272.157,-162.564"/>
<polygon fill="#00ffff" stroke="#00ffff" points="271.435,-166.016 282.029,-165.925 273.691,-159.389 271.435,-166.016"/>
</g>
<!-- sourcefile~initializers.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node7" class="node"><title>sourcefile~initializers.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node7"><a xlink:href="../sourcefile/initializers.f90.html" xlink:title="initializers.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="237,-108 161,-108 161,-84 237,-84 237,-108"/>
<text text-anchor="middle" x="199" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">initializers.f90</text>
</a>
</g>
</g>
<!-- sourcefile~initializers.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge8" class="edge"><title>sourcefile~initializers.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M228.025,-108.093C233.457,-110.791 239.009,-113.808 244,-117 263.268,-129.324 283.11,-146.075 297.314,-158.906"/>
<polygon fill="#00ffff" stroke="#00ffff" points="295.246,-161.759 304.978,-165.945 299.98,-156.603 295.246,-161.759"/>
</g>
<!-- sourcefile~multibeams.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node8" class="node"><title>sourcefile~multibeams.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node8"><a xlink:href="../sourcefile/multibeams.f90.html" xlink:title="multibeams.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="241,-66 157,-66 157,-42 241,-42 241,-66"/>
<text text-anchor="middle" x="199" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">multibeams.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multibeams.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge9" class="edge"><title>sourcefile~multibeams.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M230.582,-66.0896C235.326,-68.6555 239.98,-71.6266 244,-75 271.682,-98.2292 294.137,-134.135 306.652,-156.834"/>
<polygon fill="#00ffff" stroke="#00ffff" points="303.584,-158.518 311.394,-165.678 309.754,-155.211 303.584,-158.518"/>
</g>
<!-- sourcefile~clsupport.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node9" class="node"><title>sourcefile~clsupport.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node9"><a xlink:href="../sourcefile/clsupport.f90.html" xlink:title="CLsupport.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="98,-340 20,-340 20,-316 98,-316 98,-340"/>
<text text-anchor="middle" x="59" y="-325.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">CLsupport.f90</text>
</a>
</g>
</g>
<!-- sourcefile~clsupport.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge10" class="edge"><title>sourcefile~clsupport.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M98.2076,-337.874C138.799,-345.93 202.696,-351.329 244,-319 287.847,-284.68 245.166,-242.44 280,-199 280.592,-198.261 281.218,-197.544 281.872,-196.849"/>
<polygon fill="#00ffff" stroke="#00ffff" points="284.373,-199.318 289.761,-190.195 279.86,-193.967 284.373,-199.318"/>
</g>
<!-- sourcefile~clsupport.f90&#45;&gt;sourcefile~indexingmod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~clsupport.f90&#45;&gt;sourcefile~indexingmod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M98.0744,-319.723C112.21,-316.65 128.53,-313.102 143.828,-309.776"/>
<polygon fill="#ff0000" stroke="#ff0000" points="144.673,-313.175 153.701,-307.63 143.186,-306.334 144.673,-313.175"/>
</g>
<!-- sourcefile~namelisttypedefs.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node10" class="node"><title>sourcefile~namelisttypedefs.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node10"><a xlink:href="../sourcefile/namelisttypedefs.f90.html" xlink:title="NameListTypedefs.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="118,-279 0,-279 0,-255 118,-255 118,-279"/>
<text text-anchor="middle" x="59" y="-264.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">NameListTypedefs.f90</text>
</a>
</g>
</g>
<!-- sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge11" class="edge"><title>sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M118.308,-268.041C156.171,-266.406 205.462,-259.779 244,-239 265.052,-227.649 261.316,-213.932 280,-199 281.363,-197.911 282.789,-196.846 284.256,-195.809"/>
<polygon fill="#00ffff" stroke="#00ffff" points="286.43,-198.572 292.945,-190.217 282.642,-192.686 286.43,-198.572"/>
</g>
<!-- sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~indexingmod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~namelisttypedefs.f90&#45;&gt;sourcefile~indexingmod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M113.75,-279.074C123.739,-281.318 134.178,-283.663 144.17,-285.908"/>
<polygon fill="#ff0000" stroke="#ff0000" points="143.456,-289.335 153.98,-288.112 144.991,-282.505 143.456,-289.335"/>
</g>
<!-- sourcefile~distortion.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node11" class="node"><title>sourcefile~distortion.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node11"><a xlink:href="../sourcefile/distortion.f90.html" xlink:title="distortion.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="235.5,-24 162.5,-24 162.5,-0 235.5,-0 235.5,-24"/>
<text text-anchor="middle" x="199" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">distortion.f90</text>
</a>
</g>
</g>
<!-- sourcefile~distortion.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge12" class="edge"><title>sourcefile~distortion.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M231.944,-24.0995C236.308,-26.6166 240.487,-29.5702 244,-33 280.127,-68.2755 301.656,-125.064 311.347,-156.068"/>
<polygon fill="#00ffff" stroke="#00ffff" points="308.064,-157.305 314.285,-165.881 314.77,-155.297 308.064,-157.305"/>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_node12" class="node"><title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~simulated_annealing.f90~~EfferentGraph_node12"><a xlink:href="../sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="96.5,-150 21.5,-150 21.5,-126 96.5,-126 96.5,-150"/>
<text text-anchor="middle" x="59" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~emdymod.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge13" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~emdymod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M96.8803,-147.172C114.145,-151.226 135.04,-155.789 154,-159 192.644,-165.544 236.812,-170.53 269.492,-173.748"/>
<polygon fill="#00ffff" stroke="#00ffff" points="269.387,-177.254 279.677,-174.731 270.059,-170.287 269.387,-177.254"/>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~filters.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~filters.f90</title>
<path fill="none" stroke="#aaff00" stroke-dasharray="5,2" d="M96.6192,-138C116.519,-138 141.065,-138 161.02,-138"/>
<polygon fill="#aaff00" stroke="#aaff00" points="161.281,-141.5 171.281,-138 161.281,-134.5 161.281,-141.5"/>
</g>
<!-- sourcefile~constants.f90&#45;&gt;sourcefile~initializers.f90 -->
<g id="sourcefile~~simulated_annealing.f90~~EfferentGraph_edge4" class="edge"><title>sourcefile~constants.f90&#45;&gt;sourcefile~initializers.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M96.6192,-126.855C113.328,-121.77 133.313,-115.687 151.105,-110.272"/>
<polygon fill="#00ff00" stroke="#00ff00" points="152.181,-113.603 160.729,-107.343 150.143,-106.907 152.181,-113.603"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/simann.html">SimAnn</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html#src">simulated_annealing.f90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!============================================================================================</span>
<a name="ln-2"></a><span class="c">!    DDFSA - A Distributed Derivative-free Simulated Annealing Method for</span>
<a name="ln-3"></a><span class="c">!    bound constrained global optimization</span>
<a name="ln-4"></a><span class="c">!    Copyright (C) 2011  G.Liuzzi, S.Lucidi, V.Piccialli</span>
<a name="ln-5"></a><span class="c">!</span>
<a name="ln-6"></a><span class="c">!    This program is free software: you can redistribute it and/or modify</span>
<a name="ln-7"></a><span class="c">!    it under the terms of the GNU General Public License as published by</span>
<a name="ln-8"></a><span class="c">!    the Free Software Foundation, either version 3 of the License, or</span>
<a name="ln-9"></a><span class="c">!    (at your option) any later version.</span>
<a name="ln-10"></a><span class="c">!</span>
<a name="ln-11"></a><span class="c">!    This program is distributed in the hope that it will be useful,</span>
<a name="ln-12"></a><span class="c">!    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="ln-13"></a><span class="c">!    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="ln-14"></a><span class="c">!    GNU General Public License for more details.</span>
<a name="ln-15"></a><span class="c">!</span>
<a name="ln-16"></a><span class="c">!    You should have received a copy of the GNU General Public License</span>
<a name="ln-17"></a><span class="c">!    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="ln-18"></a><span class="c">!</span>
<a name="ln-19"></a><span class="c">!    G. Liuzzi, S. Lucidi, V. Piccialli, A. Sotgiu. A magnetic resonance device designed via </span>
<a name="ln-20"></a><span class="c">!    global optimization techniques, Mathematical Programming, 101: 339-364 (2004)</span>
<a name="ln-21"></a><span class="c">!</span>
<a name="ln-22"></a><span class="c">!============================================================================================</span>
<a name="ln-23"></a><span class="k">module </span><span class="n">SimAnn</span>
<a name="ln-24"></a>
<a name="ln-25"></a><span class="k">use </span><span class="n">local</span>
<a name="ln-26"></a><span class="k">use </span><span class="n">others</span>
<a name="ln-27"></a><span class="k">use </span><span class="n">EMdymod</span>
<a name="ln-28"></a>
<a name="ln-29"></a><span class="k">abstract interface</span>
<a name="ln-30"></a><span class="k">        recursive subroutine </span><span class="n">func</span> <span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fpar</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-31"></a>                                   <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>  <span class="c">!! calfun interface</span>
<a name="ln-32"></a>
<a name="ln-33"></a>            <span class="k">use </span><span class="n">local</span>
<a name="ln-34"></a> 
<a name="ln-35"></a>            <span class="k">implicit none</span>
<a name="ln-36"></a>
<a name="ln-37"></a><span class="k">            </span><span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-38"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fpar</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-39"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-40"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-41"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-42"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-43"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-44"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-45"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-46"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-47"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">n</span>
<a name="ln-48"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">dbl</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">x</span>
<a name="ln-49"></a>            <span class="kt">real</span><span class="p">(</span><span class="n">dbl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">f</span>
<a name="ln-50"></a>            <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-51"></a>        <span class="k">end subroutine </span><span class="n">func</span>
<a name="ln-52"></a>    <span class="k">end interface</span>
<a name="ln-53"></a>
<a name="ln-54"></a>
<a name="ln-55"></a><span class="k">contains</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="k">      recursive subroutine </span><span class="n">linesearchbox_cont</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="n">i_corr</span><span class="p">,</span><span class="n">num_fal</span><span class="p">,&amp;</span>
<a name="ln-58"></a>                                 <span class="n">alfa_max</span><span class="p">,</span><span class="n">iprint</span><span class="p">,</span><span class="n">bl</span><span class="p">,</span><span class="n">bu</span><span class="p">,</span><span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,&amp;</span>
<a name="ln-59"></a>                                 <span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-60"></a>      
<a name="ln-61"></a><span class="c">!      SUBROUTINE LINESEARCH_INVERTI(N,X,F,D,ALFA,DOLDALFA,Z,FZ,</span>
<a name="ln-62"></a><span class="c">!     *I_CORR,NUM_FAL,DALFAMAX,IPRINT)</span>
<a name="ln-63"></a>
<a name="ln-64"></a>      <span class="k">implicit none</span>
<a name="ln-65"></a>
<a name="ln-66"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span><span class="p">,</span><span class="n">i_corr</span><span class="p">,</span><span class="n">nf</span>
<a name="ln-67"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-68"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ni</span><span class="p">,</span><span class="n">num_fal</span>
<a name="ln-69"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iprint</span><span class="p">,</span><span class="n">i_corr_fall</span>
<a name="ln-70"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">ifront</span><span class="p">,</span><span class="n">ielle</span>
<a name="ln-71"></a>      <span class="kt">real</span><span class="o">*</span><span class="mi">8</span>  <span class="kd">::</span> <span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">d</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">z</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">bl</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">bu</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a name="ln-72"></a>      <span class="kt">real</span><span class="o">*</span><span class="mi">8</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="n">alfa_max</span><span class="p">,</span><span class="n">alfaex</span><span class="p">,</span> <span class="n">fz</span><span class="p">,</span><span class="nb">gamma</span><span class="p">,</span> <span class="n">gamma_int</span>
<a name="ln-73"></a>      <span class="kt">real</span><span class="o">*</span><span class="mi">8</span>  <span class="kd">::</span> <span class="n">delta</span><span class="p">,</span><span class="n">delta1</span><span class="p">,</span><span class="n">fpar</span><span class="p">,</span><span class="n">fzdelta</span>
<a name="ln-74"></a>
<a name="ln-75"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-76"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-77"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-78"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-79"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-80"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-81"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-82"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-83"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-84"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-85"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-86"></a>      <span class="k">procedure</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-87"></a>
<a name="ln-88"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NF</span>
<a name="ln-89"></a>	  
<a name="ln-90"></a>	  <span class="nb">gamma</span><span class="o">=</span><span class="mf">1.d-6</span>    
<a name="ln-91"></a>
<a name="ln-92"></a>      <span class="n">delta</span> <span class="o">=</span><span class="mf">0.5d0</span>
<a name="ln-93"></a>      <span class="n">delta1</span> <span class="o">=</span><span class="mf">0.5d0</span>
<a name="ln-94"></a>
<a name="ln-95"></a>      <span class="n">i_corr_fall</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-96"></a>
<a name="ln-97"></a>	  <span class="n">ifront</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-98"></a>
<a name="ln-99"></a>
<a name="ln-100"></a>      <span class="n">j</span><span class="o">=</span><span class="n">i_corr</span>
<a name="ln-101"></a>
<a name="ln-102"></a>	  <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-103"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;variabile continua  j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39; alfa=&#39;</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-104"></a>			<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;variabile continua  j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39; alfa=&#39;</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-105"></a>	  <span class="n">endif</span>
<a name="ln-106"></a>
<a name="ln-107"></a>
<a name="ln-108"></a>	  <span class="k">if</span><span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)).</span><span class="n">le</span><span class="p">.</span><span class="mf">1.d-3</span><span class="o">*</span><span class="n">dmin1</span><span class="p">(</span><span class="mf">1.d0</span><span class="p">,</span><span class="n">alfa_max</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-109"></a><span class="k">			</span><span class="n">alfa</span><span class="o">=</span><span class="mf">0.d0</span>
<a name="ln-110"></a>			<span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-111"></a><span class="k">				 write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;  alfa piccolo&#39;</span>
<a name="ln-112"></a>				 <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;  alfa piccolo&#39;</span>
<a name="ln-113"></a>				 <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; alfa_d(j)=&#39;</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;    alfamax=&#39;</span><span class="p">,</span><span class="n">alfa_max</span>
<a name="ln-114"></a>				 <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; alfa_d(j)=&#39;</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;    alfamax=&#39;</span><span class="p">,</span><span class="n">alfa_max</span>
<a name="ln-115"></a>			<span class="n">endif</span>
<a name="ln-116"></a>			<span class="k">return</span>
<a name="ln-117"></a><span class="k">	  </span><span class="n">endif</span>
<a name="ln-118"></a>      
<a name="ln-119"></a>
<a name="ln-120"></a>	  <span class="k">do </span><span class="n">ielle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-121"></a>
<a name="ln-122"></a>		 <span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-123"></a>
<a name="ln-124"></a><span class="k">		     if</span><span class="p">((</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">bu</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">))).</span><span class="n">lt</span><span class="p">.(</span><span class="o">-</span><span class="mf">1.d-6</span><span class="p">))</span> <span class="k">then                 </span>
<a name="ln-125"></a><span class="k">   			    </span><span class="n">alfa</span><span class="o">=</span><span class="n">dmax1</span><span class="p">(</span><span class="mf">1.d-24</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a name="ln-126"></a>			 <span class="k">else</span>
<a name="ln-127"></a><span class="k">			    </span><span class="n">alfa</span><span class="o">=</span><span class="n">bu</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-128"></a>				<span class="n">ifront</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-129"></a>				<span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-130"></a><span class="k">					   write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front. *&#39;</span>
<a name="ln-131"></a>					   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front. *&#39;</span>
<a name="ln-132"></a>				<span class="n">endif</span>
<a name="ln-133"></a>			 <span class="n">endif</span>
<a name="ln-134"></a>
<a name="ln-135"></a>		  <span class="k">else</span>
<a name="ln-136"></a>
<a name="ln-137"></a><span class="k">			 if</span><span class="p">((</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">bl</span><span class="p">(</span><span class="n">j</span><span class="p">))).</span><span class="n">lt</span><span class="p">.(</span><span class="o">-</span><span class="mf">1.d-6</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-138"></a><span class="k">			    </span><span class="n">alfa</span><span class="o">=</span><span class="n">dmax1</span><span class="p">(</span><span class="mf">1.d-24</span><span class="p">,</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a name="ln-139"></a>			 <span class="k">else</span>
<a name="ln-140"></a><span class="k">				</span><span class="n">alfa</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">bl</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-141"></a>				<span class="n">ifront</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-142"></a>				<span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-143"></a><span class="k">					   write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front. *&#39;</span>
<a name="ln-144"></a>					   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front. *&#39;</span>
<a name="ln-145"></a>				<span class="n">endif</span>
<a name="ln-146"></a>			 <span class="n">endif</span>
<a name="ln-147"></a>
<a name="ln-148"></a>		  <span class="n">endif</span>
<a name="ln-149"></a>
<a name="ln-150"></a>		  <span class="k">if</span><span class="p">(</span><span class="nb">dabs</span><span class="p">(</span><span class="n">alfa</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="mf">1.d-3</span><span class="o">*</span><span class="n">dmin1</span><span class="p">(</span><span class="mf">1.d0</span><span class="p">,</span><span class="n">alfa_max</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-151"></a><span class="k">  </span>
<a name="ln-152"></a><span class="k">			 </span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=-</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-153"></a>			 <span class="n">i_corr_fall</span><span class="o">=</span><span class="n">i_corr_fall</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-154"></a>			 <span class="n">ifront</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-155"></a>
<a name="ln-156"></a>			 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-157"></a><span class="k">				   write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta per alfa piccolo&#39;</span>
<a name="ln-158"></a>				   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta per alfa piccolo&#39;</span>
<a name="ln-159"></a>				   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-160"></a>				   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-161"></a>				   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; alfa=&#39;</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="s1">&#39;    alfamax=&#39;</span><span class="p">,</span><span class="n">alfa_max</span>
<a name="ln-162"></a>				   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; alfa=&#39;</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="s1">&#39;    alfamax=&#39;</span><span class="p">,</span><span class="n">alfa_max</span>
<a name="ln-163"></a>			  <span class="n">endif</span>
<a name="ln-164"></a>			  <span class="n">alfa</span><span class="o">=</span><span class="mf">0.d0</span>
<a name="ln-165"></a>			  <span class="k">cycle</span>
<a name="ln-166"></a>
<a name="ln-167"></a><span class="k">		  </span><span class="n">endif</span>
<a name="ln-168"></a>
<a name="ln-169"></a>		  <span class="n">alfaex</span><span class="o">=</span><span class="n">alfa</span>
<a name="ln-170"></a>
<a name="ln-171"></a>		  <span class="n">z</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">alfa</span><span class="o">*</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-172"></a>	  
<a name="ln-173"></a>		  <span class="c">!call funct(z,n,fz)</span>
<a name="ln-174"></a>                  <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-175"></a>                                <span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fz</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-176"></a>
<a name="ln-177"></a>
<a name="ln-178"></a>		  <span class="n">nf</span><span class="o">=</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-179"></a>
<a name="ln-180"></a>		  <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-181"></a><span class="k">				write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-182"></a>				<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-183"></a>		  <span class="n">endif</span>
<a name="ln-184"></a>		  <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-185"></a><span class="k">			  do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-186"></a>				  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; z(&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-187"></a>				  <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; z(&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-188"></a>			  <span class="n">enddo</span>
<a name="ln-189"></a>		  <span class="n">endif</span>
<a name="ln-190"></a>
<a name="ln-191"></a>		  <span class="n">fpar</span><span class="o">=</span> <span class="n">f</span><span class="o">-</span><span class="nb">gamma</span><span class="o">*</span><span class="n">alfa</span><span class="o">*</span><span class="n">alfa</span>
<a name="ln-192"></a>
<a name="ln-193"></a>
<a name="ln-194"></a>		  <span class="k">if</span><span class="p">(</span><span class="n">fz</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">fpar</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-195"></a>
<a name="ln-196"></a>
<a name="ln-197"></a><span class="k">			 do</span>
<a name="ln-198"></a>
<a name="ln-199"></a><span class="k">				  if</span><span class="p">((</span><span class="n">ifront</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-200"></a>
<a name="ln-201"></a><span class="k">			         if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-202"></a><span class="k">				         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; accetta punto sulla frontiera fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-203"></a>				         <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; accetta punto sulla frontiera fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-204"></a>			         <span class="n">endif</span>
<a name="ln-205"></a>				     <span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="n">alfa</span>
<a name="ln-206"></a>
<a name="ln-207"></a>				     <span class="k">return</span>
<a name="ln-208"></a>
<a name="ln-209"></a><span class="k">				 end if</span>
<a name="ln-210"></a>
<a name="ln-211"></a><span class="k">				 if</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mf">0.d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">							</span>
<a name="ln-213"></a><span class="k">					 if</span><span class="p">((</span><span class="n">alfa</span><span class="o">/</span><span class="n">delta1</span><span class="o">-</span><span class="p">(</span><span class="n">bu</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">))).</span><span class="n">lt</span><span class="p">.(</span><span class="o">-</span><span class="mf">1.d-6</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-214"></a><span class="k">						 </span><span class="n">alfaex</span><span class="o">=</span><span class="n">alfa</span><span class="o">/</span><span class="n">delta1</span>
<a name="ln-215"></a>					 <span class="k">else</span>
<a name="ln-216"></a><span class="k">						 </span><span class="n">alfaex</span><span class="o">=</span><span class="n">bu</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-217"></a>						 <span class="n">ifront</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-218"></a>						 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-219"></a><span class="k">							write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front.&#39;</span>
<a name="ln-220"></a>							<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front.&#39;</span>
<a name="ln-221"></a>						 <span class="n">endif</span>
<a name="ln-222"></a>					 <span class="k">end if</span>
<a name="ln-223"></a>
<a name="ln-224"></a><span class="k">				 else</span>
<a name="ln-225"></a>
<a name="ln-226"></a><span class="k">					 if</span><span class="p">((</span><span class="n">alfa</span><span class="o">/</span><span class="n">delta1</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">bl</span><span class="p">(</span><span class="n">j</span><span class="p">))).</span><span class="n">lt</span><span class="p">.(</span><span class="o">-</span><span class="mf">1.d-6</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-227"></a><span class="k">						 </span><span class="n">alfaex</span><span class="o">=</span><span class="n">alfa</span><span class="o">/</span><span class="n">delta1</span>
<a name="ln-228"></a>					 <span class="k">else</span>
<a name="ln-229"></a><span class="k">						 </span><span class="n">alfaex</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">bl</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-230"></a>						 <span class="n">ifront</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-231"></a>						 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-232"></a><span class="k">							write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front.&#39;</span>
<a name="ln-233"></a>							<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; punto espan. sulla front.&#39;</span>
<a name="ln-234"></a>						 <span class="n">endif</span>
<a name="ln-235"></a>					 <span class="k">end if</span>
<a name="ln-236"></a>
<a name="ln-237"></a><span class="k">				 </span><span class="n">endif</span>
<a name="ln-238"></a>						 
<a name="ln-239"></a>				 <span class="n">z</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">alfaex</span><span class="o">*</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> 
<a name="ln-240"></a>				   
<a name="ln-241"></a>     
<a name="ln-242"></a>				 
<a name="ln-243"></a>			     <span class="c">!call funct(z,n,fzdelta)</span>
<a name="ln-244"></a>			     <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-245"></a>                                <span class="n">n</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fzdelta</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-246"></a>							      
<a name="ln-247"></a>				
<a name="ln-248"></a>				 <span class="n">nf</span><span class="o">=</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-249"></a>
<a name="ln-250"></a>				 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-251"></a><span class="k">					  write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fzex=&#39;</span><span class="p">,</span><span class="n">fzdelta</span><span class="p">,</span><span class="s1">&#39;  alfaex=&#39;</span><span class="p">,</span><span class="n">alfaex</span>  
<a name="ln-252"></a>					  <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fzex=&#39;</span><span class="p">,</span><span class="n">fzdelta</span><span class="p">,</span><span class="s1">&#39;  alfaex=&#39;</span><span class="p">,</span><span class="n">alfaex</span>
<a name="ln-253"></a>				 <span class="n">endif</span>
<a name="ln-254"></a>				 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-255"></a><span class="k">					  do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-256"></a>						 <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; z(&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-257"></a>						 <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; z(&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-258"></a>					  <span class="n">enddo</span>
<a name="ln-259"></a>				 <span class="n">endif</span>
<a name="ln-260"></a>
<a name="ln-261"></a>				 <span class="n">fpar</span><span class="o">=</span> <span class="n">f</span><span class="o">-</span><span class="nb">gamma</span><span class="o">*</span><span class="n">alfaex</span><span class="o">*</span><span class="n">alfaex</span>
<a name="ln-262"></a>
<a name="ln-263"></a>				 <span class="k">if</span><span class="p">(</span><span class="n">fzdelta</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">fpar</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-264"></a>
<a name="ln-265"></a><span class="k">					 </span><span class="n">fz</span><span class="o">=</span><span class="n">fzdelta</span>
<a name="ln-266"></a>					 <span class="n">alfa</span><span class="o">=</span><span class="n">alfaex</span>
<a name="ln-267"></a>
<a name="ln-268"></a>				 <span class="k">else               </span>
<a name="ln-269"></a>
<a name="ln-270"></a><span class="k">					 </span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="n">alfa</span>
<a name="ln-271"></a><span class="c">!					 alfa_d(j)=alfa</span>
<a name="ln-272"></a>			         <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-273"></a><span class="k">				         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; accetta punto fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-274"></a>				         <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; accetta punto fz =&#39;</span><span class="p">,</span><span class="n">fz</span><span class="p">,</span><span class="s1">&#39;   alfa =&#39;</span><span class="p">,</span><span class="n">alfa</span>
<a name="ln-275"></a>			         <span class="n">endif</span>
<a name="ln-276"></a>					 <span class="k">return</span>
<a name="ln-277"></a><span class="k">				 end if</span>
<a name="ln-278"></a>
<a name="ln-279"></a><span class="k">		     </span><span class="n">enddo</span>
<a name="ln-280"></a>		  <span class="k">else      </span>
<a name="ln-281"></a>
<a name="ln-282"></a><span class="k">			 </span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=-</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-283"></a>			 <span class="n">ifront</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-284"></a>
<a name="ln-285"></a>			 <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-286"></a><span class="k">				   write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta&#39;</span>
<a name="ln-287"></a>				   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta&#39;</span>
<a name="ln-288"></a>				   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-289"></a>				   <span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; j =&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;    d(j) =&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-290"></a>			 <span class="n">endif</span>
<a name="ln-291"></a>
<a name="ln-292"></a>		  <span class="n">endif</span>      
<a name="ln-293"></a>			  
<a name="ln-294"></a>	  <span class="n">enddo</span>     
<a name="ln-295"></a>
<a name="ln-296"></a>	  <span class="k">if</span><span class="p">(</span><span class="n">i_corr_fall</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-297"></a><span class="k">			 </span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-298"></a>	  <span class="k">else</span>
<a name="ln-299"></a><span class="k">			 </span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="n">alfa_d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-300"></a>	  <span class="k">end if</span>
<a name="ln-301"></a>
<a name="ln-302"></a><span class="k">	  </span><span class="n">alfa</span><span class="o">=</span><span class="mf">0.d0</span>
<a name="ln-303"></a>
<a name="ln-304"></a>	  <span class="k">if</span><span class="p">(</span><span class="n">iprint</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-305"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fallimento direzione&#39;</span>
<a name="ln-306"></a>			<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; fallimento direzione&#39;</span>
<a name="ln-307"></a>	  <span class="n">endif</span>
<a name="ln-308"></a>
<a name="ln-309"></a>	  <span class="k">return      </span>
<a name="ln-310"></a><span class="k">	  </span>
<a name="ln-311"></a><span class="k">      end</span>
<a name="ln-312"></a>
<a name="ln-313"></a><span class="c">!PROGRAM MAIN_GLOB</span>
<a name="ln-314"></a>
<a name="ln-315"></a><span class="c">!	INTEGER, PARAMETER	:: TABELLA = 14</span>
<a name="ln-316"></a><span class="c">!	INTEGER			:: iok</span>
<a name="ln-317"></a><span class="c">!	INTEGER			:: I, MYDATE(8)</span>
<a name="ln-318"></a><span class="c">!	INTEGER			:: NF, NFAL, NFTOT, NFALTOT</span>
<a name="ln-319"></a><span class="c">!	INTEGER			:: ICHECK		</span>
<a name="ln-320"></a>
<a name="ln-321"></a><span class="c">!	OPEN (TABELLA,FILE=&#39;risultato.tex&#39;,STATUS=&#39;REPLACE&#39;)</span>
<a name="ln-322"></a><span class="c">!	CALL DATE_AND_TIME(VALUES = MYDATE)</span>
<a name="ln-323"></a><span class="c">!	WRITE(TABELLA,1000) MYDATE(3),MYDATE(2),MYDATE(1)</span>
<a name="ln-324"></a>
<a name="ln-325"></a><span class="c">!	CALL SENZADERGLOB(TABELLA,iok)</span>
<a name="ln-326"></a><span class="c">!	</span>
<a name="ln-327"></a><span class="c">!	WRITE(TABELLA,1010)</span>
<a name="ln-328"></a><span class="c">!	CLOSE(TABELLA)</span>
<a name="ln-329"></a>
<a name="ln-330"></a><span class="c">!1020 FORMAT(I6,&#39;  &#39;,I3)</span>
<a name="ln-331"></a><span class="c">!1010 FORMAT(//,&#39;\end{tabular}				&#39;,/,&amp;</span>
<a name="ln-332"></a><span class="c">!&#39;\end{center}				&#39;)</span>
<a name="ln-333"></a>
<a name="ln-334"></a><span class="c">!1000 FORMAT(&#39;\begin{center}\par							&#39;,/,&amp;</span>
<a name="ln-335"></a><span class="c">!&#39;{\bf (&#39;,I2,&#39;/&#39;,I2,&#39;/&#39;,I4,&#39;)}\par			&#39;,/,&amp;</span>
<a name="ln-336"></a><span class="c">!&#39;\begin{tabular}{l|c||c|c|c|c|c|c}			&#39;,/,&amp;</span>
<a name="ln-337"></a><span class="c">!&#39;PROBLEM &amp; n &amp; nF &amp; nFott &amp; F. min &amp; F. medio &amp; F. min &amp; F. medio\\ \hline&#39;,///)</span>
<a name="ln-338"></a>
<a name="ln-339"></a><span class="c">!END PROGRAM</span>
<a name="ln-340"></a>
<a name="ln-341"></a><span class="k">SUBROUTINE </span><span class="n">SENZADERGLOB</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,&amp;</span>
<a name="ln-342"></a>                        <span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">XINF</span><span class="p">)</span>
<a name="ln-343"></a>	<span class="c">!USE IMSLF90</span>
<a name="ln-344"></a>	<span class="k">use </span><span class="n">typedefs</span>
<a name="ln-345"></a>	<span class="k">IMPLICIT NONE</span>
<a name="ln-346"></a>
<a name="ln-347"></a><span class="k">	</span><span class="kt">INTEGER</span><span class="p">,</span> <span class="k">PARAMETER</span>				<span class="kd">::</span> <span class="n">IRUNS</span>      <span class="o">=</span> <span class="mi">10</span>
<a name="ln-348"></a>
<a name="ln-349"></a>	<span class="k">PROCEDURE</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-350"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-351"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-352"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-353"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-354"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-355"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-356"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-357"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-358"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-359"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-360"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-361"></a>      <span class="kt">DOUBLE PRECISION</span><span class="p">,</span>  <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">XINF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">XSUP</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-362"></a>
<a name="ln-363"></a>
<a name="ln-364"></a>
<a name="ln-365"></a><span class="c">!	INCLUDE &#39;TYPEDECL.FI&#39;</span>
<a name="ln-366"></a>
<a name="ln-367"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">N</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">NFAILS</span><span class="p">,</span> <span class="n">IDIMWKS</span><span class="p">,</span> <span class="n">NUMFAL</span><span class="p">,</span> <span class="n">IOTT</span><span class="p">,</span> <span class="n">ISTOP</span>
<a name="ln-368"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">VECTNF</span><span class="p">(</span><span class="n">IRUNS</span><span class="p">),</span> <span class="n">VECTNFOTT</span><span class="p">(</span><span class="n">IRUNS</span><span class="p">)</span>
<a name="ln-369"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">LSTOT</span><span class="p">,</span> <span class="n">NFTOT</span><span class="p">,</span> <span class="n">NPCTOT</span><span class="p">,</span> <span class="n">NLMTOT</span><span class="p">,</span> <span class="n">IT</span><span class="p">,</span> <span class="n">IMAX</span>
<a name="ln-370"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">LS</span><span class="p">,</span> <span class="n">NPC</span><span class="p">,</span> <span class="n">NLM</span><span class="p">,</span> <span class="n">ICONTFAL</span><span class="p">,</span> <span class="n">IDFAL</span><span class="p">,</span> <span class="n">NUMITER</span>
<a name="ln-371"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">NUMCAS</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">MAXLS</span><span class="p">,</span> <span class="n">MODLS</span>
<a name="ln-372"></a>	<span class="kt">INTEGER</span>						<span class="kd">::</span> <span class="n">MAXITER</span><span class="p">,</span> <span class="n">MAXNF</span><span class="p">,</span> <span class="n">PRINT_LEVEL</span><span class="p">,</span> <span class="n">nfott</span><span class="p">,</span> <span class="n">SUMNF</span>
<a name="ln-373"></a>	<span class="kt">INTEGER</span><span class="o">*</span><span class="mi">4</span>					<span class="kd">::</span> <span class="n">IVAR</span><span class="p">,</span> <span class="n">IVAR2</span>
<a name="ln-374"></a>	
<a name="ln-375"></a>	<span class="k">TYPE</span><span class="p">(</span><span class="n">COMP_WKS_TYP</span><span class="p">),</span><span class="k">ALLOCATABLE</span>	<span class="kd">::</span> <span class="n">WKS</span><span class="p">(:)</span>
<a name="ln-376"></a>	<span class="kt">DOUBLE PRECISION</span><span class="p">,</span>  <span class="k">ALLOCATABLE</span>	<span class="kd">::</span> <span class="n">X</span><span class="p">(:),</span> <span class="n">XOTT</span><span class="p">(:),</span> <span class="n">DOLDALFA</span><span class="p">(:)</span>
<a name="ln-377"></a>	<span class="kt">DOUBLE PRECISION</span><span class="p">,</span>  <span class="k">ALLOCATABLE</span>	<span class="kd">::</span> <span class="n">Z</span><span class="p">(:),</span> <span class="n">VETT</span><span class="p">(:),</span> <span class="n">XPROP</span><span class="p">(:),</span> <span class="n">D</span><span class="p">(:)</span>
<a name="ln-378"></a>	<span class="kt">DOUBLE PRECISION</span><span class="p">,</span>  <span class="k">ALLOCATABLE</span>  <span class="kd">::</span> <span class="n">RA</span><span class="p">(:),</span> <span class="n">RB</span><span class="p">(:)</span>
<a name="ln-379"></a>	<span class="kt">INTEGER</span>			<span class="p">,</span>  <span class="k">ALLOCATABLE</span>	<span class="kd">::</span> <span class="n">IPERM</span><span class="p">(:)</span>
<a name="ln-380"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">VECTFVAL</span><span class="p">(</span><span class="n">IRUNS</span><span class="p">),</span> <span class="n">VECTF_OTT</span><span class="p">(</span><span class="n">IRUNS</span><span class="p">)</span>
<a name="ln-381"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">TOL</span><span class="p">,</span> <span class="n">FMAX_EFF</span><span class="p">,</span> <span class="n">fglob</span>
<a name="ln-382"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">RFAL</span><span class="p">,</span> <span class="n">RNUMFAL</span><span class="p">,</span> <span class="n">RMED</span><span class="p">,</span> <span class="n">RMED2</span><span class="p">,</span> <span class="n">f_ott</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">ALFAMAX</span><span class="p">,</span> <span class="n">ALFAOTT</span>
<a name="ln-383"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">FPROP</span><span class="p">,</span> <span class="n">VAR2</span><span class="p">,</span> <span class="n">VAR1</span><span class="p">,</span> <span class="n">ALFA</span><span class="p">,</span> <span class="n">ZETA</span><span class="p">,</span> <span class="n">TRES</span><span class="p">,</span> <span class="n">DIFF</span>
<a name="ln-384"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">FSTOP</span><span class="p">,</span> <span class="n">FSTOPTOL</span><span class="p">,</span> <span class="n">FFSTOP</span>
<a name="ln-385"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">TEMPERATURA</span><span class="p">,</span> <span class="n">SUMITER</span><span class="p">,</span> <span class="n">SUMTIME</span>
<a name="ln-386"></a>	<span class="kt">DOUBLE PRECISION</span>				<span class="kd">::</span> <span class="n">F_MIN</span><span class="p">,</span> <span class="n">F_MIN1</span><span class="p">,</span> <span class="n">F_MAX</span><span class="p">,</span> <span class="n">F_MINTOT</span><span class="p">,</span> <span class="n">F_MINOTT</span><span class="p">,</span> <span class="n">TCOEFF</span><span class="p">,</span> <span class="n">FMIN</span><span class="p">,</span> <span class="n">FMAX</span>
<a name="ln-387"></a>
<a name="ln-388"></a>	<span class="kt">REAL</span>							<span class="kd">::</span> <span class="n">RRAND</span>
<a name="ln-389"></a>	<span class="kt">LOGICAL</span>							<span class="kd">::</span> <span class="n">L_F_DISTANTI</span><span class="p">,</span> <span class="n">L_F_VICINI</span><span class="p">,</span> <span class="n">NON_MINIMIZZ</span><span class="p">,</span> <span class="n">SOLOSULPEGG</span><span class="p">,</span> <span class="n">NORMADUE</span>
<a name="ln-390"></a>	<span class="kt">LOGICAL</span><span class="p">,</span> <span class="k">ALLOCATABLE</span>			<span class="kd">::</span> <span class="n">MASCH</span><span class="p">(:)</span>
<a name="ln-391"></a>
<a name="ln-392"></a>	<span class="kt">CHARACTER</span> <span class="p">(</span> <span class="nb">LEN</span> <span class="o">=</span> <span class="mi">40</span> <span class="p">)</span>			<span class="kd">::</span> <span class="n">nomefun</span>
<a name="ln-393"></a>	<span class="kt">CHARACTER</span> <span class="p">(</span> <span class="nb">LEN</span> <span class="o">=</span> <span class="mi">2</span>  <span class="p">)</span>			<span class="kd">::</span> <span class="n">CSTEP</span>
<a name="ln-394"></a>
<a name="ln-395"></a>	<span class="k">COMMON</span><span class="o">/</span><span class="n">NUMNEW2</span><span class="o">/</span>		<span class="n">NF</span>
<a name="ln-396"></a>	<span class="k">COMMON</span><span class="o">/</span><span class="n">CALFANR2</span><span class="o">/</span>    <span class="n">NORMADUE</span>
<a name="ln-397"></a>
<a name="ln-398"></a>	<span class="n">NFOTT</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-399"></a>
<a name="ln-400"></a><span class="c">!	CALL     NINIT(N)</span>
<a name="ln-401"></a><span class="c">!	CALL FUNCTINIT(N,XINF,XSUP,nomefun,fglob)</span>
<a name="ln-402"></a>        <span class="n">fglob</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-403"></a><span class="c">!-----------------------------------------------</span>
<a name="ln-404"></a><span class="c">!	SETTA LE TOLLERANZE E I MASSIMI</span>
<a name="ln-405"></a><span class="c">!-----------------------------------------------</span>
<a name="ln-406"></a>	<span class="n">TOL</span>         <span class="o">=</span> <span class="mf">1.0D-4</span>
<a name="ln-407"></a>	<span class="n">FSTOPTOL</span>    <span class="o">=</span> <span class="mf">1.0D-15</span>
<a name="ln-408"></a>	<span class="n">MAXITER</span>     <span class="o">=</span> <span class="mi">100000000</span>
<a name="ln-409"></a>	<span class="n">MAXNF</span>       <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">n</span>
<a name="ln-410"></a>	<span class="n">NUMFAL</span>		<span class="o">=</span> <span class="mi">0</span>
<a name="ln-411"></a>	<span class="n">PRINT_LEVEL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-412"></a>	<span class="n">TCOEFF</span>      <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-413"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-414"></a><span class="c">!	modificato il 23/9/2003</span>
<a name="ln-415"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-416"></a><span class="c">!	IDIMWKS     = 20 !MIN(10*N,10)</span>
<a name="ln-417"></a><span class="c">!	IDIMWKS     = MAX(10,N)</span>
<a name="ln-418"></a>	<span class="n">IDIMWKS</span>     <span class="o">=</span> <span class="nb">MIN</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<a name="ln-419"></a>
<a name="ln-420"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-421"></a>	<span class="n">SOLOSULPEGG</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-422"></a>	<span class="n">NORMADUE</span>    <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-423"></a><span class="c">!-----------------------------------------------</span>
<a name="ln-424"></a>	<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOTT</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">VETT</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XPROP</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-425"></a>	<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-426"></a>	<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">RA</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">),</span><span class="n">RB</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">),</span><span class="n">IPERM</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">))</span>
<a name="ln-427"></a><span class="c">!</span>
<a name="ln-428"></a><span class="c">!	-------</span>
<a name="ln-429"></a><span class="c">!	 Iniz.</span>
<a name="ln-430"></a><span class="c">!	-------</span>
<a name="ln-431"></a><span class="c">!</span>
<a name="ln-432"></a>	<span class="n">LSTOT</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-433"></a>	<span class="n">NFTOT</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-434"></a>	<span class="n">NFOTT</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-435"></a>	<span class="n">NPCTOT</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-436"></a>	<span class="n">NLMTOT</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-437"></a>
<a name="ln-438"></a>	<span class="k">CALL </span><span class="nb">RANDOM_SEED</span><span class="p">()</span>
<a name="ln-439"></a>	
<a name="ln-440"></a>	<span class="k">DO </span><span class="mi">171</span> <span class="n">IT</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IRUNS</span>
<a name="ln-441"></a>
<a name="ln-442"></a>		<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">),</span><span class="n">MASCH</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">))</span>
<a name="ln-443"></a>		<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-444"></a>			<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-445"></a>			<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-446"></a>			<span class="k">ALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a name="ln-447"></a>		<span class="n">ENDDO</span>
<a name="ln-448"></a>
<a name="ln-449"></a>		<span class="n">MASCH</span>    <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-450"></a>		<span class="n">LS</span>       <span class="o">=</span> <span class="mi">0</span>
<a name="ln-451"></a>		<span class="n">NF</span>       <span class="o">=</span> <span class="mi">0</span>
<a name="ln-452"></a>		<span class="n">NFOTT</span>    <span class="o">=</span> <span class="mi">0</span>
<a name="ln-453"></a>		<span class="n">NPC</span>      <span class="o">=</span> <span class="mi">0</span>
<a name="ln-454"></a>		<span class="n">NLM</span>      <span class="o">=</span> <span class="mi">0</span>
<a name="ln-455"></a>		<span class="n">RFAL</span>     <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-456"></a>		<span class="n">RNUMFAL</span>  <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-457"></a>		<span class="n">ICONTFAL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-458"></a>		<span class="n">IDFAL</span>    <span class="o">=</span> <span class="mi">0</span>  	
<a name="ln-459"></a>		<span class="n">NUMITER</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-460"></a>
<a name="ln-461"></a>		<span class="n">ivar</span>     <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">it</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-462"></a>		<span class="n">ivar2</span>    <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">it</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span> <span class="o">-</span><span class="mi">5</span>
<a name="ln-463"></a>
<a name="ln-464"></a>		<span class="n">RMED</span>     <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-465"></a>		<span class="n">RMED2</span>    <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-466"></a>
<a name="ln-467"></a><span class="c">!	-------------------------------------</span>
<a name="ln-468"></a><span class="c">!	  Generazione del campione originale</span>
<a name="ln-469"></a><span class="c">!	-------------------------------------</span>
<a name="ln-470"></a>		<span class="n">FOTT</span>     <span class="o">=</span> <span class="mf">1.D+32</span>
<a name="ln-471"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-472"></a><span class="c">!	modificato il 23/9/2003</span>
<a name="ln-473"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-474"></a>		<span class="n">NUMCAS</span>   <span class="o">=</span> <span class="mi">30</span>
<a name="ln-475"></a><span class="c">!		NUMCAS   = 1</span>
<a name="ln-476"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-477"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-478"></a><span class="k">			WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-479"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-480"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-481"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-482"></a>		<span class="n">ENDIF</span>
<a name="ln-483"></a>
<a name="ln-484"></a>		<span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NUMCAS</span>
<a name="ln-485"></a>
<a name="ln-486"></a><span class="mi">3000</span>		<span class="k">CONTINUE</span>
<a name="ln-487"></a><span class="k">			DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-488"></a>				<span class="k">CALL </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span>
<a name="ln-489"></a>				<span class="n">VETT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span> <span class="c">!RAN(IVAR2)</span>
<a name="ln-490"></a>				<span class="c">!VETT(I)=RAN(IVAR2)</span>
<a name="ln-491"></a>				<span class="n">XPROP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XINF</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">VETT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">XSUP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">XINF</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-492"></a>			<span class="n">ENDDO</span>
<a name="ln-493"></a>			<span class="k">if</span> <span class="p">(</span><span class="n">K</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-494"></a><span class="k">				</span><span class="n">XPROP</span> <span class="o">=</span> <span class="mf">0.5D0</span>
<a name="ln-495"></a>			<span class="k">end if</span>
<a name="ln-496"></a>			<span class="c">!CALL FUNCT(XPROP,N,FPROP)</span>
<a name="ln-497"></a>			<span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-498"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">XPROP</span><span class="p">,</span> <span class="n">FPROP</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-499"></a>			
<a name="ln-500"></a>			<span class="n">NPC</span><span class="o">=</span><span class="n">NPC</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-501"></a>			<span class="n">NF</span><span class="o">=</span><span class="n">NF</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-502"></a>			<span class="n">RMED</span><span class="o">=</span><span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.0D0</span><span class="p">)</span><span class="o">*</span><span class="n">RMED</span><span class="o">+</span><span class="n">FPROP</span><span class="p">)</span><span class="o">/</span><span class="n">NPC</span>
<a name="ln-503"></a>
<a name="ln-504"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">NPC</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-505"></a><span class="k">				</span><span class="n">RMED2</span><span class="o">=</span><span class="n">RMED2</span><span class="o">+</span><span class="n">FPROP</span><span class="o">**</span><span class="mi">2</span>
<a name="ln-506"></a>			<span class="k">ELSE</span>
<a name="ln-507"></a><span class="k">				</span><span class="n">RMED2</span><span class="o">=</span><span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">RMED2</span><span class="o">+</span><span class="n">FPROP</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.0D0</span><span class="p">)</span>
<a name="ln-508"></a>			<span class="n">ENDIF</span>
<a name="ln-509"></a>
<a name="ln-510"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-511"></a><span class="k">				CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-512"></a>			<span class="n">ENDIF</span>
<a name="ln-513"></a>
<a name="ln-514"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-515"></a><span class="k">				WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FPROP</span><span class="p">,</span><span class="s1">&#39;--&#39;</span>
<a name="ln-516"></a>				<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FPROP</span><span class="p">,</span><span class="s1">&#39;--&#39;</span>
<a name="ln-517"></a>			<span class="n">ENDIF</span>
<a name="ln-518"></a>		<span class="n">ENDDO</span>
<a name="ln-519"></a>
<a name="ln-520"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-521"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;fine generazione random iniziale nf = &#39;</span><span class="p">,</span> <span class="n">nf</span>
<a name="ln-522"></a>			<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;fine generazione random iniziale nf = &#39;</span><span class="p">,</span> <span class="n">nf</span>
<a name="ln-523"></a>		<span class="n">ENDIF</span>
<a name="ln-524"></a>
<a name="ln-525"></a>		<span class="n">VAR2</span><span class="o">=</span><span class="n">RMED2</span><span class="o">-</span><span class="p">(</span><span class="n">RMED</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NPC</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-526"></a>
<a name="ln-527"></a><span class="c">!---------------------------------------------------------</span>
<a name="ln-528"></a><span class="c">!	RIEMPIO IL WKS DI IDIMWKS PUNTI</span>
<a name="ln-529"></a><span class="c">!	CHE SODDISFANO IL TEST DEL S.A.</span>
<a name="ln-530"></a><span class="c">!---------------------------------------------------------</span>
<a name="ln-531"></a><span class="c">!	alfa     = 1.0d0</span>
<a name="ln-532"></a><span class="c">!	DOLDALFA = ALFA</span>
<a name="ln-533"></a>    <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-534"></a>		<span class="n">DOLDALFA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">*</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-3</span><span class="p">,</span><span class="n">DMIN1</span><span class="p">(</span><span class="mf">1.D+3</span><span class="p">,.</span><span class="mi">5</span><span class="n">D0</span><span class="o">*</span><span class="nb">DABS</span><span class="p">(</span><span class="n">XPROP</span><span class="p">(</span><span class="n">I</span><span class="p">))))</span>
<a name="ln-535"></a><span class="c">!		DOLDALFA(I)=1.D0</span>
<a name="ln-536"></a>    <span class="k">END DO</span>
<a name="ln-537"></a><span class="k">	</span><span class="n">D</span>        <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-538"></a>	<span class="n">xprop</span>    <span class="o">=</span> <span class="n">xott</span>
<a name="ln-539"></a>	<span class="n">fprop</span>    <span class="o">=</span> <span class="n">fott</span>
<a name="ln-540"></a><span class="c">!	fmax_eff = fott</span>
<a name="ln-541"></a>	<span class="k">if</span><span class="p">(</span><span class="n">print_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-542"></a><span class="k">		write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ricerca lungo assi&#39;</span>
<a name="ln-543"></a>	<span class="n">endif</span>
<a name="ln-544"></a>	<span class="k">CALL </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">Fmax_eff</span><span class="p">,&amp;</span>
<a name="ln-545"></a>              <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-546"></a>	<span class="k">if</span><span class="p">(</span><span class="n">print_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-547"></a><span class="k">		write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;fine ricerca lungo assi&#39;</span>
<a name="ln-548"></a>	<span class="n">endif</span>
<a name="ln-549"></a>
<a name="ln-550"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">XPROP</span> 
<a name="ln-551"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">FPROP</span> 
<a name="ln-552"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-553"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>			
<a name="ln-554"></a>	<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-555"></a><span class="k">		write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 1 ----&#39;</span>
<a name="ln-556"></a>	<span class="n">endif</span>
<a name="ln-557"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-558"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-559"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FSTOP</span>
<a name="ln-560"></a>	<span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-561"></a>
<a name="ln-562"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-563"></a><span class="k">		CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-564"></a>	<span class="n">ENDIF</span>
<a name="ln-565"></a>
<a name="ln-566"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-567"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="s1">&#39;IN&#39;</span>
<a name="ln-568"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="s1">&#39;IN&#39;</span>
<a name="ln-569"></a>	<span class="n">ENDIF</span>
<a name="ln-570"></a>
<a name="ln-571"></a>	<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-572"></a>		<span class="n">ZETA</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-573"></a>		<span class="n">TRES</span> <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-574"></a>
<a name="ln-575"></a>		<span class="k">DO WHILE</span> <span class="p">(</span><span class="n">ZETA</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">TRES</span><span class="p">)</span>
<a name="ln-576"></a>			<span class="k">CALL </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span>
<a name="ln-577"></a>			<span class="n">ZETA</span><span class="o">=</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span> <span class="c">!RAN(IVAR)</span>
<a name="ln-578"></a>			<span class="c">!ZETA=RAN(IVAR)</span>
<a name="ln-579"></a>
<a name="ln-580"></a><span class="mi">3010</span>		<span class="k">CONTINUE</span>
<a name="ln-581"></a><span class="k">			DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-582"></a>				<span class="k">CALL </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span>
<a name="ln-583"></a>				<span class="n">VETT</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span> <span class="c">!RAN(IVAR2)</span>
<a name="ln-584"></a>				<span class="c">!VETT(J)=RAN(IVAR2)</span>
<a name="ln-585"></a>				<span class="n">XPROP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">XINF</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">VETT</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">XSUP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">XINF</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<a name="ln-586"></a>			<span class="n">ENDDO</span>
<a name="ln-587"></a>
<a name="ln-588"></a>			<span class="c">!CALL FUNCT(XPROP,N,FPROP)</span>
<a name="ln-589"></a>			<span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-590"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">XPROP</span><span class="p">,</span> <span class="n">FPROP</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-591"></a>			<span class="n">NPC</span> <span class="o">=</span> <span class="n">NPC</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-592"></a>			<span class="n">NF</span>  <span class="o">=</span> <span class="n">NF</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-593"></a>
<a name="ln-594"></a>			<span class="n">RMED</span> <span class="o">=</span><span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">RMED</span><span class="o">+</span><span class="n">FPROP</span><span class="p">)</span><span class="o">/</span><span class="n">NPC</span>
<a name="ln-595"></a>			<span class="n">RMED2</span><span class="o">=</span><span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">RMED2</span><span class="o">+</span><span class="n">FPROP</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-596"></a>			<span class="n">VAR2</span> <span class="o">=</span><span class="n">RMED2</span><span class="o">-</span><span class="p">(</span><span class="n">RMED</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NPC</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-597"></a>
<a name="ln-598"></a>			<span class="n">DIFF</span><span class="o">=</span><span class="n">RMED</span><span class="o">-</span><span class="n">FOTT</span>
<a name="ln-599"></a>
<a name="ln-600"></a>			<span class="n">TRES</span><span class="o">=</span><span class="nb">DEXP</span><span class="p">(</span><span class="o">-</span><span class="n">TCOEFF</span><span class="o">*</span><span class="p">(</span><span class="n">RFAL</span><span class="o">/</span><span class="n">DIFF</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FPROP</span><span class="o">-</span><span class="n">FOTT</span><span class="p">))</span>
<a name="ln-601"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-602"></a><span class="c">!	modificato il 23/9/2003</span>
<a name="ln-603"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-604"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-605"></a><span class="k">				</span><span class="n">TRES</span> <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-606"></a>			<span class="n">ENDIF</span>
<a name="ln-607"></a><span class="c">!			TRES = 1.0D0</span>
<a name="ln-608"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-609"></a>		<span class="n">ENDDO</span>
<a name="ln-610"></a>				
<a name="ln-611"></a><span class="c">!		DO J=1,N</span>
<a name="ln-612"></a><span class="c">!			DOLDALFA(J)=1.0D0*DMAX1(1.D-3,DMIN1(1.D+3,.5D0*DABS(XPROP(J))))</span>
<a name="ln-613"></a><span class="c">!			DOLDALFA(J)=1.0D0</span>
<a name="ln-614"></a><span class="c">!		END DO</span>
<a name="ln-615"></a>
<a name="ln-616"></a>		<span class="n">ALFA</span>      <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-617"></a>		<span class="n">DOLDALFA</span>  <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-618"></a>		<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-619"></a>		   <span class="k">IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-620"></a><span class="k">				</span><span class="n">ALFA</span>      <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-621"></a>				<span class="n">DOLDALFA</span>  <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-622"></a>		   <span class="n">ENDIF</span>
<a name="ln-623"></a>		<span class="n">ENDDO</span>
<a name="ln-624"></a>
<a name="ln-625"></a><span class="c">!		DO K = 1,N</span>
<a name="ln-626"></a><span class="c">!			ALFA=WKS(1)%DOLDALFA(K)</span>
<a name="ln-627"></a><span class="c">!			DO J = 2,I-1</span>
<a name="ln-628"></a><span class="c">!			   IF(ALFA.LT.WKS(J)%DOLDALFA(K)) THEN</span>
<a name="ln-629"></a><span class="c">!				   ALFA      =  WKS(J)%DOLDALFA(K)</span>
<a name="ln-630"></a><span class="c">!			   ENDIF</span>
<a name="ln-631"></a><span class="c">!			ENDDO</span>
<a name="ln-632"></a><span class="c">!			DOLDALFA(K) = ALFA</span>
<a name="ln-633"></a><span class="c">!		ENDDO</span>
<a name="ln-634"></a>
<a name="ln-635"></a>		<span class="n">D</span>        <span class="o">=</span> <span class="mf">1.0D0</span>
<a name="ln-636"></a><span class="c">!		fmax_eff = fprop</span>
<a name="ln-637"></a>		<span class="k">CALL </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Xprop</span><span class="p">,</span><span class="n">Fprop</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">Fmax_eff</span><span class="p">,&amp;</span>
<a name="ln-638"></a>		<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-639"></a>
<a name="ln-640"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">XPROP</span>
<a name="ln-641"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">FPROP</span>
<a name="ln-642"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-643"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-644"></a>		<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-645"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 2 ----&#39;</span>
<a name="ln-646"></a>		<span class="n">endif</span>
<a name="ln-647"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-648"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-649"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FSTOP</span>
<a name="ln-650"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-651"></a>
<a name="ln-652"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-653"></a><span class="k">			CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-654"></a>		<span class="n">ENDIF</span>
<a name="ln-655"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-656"></a><span class="k">			WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="s1">&#39;IN&#39;</span>
<a name="ln-657"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2130</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="s1">&#39;IN&#39;</span>
<a name="ln-658"></a>		<span class="n">ENDIF</span>
<a name="ln-659"></a>
<a name="ln-660"></a>	<span class="n">ENDDO</span> 
<a name="ln-661"></a>
<a name="ln-662"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-663"></a><span class="c">!	modificato il 23/9/2003</span>
<a name="ln-664"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-665"></a><span class="c">!	OPEN(99,FILE=&#39;MIN_LOCALI.txt&#39;,STATUS=&#39;REPLACE&#39;)</span>
<a name="ln-666"></a><span class="c">!	DO I = 1,IDIMWKS</span>
<a name="ln-667"></a><span class="c">!		WRITE(99,*) WKS(I)%X</span>
<a name="ln-668"></a><span class="c">!		WRITE(99,*) &#39;FOB = &#39;,WKS(I)%FOB</span>
<a name="ln-669"></a><span class="c">!		WRITE(99,*) &#39;--------------------------------&#39;</span>
<a name="ln-670"></a><span class="c">!	ENDDO</span>
<a name="ln-671"></a><span class="c">!	CLOSE(99)</span>
<a name="ln-672"></a><span class="c">!	STOP</span>
<a name="ln-673"></a><span class="c">!--------------------------------------------------------</span>
<a name="ln-674"></a>
<a name="ln-675"></a>	<span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-676"></a>		<span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XOTT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-677"></a>	<span class="n">ENDDO</span>
<a name="ln-678"></a>
<a name="ln-679"></a>	<span class="n">MAXLS</span><span class="o">=</span><span class="mi">100000000</span>      
<a name="ln-680"></a>	<span class="n">MODLS</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-681"></a>
<a name="ln-682"></a><span class="c">!	--------------------</span>
<a name="ln-683"></a><span class="c">!	  Ciclo principale</span>
<a name="ln-684"></a><span class="c">!	--------------------</span>
<a name="ln-685"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-686"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-687"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-688"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-689"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-690"></a>	<span class="n">ENDIF</span>
<a name="ln-691"></a><span class="mi">2070</span> <span class="k">FORMAT</span><span class="p">(</span> <span class="s1">&#39;    ITER      NFTOT       FOTT      SALTO       ALFA       FMIN        FMAX&#39;</span><span class="p">)</span>
<a name="ln-692"></a><span class="mi">2080</span> <span class="k">FORMAT</span><span class="p">(</span> <span class="s1">&#39;-----------------------------------------------------------------------------&#39;</span><span class="p">)</span>
<a name="ln-693"></a><span class="c">!              123456  123456789012  +1.2345E-02    OK     +1.2345E-02 +1.2345E-02 +1.2345E-02 </span>
<a name="ln-694"></a><span class="mi">2090</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span>  <span class="n">I6</span><span class="p">,</span> <span class="mi">2</span><span class="n">X</span><span class="p">,</span>  <span class="n">I12</span><span class="p">,</span>  <span class="mi">2</span><span class="n">X</span><span class="p">,</span>  <span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="n">X</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="mi">5</span><span class="n">X</span><span class="p">,</span>  <span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span>   <span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="n">X</span><span class="p">,</span> <span class="n">ES11</span><span class="p">.</span><span class="mi">4</span> <span class="p">)</span>
<a name="ln-695"></a><span class="mi">2130</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span>  <span class="n">I6</span><span class="p">,</span> <span class="mi">2</span><span class="n">X</span><span class="p">,</span>  <span class="n">I12</span><span class="p">,</span>  <span class="mi">2</span><span class="n">X</span><span class="p">,</span>  <span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="n">X</span><span class="p">,</span> <span class="n">A2</span> <span class="p">)</span>
<a name="ln-696"></a>
<a name="ln-697"></a><span class="mi">100</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; GENERAZ.  N = &#39;</span><span class="p">,</span> <span class="n">I9</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-698"></a><span class="mi">101</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;  Attuale valore ottimo = &#39;</span><span class="p">,</span><span class="n">D13</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-699"></a><span class="mi">102</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="mi">3</span><span class="p">(:,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;XOTT(&#39;</span><span class="p">,</span><span class="n">I1</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">D13</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">))</span>
<a name="ln-700"></a><span class="mi">109</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="mi">3</span><span class="p">(:,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;XOTT(&#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39;) =&#39;</span><span class="p">,</span><span class="n">D13</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">))</span>
<a name="ln-701"></a><span class="mi">6</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NF=&#39;</span><span class="p">,</span><span class="n">I15</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NPC=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NLM=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; LS=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-702"></a><span class="mi">96</span>	<span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;   MED = &#39;</span><span class="p">,</span><span class="n">D13</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;    VAR = &#39;</span><span class="p">,</span><span class="n">D13</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-703"></a>
<a name="ln-704"></a>	<span class="n">CSTEP</span> <span class="o">=</span><span class="s1">&#39;  &#39;</span>
<a name="ln-705"></a>
<a name="ln-706"></a><span class="mi">7</span>	<span class="k">CONTINUE</span>
<a name="ln-707"></a><span class="mi">8</span>	<span class="k">CONTINUE</span>
<a name="ln-708"></a>
<a name="ln-709"></a><span class="c">!--------------------------------------</span>
<a name="ln-710"></a><span class="c">!	stopping criterion</span>
<a name="ln-711"></a><span class="c">!--------------------------------------</span>
<a name="ln-712"></a><span class="c">!	calcola il max tra gli alfamax</span>
<a name="ln-713"></a><span class="c">!   o alfanr2 a seconda che normadue </span>
<a name="ln-714"></a><span class="c">!	sia falso o veroo</span>
<a name="ln-715"></a><span class="c">!--------------------------------------</span>
<a name="ln-716"></a>	<span class="n">ALFA</span>     <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-717"></a>	<span class="n">FSTOP</span>    <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-718"></a>	<span class="n">FMIN</span>     <span class="o">=</span> <span class="mf">1.0D+30</span>
<a name="ln-719"></a>	<span class="n">FMAX</span>     <span class="o">=-</span><span class="mf">1.0D+30</span>
<a name="ln-720"></a>	<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-721"></a>		<span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-722"></a><span class="k">			IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span> <span class="o">&gt;</span> <span class="n">FSTOP</span><span class="p">)</span> <span class="n">FSTOP</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span>
<a name="ln-723"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-724"></a><span class="k">				IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-725"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-726"></a>				<span class="n">ENDIF</span>
<a name="ln-727"></a>			<span class="k">ELSE</span>
<a name="ln-728"></a><span class="k">				IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-729"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-730"></a>				<span class="n">ENDIF</span>
<a name="ln-731"></a>			<span class="n">ENDIF</span>
<a name="ln-732"></a><span class="c">!			IF(WKS(I)%FOB &gt; FMAX) FMAX = WKS(I)%FOB</span>
<a name="ln-733"></a>		<span class="n">ENDIF</span>
<a name="ln-734"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&gt;</span> <span class="n">FMAX</span><span class="p">)</span> <span class="n">FMAX</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-735"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&lt;</span> <span class="n">FMIN</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-736"></a><span class="k">			</span><span class="n">FMIN</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-737"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-738"></a><span class="k">				</span><span class="n">ALFAOTT</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-739"></a>			<span class="k">ELSE</span>
<a name="ln-740"></a><span class="k">				</span><span class="n">ALFAOTT</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-741"></a>			<span class="n">ENDIF</span>
<a name="ln-742"></a>		<span class="n">ENDIF</span>
<a name="ln-743"></a>	<span class="n">ENDDO</span>
<a name="ln-744"></a>
<a name="ln-745"></a>	<span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-746"></a>
<a name="ln-747"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-748"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-749"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-750"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2070</span><span class="p">)</span>
<a name="ln-751"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2080</span><span class="p">)</span> 
<a name="ln-752"></a>	<span class="n">ENDIF</span>
<a name="ln-753"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-754"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">2090</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="n">CSTEP</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">FMIN</span><span class="p">,</span><span class="n">FMAX</span>
<a name="ln-755"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2090</span><span class="p">)</span> <span class="n">NUMITER</span><span class="p">,</span> <span class="n">NF</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span><span class="n">CSTEP</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">FMIN</span><span class="p">,</span><span class="n">FMAX</span>
<a name="ln-756"></a>	<span class="n">ENDIF</span>
<a name="ln-757"></a>
<a name="ln-758"></a>	<span class="k">IF</span><span class="p">((</span><span class="n">ALFAMAX</span> <span class="o">&lt;=</span> <span class="n">TOL</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">FSTOP</span> <span class="o">&lt;=</span> <span class="n">FSTOPTOL</span><span class="p">).</span><span class="nb">OR</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-759"></a>	   <span class="p">((</span><span class="n">FOTT</span><span class="o">-</span><span class="n">FGLOB</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="mf">1.0d0</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">fglob</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-760"></a><span class="k">		IF</span><span class="p">(</span><span class="n">NFOTT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-761"></a><span class="k">			</span><span class="n">NFOTT</span> <span class="o">=</span> <span class="n">NF</span>
<a name="ln-762"></a>			<span class="n">F_OTT</span> <span class="o">=</span> <span class="n">FOTT</span>
<a name="ln-763"></a>		<span class="n">ENDIF</span>
<a name="ln-764"></a>	<span class="n">ENDIF</span>
<a name="ln-765"></a>
<a name="ln-766"></a>	<span class="c">!IF(NF &gt;= MAXNF) THEN</span>
<a name="ln-767"></a>	<span class="k">IF</span><span class="p">((</span><span class="n">ALFAMAX</span> <span class="o">&lt;=</span> <span class="n">TOL</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">FSTOP</span> <span class="o">&lt;=</span> <span class="n">FSTOPTOL</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">NUMITER</span> <span class="o">&gt;=</span> <span class="n">MAXITER</span><span class="p">).</span><span class="nb">OR</span><span class="p">.(</span><span class="n">NF</span> <span class="o">&gt;=</span> <span class="n">MAXNF</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-768"></a><span class="k">		IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN	 </span>
<a name="ln-769"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;alfamax = &#39;</span><span class="p">,</span><span class="n">alfamax</span>	
<a name="ln-770"></a>			<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;alfamax = &#39;</span><span class="p">,</span><span class="n">alfamax</span>	
<a name="ln-771"></a>			<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;  fstop = &#39;</span><span class="p">,</span><span class="n">fstop</span>	
<a name="ln-772"></a>			<span class="k">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;  fstop = &#39;</span><span class="p">,</span><span class="n">fstop</span>	
<a name="ln-773"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="n">NUMITER</span>
<a name="ln-774"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="n">NUMITER</span>
<a name="ln-775"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">FOTT</span>
<a name="ln-776"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">FOTT</span>
<a name="ln-777"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span> <span class="n">FOTT</span>
<a name="ln-778"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span> <span class="n">FOTT</span>
<a name="ln-779"></a>
<a name="ln-780"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">N</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">10</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">102</span><span class="p">)</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">XOTT</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-781"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">N</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">10</span><span class="p">)</span> <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">102</span><span class="p">)</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">XOTT</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-782"></a>
<a name="ln-783"></a>			<span class="k">IF</span><span class="p">((</span><span class="n">N</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">9</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">N</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">100</span><span class="p">))</span> <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">109</span><span class="p">)</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">XOTT</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-784"></a>			<span class="k">IF</span><span class="p">((</span><span class="n">N</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mi">9</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">N</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="mi">100</span><span class="p">))</span> <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">109</span><span class="p">)</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">XOTT</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-785"></a>
<a name="ln-786"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="n">NF</span><span class="p">,</span><span class="n">NPC</span><span class="p">,</span><span class="n">NLM</span><span class="p">,</span><span class="n">LS</span>
<a name="ln-787"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="n">NF</span><span class="p">,</span><span class="n">NPC</span><span class="p">,</span><span class="n">NLM</span><span class="p">,</span><span class="n">LS</span>
<a name="ln-788"></a>
<a name="ln-789"></a>			<span class="k">if</span><span class="p">(</span><span class="n">var2</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-790"></a><span class="k">				write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 3 ----&#39;</span>
<a name="ln-791"></a>			<span class="n">endif</span>
<a name="ln-792"></a>			<span class="n">VAR1</span><span class="o">=</span><span class="nb">DSQRT</span><span class="p">(</span><span class="n">VAR2</span><span class="p">)</span>
<a name="ln-793"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">96</span><span class="p">)</span> <span class="n">RMED</span><span class="p">,</span><span class="n">VAR1</span>
<a name="ln-794"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">96</span><span class="p">)</span> <span class="n">RMED</span><span class="p">,</span><span class="n">VAR1</span>
<a name="ln-795"></a>		<span class="n">ENDIF</span>
<a name="ln-796"></a>		<span class="n">GO</span> <span class="n">TO</span> <span class="mi">170</span>
<a name="ln-797"></a>	<span class="n">ENDIF</span>
<a name="ln-798"></a>
<a name="ln-799"></a>	<span class="c">!IF (FMIN /= FOTT) PAUSE</span>
<a name="ln-800"></a>
<a name="ln-801"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-802"></a>
<a name="ln-803"></a>
<a name="ln-804"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;/---------------------------------\&#39;</span>
<a name="ln-805"></a><span class="s1">		WRITE(1,*)&#39;</span><span class="o">/---------------------------------</span><span class="err">\</span><span class="s1">&#39;</span>
<a name="ln-806"></a><span class="s1">		WRITE(*,*)&#39;</span><span class="n">ALFAOTT</span> <span class="o">=</span> <span class="s1">&#39;,ALFAOTT,&#39;</span> <span class="n">FOTT</span> <span class="o">=</span> <span class="s1">&#39;,FOTT</span>
<a name="ln-807"></a><span class="s1">		WRITE(1,*)&#39;</span><span class="n">ALFAOTT</span> <span class="o">=</span> <span class="s1">&#39;,ALFAOTT,&#39;</span> <span class="n">FOTT</span> <span class="o">=</span> <span class="s1">&#39;,FOTT</span>
<a name="ln-808"></a><span class="s1">!		WRITE(*,*) XOTT</span>
<a name="ln-809"></a><span class="s1">!		WRITE(1,*) XOTT</span>
<a name="ln-810"></a><span class="s1">		WRITE(*,*)&#39;</span><span class="err">\</span><span class="o">---------------------------------/</span><span class="s1">&#39;</span>
<a name="ln-811"></a><span class="s1">		WRITE(1,*)&#39;</span><span class="err">\</span><span class="o">---------------------------------/</span><span class="s1">&#39;</span>
<a name="ln-812"></a><span class="s1">		WRITE(*,*)</span>
<a name="ln-813"></a><span class="s1">		WRITE(1,*)</span>
<a name="ln-814"></a><span class="s1">	ENDIF</span>
<a name="ln-815"></a>
<a name="ln-816"></a>
<a name="ln-817"></a><span class="s1">!--------------------------------------</span>
<a name="ln-818"></a>
<a name="ln-819"></a><span class="s1">	NUMITER = NUMITER + 1</span>
<a name="ln-820"></a><span class="s1">	IF(PRINT_LEVEL &gt;= 0) THEN</span>
<a name="ln-821"></a><span class="s1">		IF(MOD(NUMITER,30)==0) THEN</span>
<a name="ln-822"></a><span class="s1">			WRITE(*,2070)</span>
<a name="ln-823"></a><span class="s1">			WRITE(*,2080) </span>
<a name="ln-824"></a><span class="s1">			WRITE(1,2070)</span>
<a name="ln-825"></a><span class="s1">			WRITE(1,2080) </span>
<a name="ln-826"></a><span class="s1">		ENDIF</span>
<a name="ln-827"></a><span class="s1">	ENDIF</span>
<a name="ln-828"></a>
<a name="ln-829"></a><span class="s1">!--------------------------------------</span>
<a name="ln-830"></a><span class="s1">!	genera zeta random tra 0 e 1</span>
<a name="ln-831"></a><span class="s1">!	e un punto xprop su cui calcolare</span>
<a name="ln-832"></a><span class="s1">!	la f.ob.</span>
<a name="ln-833"></a><span class="s1">!--------------------------------------</span>
<a name="ln-834"></a><span class="s1">	CALL RANDOM_NUMBER(RRAND)</span>
<a name="ln-835"></a><span class="s1">	ZETA=DBLE(RRAND) !RAN(IVAR)</span>
<a name="ln-836"></a><span class="s1">	!ZETA=RAN(IVAR)</span>
<a name="ln-837"></a>
<a name="ln-838"></a>
<a name="ln-839"></a><span class="s1">3020 CONTINUE</span>
<a name="ln-840"></a>
<a name="ln-841"></a><span class="s1">	DO I=1,N</span>
<a name="ln-842"></a><span class="s1">		CALL RANDOM_NUMBER(RRAND)</span>
<a name="ln-843"></a><span class="s1">		VETT(I)=DBLE(RRAND) !RAN(IVAR2)</span>
<a name="ln-844"></a><span class="s1">		!VETT(I)=RAN(IVAR2)</span>
<a name="ln-845"></a><span class="s1">		XPROP(I)=XINF(I)+VETT(I)*(XSUP(I)-XINF(I))</span>
<a name="ln-846"></a><span class="s1">	ENDDO	</span>
<a name="ln-847"></a>
<a name="ln-848"></a><span class="s1">	!CALL FUNCT(XPROP,N,FPROP)</span>
<a name="ln-849"></a><span class="s1">	call  calfun(nipar, nfpar, ninit, ipar, fparebsd, initmeanval, expt, accum_e, mLPNH, mLPSH, &amp;</span>
<a name="ln-850"></a><span class="s1">                                N, XPROP, FPROP, verbose)</span>
<a name="ln-851"></a><span class="s1">	NPC=NPC+1</span>
<a name="ln-852"></a><span class="s1">	NF=NF+1</span>
<a name="ln-853"></a>
<a name="ln-854"></a><span class="s1">103	FORMAT(/,1X,&#39;</span>      <span class="n">Proposta</span> <span class="n">di</span> <span class="n">salto</span><span class="s1">&#39;)</span>
<a name="ln-855"></a><span class="s1">105	FORMAT(/,1X,&#39;</span>   <span class="n">Zeta</span> <span class="o">=</span><span class="s1">&#39;,D13.6,&#39;</span>   <span class="n">Tres</span> <span class="o">=</span><span class="s1">&#39;,D13.6,/)</span>
<a name="ln-856"></a>
<a name="ln-857"></a><span class="s1">!	----------------------------</span>
<a name="ln-858"></a><span class="s1">!	  Calcolo media, varianza e</span>
<a name="ln-859"></a><span class="s1">!	  la temperatura del SA</span>
<a name="ln-860"></a><span class="s1">!	----------------------------</span>
<a name="ln-861"></a>
<a name="ln-862"></a><span class="s1">	RMED  = ((NPC-1.)*RMED+FPROP)/NPC</span>
<a name="ln-863"></a><span class="s1">	RMED2 = ((NPC-2.)*RMED2+FPROP**2)/(NPC-1.)</span>
<a name="ln-864"></a><span class="s1">	VAR2  = RMED2-(RMED**2)*(NPC/(NPC-1.))</span>
<a name="ln-865"></a>
<a name="ln-866"></a><span class="s1">	DIFF  = RMED-FOTT</span>
<a name="ln-867"></a>
<a name="ln-868"></a><span class="s1">	TRES  = DEXP(-TCOEFF*(RFAL/DIFF)*(FPROP-FOTT))</span>
<a name="ln-869"></a><span class="s1">	temperatura = diff/rfal</span>
<a name="ln-870"></a>
<a name="ln-871"></a><span class="s1">	IF(FPROP.LE.FOTT) TRES=1.0D0</span>
<a name="ln-872"></a>
<a name="ln-873"></a><span class="s1">!--------------------------------------</span>
<a name="ln-874"></a><span class="s1">!	se zeta e&#39;</span> <span class="n">minore</span> <span class="n">o</span> <span class="n">uguale</span> <span class="n">a</span> <span class="n">tres</span>
<a name="ln-875"></a><span class="c">!	allora accetta il punto e fa</span>
<a name="ln-876"></a><span class="c">!	partire una min. locale</span>
<a name="ln-877"></a><span class="c">!--------------------------------------</span>
<a name="ln-878"></a><span class="c">!	IF(.FALSE.) THEN</span>
<a name="ln-879"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">ZETA</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">TRES</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-880"></a>
<a name="ln-881"></a><span class="k">		</span><span class="n">NUMFAL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-882"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-883"></a><span class="k">			WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">405</span><span class="p">)</span> 
<a name="ln-884"></a>			<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">405</span><span class="p">)</span> 
<a name="ln-885"></a>		<span class="n">ENDIF</span>
<a name="ln-886"></a><span class="mi">405</span>		<span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;    Proposta di salto accettata &#39;</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-887"></a>		<span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-888"></a>			<span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XPROP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-889"></a>		<span class="n">ENDDO</span>
<a name="ln-890"></a>
<a name="ln-891"></a>		<span class="n">NLM</span>     <span class="o">=</span> <span class="n">NLM</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-892"></a>
<a name="ln-893"></a><span class="c">!--------------------------------------</span>
<a name="ln-894"></a><span class="c">!		calcola l&#39;indice imax della</span>
<a name="ln-895"></a><span class="c">!		componente di wks contenente</span>
<a name="ln-896"></a><span class="c">!		il valore di fob piu&#39; alto</span>
<a name="ln-897"></a><span class="c">!--------------------------------------</span>
<a name="ln-898"></a>		<span class="n">FMAX</span>    <span class="o">=-</span><span class="mf">1.0D+30</span>
<a name="ln-899"></a>		<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-900"></a><span class="c">!			IF((WKS(I)%FOB &gt; FMAX)) THEN</span>
<a name="ln-901"></a>			<span class="k">IF</span><span class="p">((</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&gt;</span> <span class="n">FMAX</span><span class="p">)</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)))</span> <span class="k">THEN</span>
<a name="ln-902"></a><span class="k">				</span><span class="n">FMAX</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-903"></a>				<span class="n">IMAX</span> <span class="o">=</span> <span class="n">I</span>
<a name="ln-904"></a>			<span class="n">ENDIF</span>
<a name="ln-905"></a>		<span class="n">ENDDO</span>
<a name="ln-906"></a>
<a name="ln-907"></a>		<span class="n">ALFA</span>  <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-908"></a>		<span class="n">FSTOP</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">FSTOP</span>
<a name="ln-909"></a>		<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-910"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">FSTOP</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FSTOP</span><span class="p">)</span> <span class="n">FSTOP</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FSTOP</span>
<a name="ln-911"></a>			<span class="k">IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-912"></a><span class="k">				</span><span class="n">ALFA</span>      <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-913"></a>				<span class="n">DOLDALFA</span>  <span class="o">=</span>  <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-914"></a>			<span class="n">ENDIF</span>
<a name="ln-915"></a>		<span class="n">ENDDO</span>
<a name="ln-916"></a>
<a name="ln-917"></a><span class="c">!		DO K = 1,N</span>
<a name="ln-918"></a><span class="c">!			ALFA=WKS(1)%DOLDALFA(K)</span>
<a name="ln-919"></a><span class="c">!			DO J = 1,IDIMWKS</span>
<a name="ln-920"></a><span class="c">!			   IF(ALFA.LT.WKS(J)%DOLDALFA(K)) THEN</span>
<a name="ln-921"></a><span class="c">!				   ALFA      =  WKS(J)%DOLDALFA(K)</span>
<a name="ln-922"></a><span class="c">!			   ENDIF</span>
<a name="ln-923"></a><span class="c">!			ENDDO</span>
<a name="ln-924"></a><span class="c">!			DOLDALFA(K) = ALFA</span>
<a name="ln-925"></a><span class="c">!		ENDDO</span>
<a name="ln-926"></a>
<a name="ln-927"></a>		<span class="n">ALFA</span> <span class="o">=</span> <span class="n">ALFAMAX</span>
<a name="ln-928"></a><span class="c">!		IF(NORMADUE) THEN</span>
<a name="ln-929"></a><span class="c">!			ALFA = WKS(IMAX)%ALFANR2</span>
<a name="ln-930"></a><span class="c">!		ELSETABELLA</span>
<a name="ln-931"></a><span class="c">!			ALFA = WKS(IMAX)%ALFAMAX</span>
<a name="ln-932"></a><span class="c">!		ENDIF</span>
<a name="ln-933"></a>
<a name="ln-934"></a>		<span class="k">CALL </span><span class="n">INTERFACCIA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAMAX</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">,&amp;</span>
<a name="ln-935"></a>		<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-936"></a>
<a name="ln-937"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-938"></a><span class="k">			CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-939"></a>			<span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-940"></a>		<span class="n">ENDIF</span>
<a name="ln-941"></a>
<a name="ln-942"></a>		<span class="k">IF</span><span class="p">((</span><span class="n">F</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(</span><span class="n">ISTOP</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">2</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-943"></a><span class="c">!--------------------------------------</span>
<a name="ln-944"></a><span class="c">!			se la min. produce un punto</span>
<a name="ln-945"></a><span class="c">!			migliore del peggiore</span>
<a name="ln-946"></a><span class="c">!			lo sostituisce</span>
<a name="ln-947"></a><span class="c">!--------------------------------------</span>
<a name="ln-948"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">X</span>
<a name="ln-949"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">F</span>
<a name="ln-950"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-951"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-952"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">D</span>		  <span class="o">=</span> <span class="n">D</span>
<a name="ln-953"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FSTOP</span>	  <span class="o">=</span> <span class="n">FFSTOP</span>
<a name="ln-954"></a>			<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-955"></a><span class="k">				write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 4 ----&#39;</span>
<a name="ln-956"></a>			<span class="n">endif</span>
<a name="ln-957"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-958"></a>			<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-959"></a>			<span class="n">CSTEP</span> <span class="o">=</span> <span class="s1">&#39;OK&#39;</span>
<a name="ln-960"></a>			<span class="n">MASCH</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-961"></a>			<span class="n">GO</span> <span class="n">TO</span> <span class="mi">7</span>
<a name="ln-962"></a>		<span class="k">ELSE</span>
<a name="ln-963"></a><span class="c">!--------------------------------------</span>
<a name="ln-964"></a><span class="c">!			non accetta il punto</span>
<a name="ln-965"></a><span class="c">!			prodotto dalla minimizzazione</span>
<a name="ln-966"></a><span class="c">!--------------------------------------</span>
<a name="ln-967"></a>			<span class="n">RNUMFAL</span>  <span class="o">=</span> <span class="n">RNUMFAL</span>  <span class="o">+</span> <span class="mf">1.0D0</span>
<a name="ln-968"></a>			<span class="n">ICONTFAL</span> <span class="o">=</span> <span class="n">ICONTFAL</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-969"></a>			<span class="n">RFAL</span>     <span class="o">=</span> <span class="n">RFAL</span>     <span class="o">+</span> <span class="mf">1.0D0</span><span class="o">/</span><span class="n">RNUMFAL</span>
<a name="ln-970"></a>			<span class="n">IDFAL</span>    <span class="o">=</span> <span class="mi">1</span>
<a name="ln-971"></a>
<a name="ln-972"></a>			<span class="n">CSTEP</span> <span class="o">=</span> <span class="s1">&#39;NO&#39;</span>
<a name="ln-973"></a>	
<a name="ln-974"></a>		<span class="n">ENDIF</span>
<a name="ln-975"></a>
<a name="ln-976"></a>	<span class="k">ELSE</span>
<a name="ln-977"></a><span class="c">!--------------------------------------</span>
<a name="ln-978"></a><span class="c">!	altrimenti (zeta &gt; tres) scarta</span>
<a name="ln-979"></a><span class="c">!	il punto proposto e aggiorna</span>
<a name="ln-980"></a><span class="c">!	il cont. numfal</span>
<a name="ln-981"></a><span class="c">!--------------------------------------</span>
<a name="ln-982"></a>		<span class="n">NUMFAL</span>   <span class="o">=</span> <span class="n">NUMFAL</span>   <span class="o">+</span> <span class="mi">1</span>
<a name="ln-983"></a>
<a name="ln-984"></a><span class="c">!		RNUMFAL  = RNUMFAL  + 1.0D0</span>
<a name="ln-985"></a><span class="c">!		ICONTFAL = ICONTFAL + 1</span>
<a name="ln-986"></a><span class="c">!		RFAL     = RFAL     + 1.0D0/RNUMFAL</span>
<a name="ln-987"></a><span class="c">!		IDFAL    = 1</span>
<a name="ln-988"></a>	<span class="n">ENDIF</span>
<a name="ln-989"></a>
<a name="ln-990"></a><span class="c">!====================================================</span>
<a name="ln-991"></a><span class="c">!   QUI DEVO FARE UNA RICERCA LUNGO GLI ASSI</span>
<a name="ln-992"></a><span class="c">!	SU I PUNTI DEL WKS. </span>
<a name="ln-993"></a><span class="c">!   SOLOSULPEGG = .TRUE.  --&gt; LA FA SOLO SU QUELLO</span>
<a name="ln-994"></a><span class="c">!						 	  CON ALFA PEGGIORE</span>
<a name="ln-995"></a><span class="c">!				= .FALSE. --&gt; LA FA SU TUTTI</span>
<a name="ln-996"></a><span class="c">!====================================================	</span>
<a name="ln-997"></a>
<a name="ln-998"></a>	<span class="k">if</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">SOLOSULPEGG</span><span class="p">)</span> <span class="k">then</span> <span class="c">!fai la ricerca lungo gli assi per tutti</span>
<a name="ln-999"></a>							  <span class="c">!i punti dell&#39;array</span>
<a name="ln-1000"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">NUMFAL</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1001"></a><span class="k">			</span><span class="n">NUMFAL</span>  <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1002"></a>
<a name="ln-1003"></a>			<span class="n">FMAX_EFF</span>    <span class="o">=-</span><span class="mf">1.0D+30</span>
<a name="ln-1004"></a>			<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1005"></a><span class="c">!				IF(.NOT.MASCH(J)) THEN</span>
<a name="ln-1006"></a>					<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&gt;</span> <span class="n">FMAX_EFF</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1007"></a><span class="k">						</span><span class="n">FMAX_EFF</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1008"></a>					<span class="n">ENDIF</span>
<a name="ln-1009"></a><span class="c">!				ENDIF</span>
<a name="ln-1010"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&lt;=</span> <span class="n">FOTT</span><span class="p">)</span> <span class="n">IOTT</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-1011"></a>				<span class="n">RA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>    <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1012"></a>				<span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-1013"></a>			<span class="n">ENDDO</span>
<a name="ln-1014"></a>
<a name="ln-1015"></a><span class="c">!-------------------------------------------------</span>
<a name="ln-1016"></a><span class="c">! ORDINO RA E RESTITUISCE RB ORDINATO</span>
<a name="ln-1017"></a><span class="c">! IN IPERM CI SONO LE POSIZIONI DEGLI ELEMENTI</span>
<a name="ln-1018"></a><span class="c">! DI RB IN RA</span>
<a name="ln-1019"></a><span class="c">!-------------------------------------------------</span>
<a name="ln-1020"></a>			<span class="k">call </span><span class="n">qsortd</span><span class="p">(</span><span class="n">RA</span><span class="p">,</span><span class="n">IPERM</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-1021"></a>			<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1022"></a>				<span class="n">RB</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">RA</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-1023"></a>			<span class="n">ENDDO</span>
<a name="ln-1024"></a>			<span class="c">!CALL DSVRGP(IDIMWKS,RA,RB,IPERM)</span>
<a name="ln-1025"></a><span class="c">!			MASCH = .FALSE.</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a>			<span class="n">I</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1028"></a>			<span class="n">J</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-1029"></a>			<span class="k">DO WHILE</span> <span class="p">(</span> <span class="n">J</span> <span class="o">&lt;=</span> <span class="n">IDIMWKS</span> <span class="p">)</span>
<a name="ln-1030"></a>
<a name="ln-1031"></a>				<span class="c">!CONFRONTO J,I --&gt; MASCH</span>
<a name="ln-1032"></a>				<span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">)))</span> <span class="k">THEN</span>
<a name="ln-1033"></a>
<a name="ln-1034"></a>
<a name="ln-1035"></a><span class="k">					</span><span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">RB</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">RB</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-8</span><span class="p">,</span><span class="nb">DABS</span><span class="p">(</span><span class="n">RB</span><span class="p">(</span><span class="n">J</span><span class="p">))</span> <span class="p">))</span> <span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D-1</span> 
<a name="ln-1036"></a><span class="c">!					L_F_VICINI = L_F_VICINI.AND.((DSQRT(													&amp;</span>
<a name="ln-1037"></a><span class="c">!						DOT_PRODUCT(WKS(IPERM(I))%X-WKS(IPERM(J))%X,WKS(IPERM(I))%X-WKS(IPERM(J))%X)) &lt;= 1.D-2)&amp; !ERA 1.D-1</span>
<a name="ln-1038"></a><span class="c">!						.OR. (WKS(IPERM(J))%ALFAMAX.LE.1.D-1*WKS(IPERM(I))%ALFAMAX) )</span>
<a name="ln-1039"></a>					<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="n">L_F_VICINI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.((</span><span class="nb">DSQRT</span><span class="p">(</span>													<span class="p">&amp;</span>
<a name="ln-1040"></a>						<span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">I</span><span class="p">))%</span><span class="n">X</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">))%</span><span class="n">X</span><span class="p">,</span><span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">I</span><span class="p">))%</span><span class="n">X</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">))%</span><span class="n">X</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mf">1.D-1</span><span class="p">))</span>
<a name="ln-1041"></a>	<span class="c">!				MASCH(IPERM(J)) = MASCH(IPERM(J)).OR.L_F_VICINI</span>
<a name="ln-1042"></a>
<a name="ln-1043"></a>					<span class="k">IF</span> <span class="p">(</span><span class="n">L_F_VICINI</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1044"></a><span class="k">						</span>
<a name="ln-1045"></a><span class="k">						IF</span> <span class="p">(</span> <span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">))%</span><span class="n">ALFAMAX</span> <span class="o">&lt;=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">I</span><span class="p">))%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1046"></a><span class="k">							</span>
<a name="ln-1047"></a><span class="k">							</span><span class="n">MASCH</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1048"></a>							<span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span> 
<a name="ln-1049"></a>
<a name="ln-1050"></a>						<span class="k">ELSE</span>
<a name="ln-1051"></a><span class="k">							</span>
<a name="ln-1052"></a><span class="k">							</span><span class="n">MASCH</span><span class="p">(</span><span class="n">IPERM</span><span class="p">(</span><span class="n">I</span><span class="p">))</span> <span class="o">=</span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1053"></a>							<span class="n">I</span> <span class="o">=</span> <span class="n">J</span>
<a name="ln-1054"></a>							<span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span> 								
<a name="ln-1055"></a>								
<a name="ln-1056"></a>						<span class="n">ENDIF</span>
<a name="ln-1057"></a>
<a name="ln-1058"></a>					<span class="k">ELSE</span>
<a name="ln-1059"></a>
<a name="ln-1060"></a><span class="k">						</span><span class="n">I</span> <span class="o">=</span> <span class="n">J</span>   
<a name="ln-1061"></a>						<span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a>					<span class="n">ENDIF</span>
<a name="ln-1064"></a>
<a name="ln-1065"></a>				<span class="k">ELSE</span>
<a name="ln-1066"></a><span class="k">					</span>
<a name="ln-1067"></a><span class="k">					</span><span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1068"></a>
<a name="ln-1069"></a>				<span class="n">ENDIF</span>
<a name="ln-1070"></a>
<a name="ln-1071"></a>			<span class="n">ENDDO</span>
<a name="ln-1072"></a>
<a name="ln-1073"></a>			
<a name="ln-1074"></a>
<a name="ln-1075"></a>			<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1076"></a>
<a name="ln-1077"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1078"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-1079"></a>				<span class="k">ELSE</span>
<a name="ln-1080"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-1081"></a>				<span class="n">ENDIF</span>
<a name="ln-1082"></a>				<span class="n">DOLDALFA</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-1083"></a>				<span class="n">D</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-1084"></a>				<span class="n">X</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>
<a name="ln-1085"></a>				<span class="n">F</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1086"></a>
<a name="ln-1087"></a>
<a name="ln-1088"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="n">IOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1089"></a>
<a name="ln-1090"></a><span class="k">					</span><span class="n">RA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">FOTT</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-3</span><span class="p">,</span><span class="n">DMIN1</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="nb">DABS</span><span class="p">(</span><span class="n">FOTT</span><span class="p">))</span> <span class="p">)</span>
<a name="ln-1091"></a>					<span class="n">RB</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">,</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">))</span>
<a name="ln-1092"></a>					<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="p">((</span><span class="n">F</span><span class="o">-</span><span class="n">FOTT</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-3</span><span class="p">,</span><span class="n">DMIN1</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="nb">DABS</span><span class="p">(</span><span class="n">FOTT</span><span class="p">))</span> <span class="p">)</span> <span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="mf">1.D+1</span>
<a name="ln-1093"></a><span class="c">!					L_F_DISTANTI = L_F_DISTANTI.AND.(ALFA &lt;= 1.D-4)</span>
<a name="ln-1094"></a>					<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="n">L_F_DISTANTI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.(</span><span class="n">ALFA</span> <span class="o">&lt;=</span> <span class="mf">1.D+1</span><span class="o">*</span><span class="n">ALFAOTT</span><span class="p">)</span>
<a name="ln-1095"></a>					<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="p">((</span><span class="n">F</span><span class="o">-</span><span class="n">FOTT</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-3</span><span class="p">,</span><span class="nb">DABS</span><span class="p">(</span><span class="n">FOTT</span><span class="p">)</span> <span class="p">)</span> <span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D-1</span>
<a name="ln-1096"></a><span class="c">!					L_F_VICINI = L_F_VICINI.AND.( (DSQRT(DOT_PRODUCT(X-XOTT,X-XOTT)) &lt;= 1.D-1) &amp;</span>
<a name="ln-1097"></a><span class="c">!								.OR. (ALFA.LE.1.D-1*ALFAOTT))</span>
<a name="ln-1098"></a>					<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="n">L_F_VICINI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.(</span> <span class="p">(</span><span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">,</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mf">1.D-1</span><span class="p">))</span>
<a name="ln-1099"></a>					<span class="n">NON_MINIMIZZ</span> <span class="o">=</span> <span class="n">L_F_DISTANTI</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">L_F_VICINI</span>
<a name="ln-1100"></a><span class="c">!					NON_MINIMIZZ = L_F_DISTANTI.AND.(ALFA.LE.1.D-4)</span>
<a name="ln-1101"></a>				<span class="k">ELSE</span>
<a name="ln-1102"></a><span class="k">					</span><span class="n">NON_MINIMIZZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1103"></a>					<span class="n">RA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.D0</span>
<a name="ln-1104"></a>					<span class="n">RB</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.D0</span>
<a name="ln-1105"></a>				<span class="n">ENDIF</span>
<a name="ln-1106"></a>				
<a name="ln-1107"></a>				<span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">NON_MINIMIZZ</span>
<a name="ln-1108"></a>				  
<a name="ln-1109"></a><span class="c">!			ENDDO</span>
<a name="ln-1110"></a>
<a name="ln-1111"></a>
<a name="ln-1112"></a>
<a name="ln-1113"></a><span class="c">!--------------------------------------------</span>
<a name="ln-1114"></a><span class="c">!	apro il file per fare i controlli</span>
<a name="ln-1115"></a><span class="c">!	sull&#39;alfamax</span>
<a name="ln-1116"></a><span class="c">!--------------------------------------------</span>
<a name="ln-1117"></a>			<span class="k">IF</span> <span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1118"></a>
<a name="ln-1119"></a><span class="k">				open</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="s1">&#39;alfamax.txt&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">)</span>
<a name="ln-1120"></a>				<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1121"></a>					<span class="k">write</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1999</span><span class="p">)</span> <span class="n">J</span><span class="p">,</span><span class="n">wks</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">alfamax</span><span class="p">,</span><span class="n">wks</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">fob</span><span class="p">,</span><span class="n">masch</span><span class="p">(</span><span class="n">J</span><span class="p">),</span> <span class="n">RA</span><span class="p">(</span><span class="n">J</span><span class="p">),</span> <span class="n">RB</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-1122"></a>					<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">1999</span><span class="p">)</span> <span class="n">J</span><span class="p">,</span><span class="n">wks</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">alfamax</span><span class="p">,</span><span class="n">wks</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">fob</span><span class="p">,</span><span class="n">masch</span><span class="p">(</span><span class="n">J</span><span class="p">),</span> <span class="n">RA</span><span class="p">(</span><span class="n">J</span><span class="p">),</span> <span class="n">RB</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-1123"></a>				<span class="n">enddo</span>
<a name="ln-1124"></a>
<a name="ln-1125"></a>			<span class="mi">1999</span> <span class="k">format</span><span class="p">(</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="n">i3</span><span class="p">,</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="n">es18</span><span class="p">.</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="n">es18</span><span class="p">.</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span> <span class="n">es9</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="n">x</span><span class="p">,</span> <span class="n">es9</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1126"></a>			<span class="c">!--------------------------------------------</span>
<a name="ln-1127"></a>			<span class="c">!	apro il file per fare i controlli</span>
<a name="ln-1128"></a>			<span class="c">!	sull&#39;alfamax</span>
<a name="ln-1129"></a>			<span class="c">!--------------------------------------------</span>
<a name="ln-1130"></a>				<span class="k">close</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
<a name="ln-1131"></a>				<span class="c">!pause</span>
<a name="ln-1132"></a>
<a name="ln-1133"></a>			<span class="n">ENDIF</span>
<a name="ln-1134"></a>
<a name="ln-1135"></a><span class="c">!			DO I = 1,IDIMWKS</span>
<a name="ln-1136"></a>
<a name="ln-1137"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1138"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-1139"></a>				<span class="k">ELSE</span>
<a name="ln-1140"></a><span class="k">					</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-1141"></a>				<span class="n">ENDIF</span>
<a name="ln-1142"></a>				<span class="n">DOLDALFA</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-1143"></a>				<span class="n">D</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-1144"></a>				<span class="n">X</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>
<a name="ln-1145"></a>				<span class="n">F</span>        <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1146"></a>
<a name="ln-1147"></a>
<a name="ln-1148"></a><span class="c">!				IF(.TRUE.) THEN</span>
<a name="ln-1149"></a><span class="c">!				IF(	  (ALFA.GT.TOL).AND..NOT.MASCH(I)	)	THEN</span>
<a name="ln-1150"></a><span class="c">!				IF(	  (ALFA.GT.TOL).AND..NOT.MASCH(I).AND. (ALFA.GT.1.D-3*ALFAMAX)	)	THEN</span>
<a name="ln-1151"></a>				<span class="k">IF</span><span class="p">(</span>	 <span class="p">((</span><span class="n">ALFA</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">TOL</span><span class="p">).</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="nb">AND</span><span class="p">.</span> <span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="mf">1.D-1</span><span class="o">*</span><span class="n">ALFAMAX</span><span class="p">)).</span><span class="nb">OR</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-1152"></a>				   	 <span class="p">((</span><span class="n">ALFA</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">TOL</span><span class="p">).</span><span class="nb">AND</span><span class="p">..</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="nb">AND</span><span class="p">.</span> <span class="p">(</span><span class="n">I</span> <span class="o">==</span> <span class="n">IOTT</span><span class="p">)))</span>	<span class="k">THEN</span>
<a name="ln-1153"></a>
<a name="ln-1154"></a><span class="k">					</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1155"></a><span class="c">!					FMAX_EFF = F</span>
<a name="ln-1156"></a><span class="c">!					WRITE(*,*)&#39;X=&#39;,X</span>
<a name="ln-1157"></a><span class="c">!					WRITE(*,*)&#39;F=&#39;,F</span>
<a name="ln-1158"></a>					<span class="k">CALL </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FMAX_EFF</span><span class="p">,&amp;</span>
<a name="ln-1159"></a>					<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1160"></a>					<span class="k">if</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="n">fmax_eff</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1161"></a><span class="k">						write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---&gt; 1 &lt;--- diff = &#39;</span><span class="p">,</span><span class="n">f</span><span class="o">-</span><span class="n">fmax_eff</span>
<a name="ln-1162"></a><span class="c">!						pause</span>
<a name="ln-1163"></a>					<span class="n">endif</span>
<a name="ln-1164"></a><span class="c">!					WRITE(*,*)&#39;X=&#39;,X</span>
<a name="ln-1165"></a><span class="c">!					WRITE(*,*)&#39;F=&#39;,F</span>
<a name="ln-1166"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">X</span>
<a name="ln-1167"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">F</span>
<a name="ln-1168"></a><span class="c">!					PAUSE</span>
<a name="ln-1169"></a>					<span class="c">!IF(WKS(I)%ALFAMAX &gt; ALFA) THEN</span>
<a name="ln-1170"></a>					<span class="c">!	WRITE(*,*) &#39;\/\/\/\/\/ &#39;,F,&#39; \/\/\/\/\/\ &#39;,FMAX_EFF !/\/\/\/\/&#39;, I</span>
<a name="ln-1171"></a>					<span class="c">!ENDIF</span>
<a name="ln-1172"></a>					<span class="k">IF</span><span class="p">(</span><span class="n">ALFA</span> <span class="o">&gt;=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1173"></a><span class="k">						</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1174"></a>					<span class="k">ELSE</span>
<a name="ln-1175"></a><span class="k">						</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1176"></a>					<span class="n">ENDIF</span>
<a name="ln-1177"></a>
<a name="ln-1178"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-1179"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-1180"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-1181"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FSTOP</span>
<a name="ln-1182"></a>					<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1183"></a><span class="k">						write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 5 ----&#39;</span>
<a name="ln-1184"></a>					<span class="n">endif</span>
<a name="ln-1185"></a>					<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-1186"></a>					<span class="k">IF</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN	</span>
<a name="ln-1187"></a><span class="k">						CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-1188"></a>					<span class="n">ENDIF</span>
<a name="ln-1189"></a>					<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1190"></a><span class="k">						DO WHILE</span> <span class="p">(</span><span class="n">ALFA</span> <span class="o">&gt;=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span>
<a name="ln-1191"></a>							<span class="k">CALL </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FMAX_EFF</span><span class="p">,&amp;</span>
<a name="ln-1192"></a>						<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1193"></a>							<span class="k">if</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="n">fmax_eff</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1194"></a><span class="k">								write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---&gt; 2 &lt;---&#39;</span>
<a name="ln-1195"></a><span class="c">!								pause</span>
<a name="ln-1196"></a>							<span class="n">endif</span>
<a name="ln-1197"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">X</span>
<a name="ln-1198"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">F</span>
<a name="ln-1199"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-1200"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-1201"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-1202"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FSTOP</span>
<a name="ln-1203"></a>							<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1204"></a><span class="k">								write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 6 ----&#39;</span>
<a name="ln-1205"></a>							<span class="n">endif</span>
<a name="ln-1206"></a>							<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-1207"></a>							<span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">ALFA</span><span class="p">,</span><span class="n">F</span>
<a name="ln-1208"></a>						<span class="n">ENDDO</span>
<a name="ln-1209"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">NUMCOST</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1210"></a>					<span class="n">ENDIF</span>
<a name="ln-1211"></a>				<span class="k">ELSE</span>
<a name="ln-1212"></a><span class="k">					IF</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.)</span> <span class="k">THEN</span>
<a name="ln-1213"></a><span class="c">!					IF(NON_MINIMIZZ) THEN</span>
<a name="ln-1214"></a>						<span class="k">IF</span><span class="p">(</span><span class="n">PRINT_LEVEL</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1215"></a><span class="k">							WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;SOSTITUISCO IL PUNTO &#39;</span><span class="p">,</span><span class="n">I</span>
<a name="ln-1216"></a>						<span class="n">ENDIF</span>
<a name="ln-1217"></a>						<span class="k">CALL </span><span class="n">GENERA_PUNTO_SA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">TCOEFF</span><span class="p">,</span><span class="n">IVAR</span><span class="p">,</span><span class="n">IVAR2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1218"></a>								     <span class="n">VAR2</span><span class="p">,</span><span class="n">RMED</span><span class="p">,</span><span class="n">RMED2</span><span class="p">,</span><span class="n">NLM</span><span class="p">,</span><span class="n">NUMFAL</span><span class="p">,</span><span class="n">RFAL</span><span class="p">,</span><span class="n">RNUMFAL</span><span class="p">,</span><span class="n">ICONTFAL</span><span class="p">,</span><span class="n">IDFAL</span><span class="p">,</span><span class="n">NPC</span><span class="p">,</span><span class="n">NF</span><span class="p">,&amp;</span>
<a name="ln-1219"></a>							<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,&amp;</span>
<a name="ln-1220"></a>  							<span class="n">calfun</span><span class="p">)</span>
<a name="ln-1221"></a>						<span class="n">ALFA</span>     <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-1222"></a>						<span class="n">FSTOP</span>    <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-1223"></a>						<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1224"></a>							<span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">J</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-1225"></a><span class="k">								IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FSTOP</span> <span class="o">&gt;</span> <span class="n">FSTOP</span><span class="p">)</span> <span class="n">FSTOP</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FSTOP</span>								
<a name="ln-1226"></a>								<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1227"></a><span class="k">									IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFANR2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1228"></a><span class="k">										</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-1229"></a>									<span class="n">ENDIF</span>
<a name="ln-1230"></a>								<span class="k">ELSE</span>
<a name="ln-1231"></a><span class="k">									IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1232"></a><span class="k">										</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-1233"></a>									<span class="n">ENDIF</span>
<a name="ln-1234"></a>								<span class="n">ENDIF</span>
<a name="ln-1235"></a>							<span class="n">ENDIF</span>
<a name="ln-1236"></a>						<span class="n">ENDDO</span>
<a name="ln-1237"></a><span class="c">!						ALFAMAX = ALFA</span>
<a name="ln-1238"></a>
<a name="ln-1239"></a>						<span class="n">ALFA</span> <span class="o">=</span> <span class="n">ALFAMAX</span>
<a name="ln-1240"></a>						<span class="k">CALL </span><span class="n">INTERFACCIA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span>	<span class="p">&amp;</span>
<a name="ln-1241"></a>							<span class="n">XSUP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAMAX</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">,&amp;</span>
<a name="ln-1242"></a>						<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,&amp;</span>
<a name="ln-1243"></a>						<span class="n">calfun</span><span class="p">)</span>
<a name="ln-1244"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">XPROP</span>
<a name="ln-1245"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">FPROP</span>
<a name="ln-1246"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-1247"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-1248"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-1249"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FFSTOP</span>
<a name="ln-1250"></a>						<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1251"></a><span class="k">							write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 7 ----&#39;</span>
<a name="ln-1252"></a>						<span class="n">endif</span>
<a name="ln-1253"></a>						<span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-1254"></a>						<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1255"></a><span class="k">							CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-1256"></a>						<span class="n">ENDIF</span>
<a name="ln-1257"></a>						<span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1258"></a>					<span class="k">ELSE</span>
<a name="ln-1259"></a><span class="k">						</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1260"></a>					<span class="n">ENDIF</span>
<a name="ln-1261"></a>				<span class="n">ENDIF</span>
<a name="ln-1262"></a>
<a name="ln-1263"></a>			<span class="n">ENDDO</span>
<a name="ln-1264"></a>		<span class="n">ENDIF</span>
<a name="ln-1265"></a>	<span class="k">else</span> <span class="c">!fai la ricerca lungo gli assi solo per</span>
<a name="ln-1266"></a>		 <span class="c">!il punto con l&#39;alfa maggiore</span>
<a name="ln-1267"></a>
<a name="ln-1268"></a>		<span class="n">ALFA</span>     <span class="o">=</span> <span class="mf">0.0D0</span>
<a name="ln-1269"></a>		<span class="n">FMIN</span>     <span class="o">=</span> <span class="mf">1.0D+30</span>
<a name="ln-1270"></a>		<span class="n">FMAX</span>     <span class="o">=-</span><span class="mf">1.0D+30</span>
<a name="ln-1271"></a>		<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1272"></a>			<span class="k">IF</span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-1273"></a><span class="k">				IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1274"></a><span class="k">					IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1275"></a><span class="k">						</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFANR2</span>
<a name="ln-1276"></a>						<span class="n">DOLDALFA</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-1277"></a>						<span class="n">IMAX</span>     <span class="o">=</span> <span class="n">I</span>
<a name="ln-1278"></a>					<span class="n">ENDIF</span>
<a name="ln-1279"></a>				<span class="k">ELSE</span>
<a name="ln-1280"></a><span class="k">					IF</span><span class="p">(</span><span class="n">ALFA</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1281"></a><span class="k">						</span><span class="n">ALFA</span>     <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">ALFAMAX</span>
<a name="ln-1282"></a>						<span class="n">DOLDALFA</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span>
<a name="ln-1283"></a>						<span class="n">IMAX</span>     <span class="o">=</span> <span class="n">I</span>
<a name="ln-1284"></a>					<span class="n">ENDIF</span>
<a name="ln-1285"></a>				<span class="n">ENDIF</span>
<a name="ln-1286"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&lt;</span> <span class="n">FMIN</span><span class="p">)</span> <span class="n">FMIN</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1287"></a>				<span class="k">IF</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&gt;</span> <span class="n">FMAX</span><span class="p">)</span> <span class="n">FMAX</span> <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1288"></a>			<span class="n">ENDIF</span>
<a name="ln-1289"></a>		<span class="n">ENDDO</span>
<a name="ln-1290"></a>
<a name="ln-1291"></a>		<span class="n">D</span>    <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">D</span>
<a name="ln-1292"></a>		<span class="n">X</span>    <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">X</span>
<a name="ln-1293"></a>		<span class="n">F</span>    <span class="o">=</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span>
<a name="ln-1294"></a>		<span class="k">CALL </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FMAX_EFF</span><span class="p">,&amp;</span>
<a name="ln-1295"></a>		<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1296"></a>		<span class="k">if</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="n">fmax_eff</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1297"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---&gt; 3 &lt;---&#39;</span>
<a name="ln-1298"></a><span class="c">!			pause</span>
<a name="ln-1299"></a>		<span class="n">endif</span>
<a name="ln-1300"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">X</span>       <span class="o">=</span> <span class="n">X</span>
<a name="ln-1301"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span>     <span class="o">=</span> <span class="n">F</span>
<a name="ln-1302"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">ALFAMAX</span> <span class="o">=</span> <span class="n">ALFA</span>
<a name="ln-1303"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="o">=</span> <span class="n">DOLDALFA</span>
<a name="ln-1304"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">D</span>       <span class="o">=</span> <span class="n">D</span>
<a name="ln-1305"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FSTOP</span>   <span class="o">=</span> <span class="n">FSTOP</span>
<a name="ln-1306"></a>		<span class="k">if</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0d0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1307"></a><span class="k">			write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;---- 8 ----&#39;</span>
<a name="ln-1308"></a>		<span class="n">endif</span>
<a name="ln-1309"></a>		<span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">ALFANR2</span> <span class="o">=</span> <span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">))</span>
<a name="ln-1310"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1311"></a><span class="k">			CALL </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-1312"></a>		<span class="n">ENDIF</span>
<a name="ln-1313"></a>
<a name="ln-1314"></a>	<span class="n">endif</span>
<a name="ln-1315"></a>
<a name="ln-1316"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">CSTEP</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="s1">&#39;NO&#39;</span><span class="p">)</span> <span class="n">CSTEP</span> <span class="o">=</span> <span class="s1">&#39;KO&#39;</span>
<a name="ln-1317"></a>		
<a name="ln-1318"></a>	<span class="n">GO</span> <span class="n">TO</span> <span class="mi">8</span>
<a name="ln-1319"></a>
<a name="ln-1320"></a><span class="mi">170</span> <span class="k">CONTINUE</span>
<a name="ln-1321"></a>
<a name="ln-1322"></a><span class="k">	IF</span><span class="p">(</span><span class="n">NFOTT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1323"></a><span class="k">		</span><span class="n">NFOTT</span> <span class="o">=</span> <span class="n">NF</span>
<a name="ln-1324"></a>		<span class="n">F_OTT</span> <span class="o">=</span> <span class="n">FOTT</span>
<a name="ln-1325"></a>	<span class="n">ENDIF</span>
<a name="ln-1326"></a>
<a name="ln-1327"></a>	<span class="n">LSTOT</span>  <span class="o">=</span> <span class="n">LSTOT</span>  <span class="o">+</span> <span class="n">LS</span>
<a name="ln-1328"></a>	<span class="n">NFTOT</span>  <span class="o">=</span> <span class="n">NFTOT</span>  <span class="o">+</span> <span class="n">NF</span>
<a name="ln-1329"></a>	<span class="n">NPCTOT</span> <span class="o">=</span> <span class="n">NPCTOT</span> <span class="o">+</span> <span class="n">NPC</span>
<a name="ln-1330"></a>	<span class="n">NLMTOT</span> <span class="o">=</span> <span class="n">NLMTOT</span> <span class="o">+</span> <span class="n">NLM</span>
<a name="ln-1331"></a>
<a name="ln-1332"></a>	<span class="n">VECTNF</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>   <span class="o">=</span> <span class="n">NF</span>
<a name="ln-1333"></a>	<span class="n">VECTFVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span> <span class="o">=</span> <span class="n">FOTT</span>
<a name="ln-1334"></a>	<span class="n">VECTNFOTT</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="o">=</span> <span class="n">NFOTT</span>
<a name="ln-1335"></a>	<span class="n">VECTF_OTT</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="o">=</span> <span class="n">F_OTT</span>
<a name="ln-1336"></a>
<a name="ln-1337"></a>	<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-1338"></a>		<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">X</span><span class="p">)</span>
<a name="ln-1339"></a>		<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">DOLDALFA</span><span class="p">)</span>
<a name="ln-1340"></a>		<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1341"></a>	<span class="n">ENDDO</span>
<a name="ln-1342"></a>	<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">WKS</span><span class="p">,</span><span class="n">MASCH</span><span class="p">)</span>
<a name="ln-1343"></a>
<a name="ln-1344"></a><span class="mi">171</span> <span class="k">CONTINUE</span>
<a name="ln-1345"></a>
<a name="ln-1346"></a><span class="k">	</span><span class="n">sumiter</span>  <span class="o">=</span> <span class="mf">0.D0</span> <span class="p">;</span> <span class="n">sumnf</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">sumtime</span> <span class="o">=</span> <span class="mf">0.0D0</span> 
<a name="ln-1347"></a>	<span class="n">f_min1</span>   <span class="o">=</span> <span class="mf">1.D+30</span>
<a name="ln-1348"></a>	<span class="n">f_minott</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-1349"></a>	<span class="n">f_min</span>    <span class="o">=</span> <span class="mf">1.D+30</span>
<a name="ln-1350"></a>	<span class="n">f_mintot</span> <span class="o">=</span> <span class="mf">0.D0</span>
<a name="ln-1351"></a>	<span class="n">f_max</span>    <span class="o">=</span> <span class="o">-</span><span class="mf">1.D+30</span>
<a name="ln-1352"></a>
<a name="ln-1353"></a>	<span class="k">DO </span><span class="n">IT</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Iruns</span>
<a name="ln-1354"></a>		<span class="n">SUMNF</span> <span class="o">=</span> <span class="n">SUMNF</span> <span class="o">+</span> <span class="n">VECTNFOTT</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1355"></a>		<span class="n">f_mintot</span> <span class="o">=</span> <span class="n">f_mintot</span> <span class="o">+</span> <span class="n">vectfVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1356"></a>		<span class="n">f_minott</span> <span class="o">=</span> <span class="n">f_minott</span> <span class="o">+</span> <span class="n">vectf_ott</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1357"></a>		<span class="k">IF</span> <span class="p">(</span><span class="n">f_min</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">vectfVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">))</span> <span class="n">f_min</span> <span class="o">=</span> <span class="n">vectfVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1358"></a>		<span class="k">IF</span> <span class="p">(</span><span class="n">f_min1</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">vectf_ott</span><span class="p">(</span><span class="n">IT</span><span class="p">))</span> <span class="n">f_min1</span> <span class="o">=</span> <span class="n">vectf_ott</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1359"></a>		<span class="k">IF</span> <span class="p">(</span><span class="n">f_max</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">vectfVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">))</span> <span class="n">f_max</span> <span class="o">=</span> <span class="n">vectfVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span>
<a name="ln-1360"></a>	<span class="k">END DO</span>
<a name="ln-1361"></a>
<a name="ln-1362"></a>	<span class="c">!write(TABELLA,2030) nomefun, n, NFTOT/IRUNS, SUMNF/IRUNS</span>
<a name="ln-1363"></a>	
<a name="ln-1364"></a>	<span class="n">F_MINTOT</span> <span class="o">=</span> <span class="n">F_MINTOT</span><span class="o">/</span><span class="n">IRUNS</span>
<a name="ln-1365"></a>	<span class="n">F_MINOTT</span> <span class="o">=</span> <span class="n">F_MINOTT</span><span class="o">/</span><span class="n">IRUNS</span>
<a name="ln-1366"></a>
<a name="ln-1367"></a>	<span class="c">!IF (DABS(F_MIN).LT.1.D-3) THEN</span>
<a name="ln-1368"></a><span class="c">!		WRITE(TABELLA,2110) F_MIN</span>
<a name="ln-1369"></a><span class="c">!	ELSE</span>
<a name="ln-1370"></a><span class="c">!		WRITE(TABELLA,2100) F_MIN</span>
<a name="ln-1371"></a><span class="c">!	ENDIF</span>
<a name="ln-1372"></a><span class="c">!	IF (DABS(F_MINTOT).LT.1.D-3) THEN</span>
<a name="ln-1373"></a><span class="c">!		WRITE(TABELLA,2110) F_MINTOT</span>
<a name="ln-1374"></a><span class="c">!	ELSE</span>
<a name="ln-1375"></a><span class="c">!		WRITE(TABELLA,2100) F_MINTOT</span>
<a name="ln-1376"></a><span class="c">!	ENDIF</span>
<a name="ln-1377"></a><span class="c">!	IF (DABS(F_MIN1).LT.1.D-3) THEN</span>
<a name="ln-1378"></a><span class="c">!		WRITE(TABELLA,2110) F_MIN1</span>
<a name="ln-1379"></a><span class="c">!	ELSE</span>
<a name="ln-1380"></a><span class="c">!		WRITE(TABELLA,2100) F_MIN1</span>
<a name="ln-1381"></a><span class="c">!	ENDIF</span>
<a name="ln-1382"></a><span class="c">!	IF (DABS(F_MINOTT).LT.1.D-3) THEN</span>
<a name="ln-1383"></a><span class="c">!		WRITE(TABELLA,2110) F_MINOTT</span>
<a name="ln-1384"></a><span class="c">!	ELSE</span>
<a name="ln-1385"></a><span class="c">!		WRITE(TABELLA,2100) F_MINOTT</span>
<a name="ln-1386"></a><span class="c">!	ENDIF</span>
<a name="ln-1387"></a><span class="c">!	WRITE(TABELLA,2110) (F_MINOTT-fglob)/max(1.0d0,abs(fglob))</span>
<a name="ln-1388"></a><span class="c">!	</span>
<a name="ln-1389"></a>	<span class="c">!if((F_MINOTT-fglob)/max(1.0d0,abs(fglob))&lt;1.d-4) then</span>
<a name="ln-1390"></a><span class="c">!		iok = 1</span>
<a name="ln-1391"></a><span class="c">!	else</span>
<a name="ln-1392"></a><span class="c">!		iok = 0</span>
<a name="ln-1393"></a><span class="c">!	endif</span>
<a name="ln-1394"></a>
<a name="ln-1395"></a>	<span class="n">NFAILS</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1396"></a>	<span class="k">DO </span><span class="n">IT</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IRUNS</span>
<a name="ln-1397"></a>		<span class="k">IF</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">VECTFVAL</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="o">-</span><span class="n">F_MIN</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="mf">1.0d-2</span><span class="p">)</span> <span class="n">NFAILS</span> <span class="o">=</span> <span class="n">NFAILS</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1398"></a>	<span class="n">ENDDO</span>
<a name="ln-1399"></a>	<span class="c">!WRITE(TABELLA,2120) NFAILS</span>
<a name="ln-1400"></a><span class="c">!	WRITE(TABELLA,2180)</span>
<a name="ln-1401"></a>
<a name="ln-1402"></a><span class="c">!	DEALLOCATE(XINF,XSUP)</span>
<a name="ln-1403"></a>	<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">VETT</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
<a name="ln-1404"></a>	<span class="k">DEALLOCATE</span><span class="p">(</span><span class="n">RA</span><span class="p">,</span><span class="n">RB</span><span class="p">,</span><span class="n">IPERM</span><span class="p">)</span>
<a name="ln-1405"></a>
<a name="ln-1406"></a><span class="mi">2100</span> <span class="k">FORMAT</span><span class="p">(</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">ES12</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="err">$</span><span class="p">)</span>
<a name="ln-1407"></a><span class="mi">2110</span> <span class="k">FORMAT</span><span class="p">(</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">D10</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="p">)</span>
<a name="ln-1408"></a>
<a name="ln-1409"></a><span class="mi">2030</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">A40</span><span class="p">,</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">I2</span><span class="p">,</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">I6</span><span class="p">,</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">I6</span><span class="p">,</span> <span class="err">$</span><span class="p">)</span>
<a name="ln-1410"></a><span class="c">!2100 FORMAT(&#39; &amp; &#39;,F13.4,$)</span>
<a name="ln-1411"></a><span class="c">!2110 FORMAT(&#39; &amp; &#39;,D9.3,$)</span>
<a name="ln-1412"></a><span class="mi">2120</span> <span class="k">FORMAT</span><span class="p">(</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">I4</span><span class="p">,</span><span class="s1">&#39;\\&#39;</span><span class="p">)</span>
<a name="ln-1413"></a><span class="mi">2180</span> <span class="k">FORMAT</span><span class="p">(</span><span class="s1">&#39; \\ &#39;</span><span class="p">)</span>
<a name="ln-1414"></a><span class="mi">2140</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">I3</span><span class="p">,</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="err">$</span><span class="p">)</span>
<a name="ln-1415"></a><span class="mi">2150</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="err">$</span><span class="p">)</span>
<a name="ln-1416"></a><span class="mi">2160</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">I6</span><span class="p">,</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="err">$</span><span class="p">)</span>
<a name="ln-1417"></a><span class="mi">2170</span> <span class="k">FORMAT</span><span class="p">(</span><span class="n">I6</span><span class="p">,</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="n">I3</span><span class="p">)</span>
<a name="ln-1418"></a>
<a name="ln-1419"></a><span class="mi">691</span> <span class="k">FORMAT</span><span class="p">(</span><span class="o">/</span><span class="p">,</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NFTOT=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NPCTOT=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; NLMTOT=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="mi">4</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39; LSTOT=&#39;</span><span class="p">,</span><span class="n">I7</span><span class="p">,</span><span class="o">/</span><span class="p">)</span>
<a name="ln-1420"></a>
<a name="ln-1421"></a><span class="k">END SUBROUTINE </span><span class="n">SENZADERGLOB</span>
<a name="ln-1422"></a>
<a name="ln-1423"></a><span class="c">!==============================================================================================</span>
<a name="ln-1424"></a><span class="c">!==============================================================================================</span>
<a name="ln-1425"></a><span class="c">!==============================================================================================</span>
<a name="ln-1426"></a>
<a name="ln-1427"></a><span class="k">SUBROUTINE </span><span class="n">AGGIORNO_OTTIMO</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">FOTT</span><span class="p">)</span>
<a name="ln-1428"></a>	<span class="k">IMPLICIT NONE</span>
<a name="ln-1429"></a>
<a name="ln-1430"></a><span class="k">	</span><span class="kt">INTEGER</span><span class="p">,</span>	  <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">N</span>
<a name="ln-1431"></a>	<span class="kt">DOUBLE PRECISION</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">XPROP</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">FPROP</span>
<a name="ln-1432"></a>	<span class="kt">DOUBLE PRECISION</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span>		<span class="kd">::</span> <span class="n">XOTT</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>  <span class="n">FOTT</span>
<a name="ln-1433"></a>	<span class="kt">INTEGER</span>					<span class="kd">::</span> <span class="n">I</span>
<a name="ln-1434"></a>
<a name="ln-1435"></a>	<span class="n">XOTT</span> <span class="o">=</span> <span class="n">XPROP</span>
<a name="ln-1436"></a>	<span class="n">FOTT</span> <span class="o">=</span> <span class="n">FPROP</span>
<a name="ln-1437"></a>
<a name="ln-1438"></a>	<span class="k">RETURN</span>
<a name="ln-1439"></a>
<a name="ln-1440"></a><span class="k">	OPEN</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="s1">&#39;OttimoCorrente.txt&#39;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">)</span>
<a name="ln-1441"></a>	<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1442"></a>		<span class="k">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="n">I</span><span class="p">,</span> <span class="n">XOTT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1443"></a>	<span class="n">ENDDO</span>
<a name="ln-1444"></a>	<span class="k">WRITE</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1010</span><span class="p">)</span> <span class="n">FOTT</span>
<a name="ln-1445"></a>	<span class="k">CLOSE</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
<a name="ln-1446"></a>
<a name="ln-1447"></a><span class="mi">1000</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;XOTT(&#39;</span><span class="p">,</span><span class="n">I3</span><span class="p">,</span><span class="s1">&#39;) = &#39;</span><span class="p">,</span><span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1448"></a><span class="mi">1010</span> <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="s1">&#39;FOTT      = &#39;</span><span class="p">,</span><span class="n">ES11</span><span class="p">.</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1449"></a>
<a name="ln-1450"></a>	<span class="k">RETURN</span>
<a name="ln-1451"></a>
<a name="ln-1452"></a><span class="k">END SUBROUTINE </span><span class="n">AGGIORNO_OTTIMO</span>
<a name="ln-1453"></a>
<a name="ln-1454"></a><span class="c">!==============================================================================================</span>
<a name="ln-1455"></a><span class="c">!==============================================================================================</span>
<a name="ln-1456"></a><span class="c">!==============================================================================================</span>
<a name="ln-1457"></a>
<a name="ln-1458"></a><span class="k">SUBROUTINE </span><span class="n">RICERCA_LUNGO_ASSI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">FF</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FMAX_EFF</span><span class="p">,</span><span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,&amp;</span>
<a name="ln-1459"></a>                              <span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1460"></a>	<span class="k">IMPLICIT NONE</span>
<a name="ln-1461"></a><span class="k">	</span><span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span> <span class="n">NN</span> <span class="p">,</span> <span class="n">nf</span>  
<a name="ln-1462"></a>
<a name="ln-1463"></a>	<span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">IDIR_CORR</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">NUM_NOTFAL</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1464"></a>	<span class="kt">INTEGER </span><span class="n">MAX_NOTFAL</span><span class="p">,</span><span class="n">NUM_FAL</span><span class="p">,</span><span class="n">ISTOP</span>
<a name="ln-1465"></a>	<span class="kt">INTEGER </span><span class="n">IPUNT</span><span class="p">,</span><span class="n">NUM_PARAM</span>
<a name="ln-1466"></a>	<span class="kt">INTEGER </span><span class="n">IPRINT</span>
<a name="ln-1467"></a>	<span class="kt">INTEGER	</span><span class="n">ENV</span><span class="p">,</span> <span class="nb">LINK</span>
<a name="ln-1468"></a><span class="nb">        </span><span class="k">PROCEDURE</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="n">calfun</span>
<a name="ln-1469"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-1470"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-1471"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-1472"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-1473"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-1474"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-1475"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1476"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-1477"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1478"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1479"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-1480"></a>
<a name="ln-1481"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FMAX_EFF</span>
<a name="ln-1482"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DIREZIONI</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOLD</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1483"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="nb">GAMMA</span><span class="p">,</span><span class="n">RHO</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">FF</span><span class="p">,</span><span class="n">FZ</span><span class="p">,</span><span class="n">FTAR</span><span class="p">,</span><span class="n">F0</span><span class="p">,</span><span class="n">DSTOP</span><span class="p">,</span><span class="n">FFSTOP</span>   
<a name="ln-1484"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DCONV</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">FINIT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 
<a name="ln-1485"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FSTOP</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XINF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XSUP</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">ALFA_MIN</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1486"></a>
<a name="ln-1487"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">F</span>
<a name="ln-1488"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW2</span><span class="o">/</span><span class="n">NUM_FUNCT</span>
<a name="ln-1489"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NF</span>
<a name="ln-1490"></a>
<a name="ln-1491"></a>
<a name="ln-1492"></a>	<span class="n">F</span> <span class="o">=</span> <span class="n">FF</span>
<a name="ln-1493"></a>
<a name="ln-1494"></a>
<a name="ln-1495"></a>	<span class="n">IPRINT</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1496"></a>
<a name="ln-1497"></a>	<span class="c">!call funct(x,n,ff)</span>
<a name="ln-1498"></a>        <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1499"></a>                                <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-1500"></a><span class="c">!	write(*,*) &#39;/--------------------------------------\&#39;</span>
<a name="ln-1501"></a><span class="c">!	write(*,*) &#39;ric.assi: ff = &#39;,ff,&#39; f = &#39;,f</span>
<a name="ln-1502"></a>
<a name="ln-1503"></a><span class="c">!	CALL MAINBOX1(N,X,D,DIREZIONI,Z,Z1,XOLD,NUM_ITER,DOLDALFA,IPRINT,DCONV,FSTOP,XFSTOP,FINIT,XINF,XSUP,ALFA_MIN,FFSTOP,FMAX_EFF)</span>
<a name="ln-1504"></a>	<span class="k">CALL </span><span class="n">MAINBOX1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">DIREZIONI</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XOLD</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">IPRINT</span><span class="p">,</span><span class="n">DCONV</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XFSTOP</span><span class="p">,</span><span class="n">FINIT</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,&amp;</span>
<a name="ln-1505"></a>			<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1506"></a>
<a name="ln-1507"></a>	<span class="n">ALFA</span> <span class="o">=</span> <span class="nb">MAXVAL</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">)</span>
<a name="ln-1508"></a>
<a name="ln-1509"></a>	<span class="n">num_funct</span> <span class="o">=</span> <span class="n">num_funct</span> <span class="o">+</span> <span class="n">nf</span>
<a name="ln-1510"></a>
<a name="ln-1511"></a><span class="c">!	call funct(x,n,ff)</span>
<a name="ln-1512"></a>	<span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1513"></a>                                <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-1514"></a>
<a name="ln-1515"></a>
<a name="ln-1516"></a>	<span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">ff</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1517"></a><span class="k">		write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ric.assi: ff = &#39;</span><span class="p">,</span><span class="n">ff</span><span class="p">,</span><span class="s1">&#39; f = &#39;</span><span class="p">,</span><span class="n">f</span>
<a name="ln-1518"></a>		<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">x</span>
<a name="ln-1519"></a>	    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;\--------------------------------------/&#39;</span>
<a name="ln-1520"></a><span class="c">!		pause</span>
<a name="ln-1521"></a>	<span class="n">endif</span>
<a name="ln-1522"></a>
<a name="ln-1523"></a>	<span class="n">FF</span> <span class="o">=</span> <span class="n">F</span>
<a name="ln-1524"></a>	
<a name="ln-1525"></a>
<a name="ln-1526"></a>	<span class="k">RETURN</span>
<a name="ln-1527"></a>
<a name="ln-1528"></a><span class="k">END SUBROUTINE </span><span class="n">RICERCA_LUNGO_ASSI</span>
<a name="ln-1529"></a>
<a name="ln-1530"></a><span class="c">!==============================================================================================</span>
<a name="ln-1531"></a><span class="c">!==============================================================================================</span>
<a name="ln-1532"></a><span class="c">!==============================================================================================</span>
<a name="ln-1533"></a>
<a name="ln-1534"></a><span class="k">SUBROUTINE </span><span class="n">INTERFACCIA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">FF</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAMAX</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span>	<span class="p">&amp;</span>
<a name="ln-1535"></a>		       <span class="n">XOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">,</span><span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,&amp;</span>
<a name="ln-1536"></a>                       <span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1537"></a>	<span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1538"></a>	<span class="k">IMPLICIT NONE</span>
<a name="ln-1539"></a>
<a name="ln-1540"></a><span class="c">!	INCLUDE &#39;TYPEDECL.FI&#39;</span>
<a name="ln-1541"></a>
<a name="ln-1542"></a>	<span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span> <span class="n">NN</span> <span class="p">,</span> <span class="n">nf</span>  
<a name="ln-1543"></a>
<a name="ln-1544"></a>	<span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">IDIR_CORR</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">NUM_NOTFAL</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">MAXNF</span>
<a name="ln-1545"></a>	<span class="kt">INTEGER </span><span class="n">MAX_NOTFAL</span><span class="p">,</span><span class="n">NUM_FAL</span><span class="p">,</span><span class="n">ISTOP</span>
<a name="ln-1546"></a>	<span class="kt">INTEGER </span><span class="n">IPUNT</span><span class="p">,</span><span class="n">NUM_PARAM</span>
<a name="ln-1547"></a>	<span class="kt">INTEGER </span><span class="n">IPRINT</span>
<a name="ln-1548"></a>	<span class="kt">INTEGER	</span><span class="n">ENV</span><span class="p">,</span> <span class="nb">LINK</span>
<a name="ln-1549"></a><span class="nb">      </span><span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-1550"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-1551"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-1552"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-1553"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-1554"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-1555"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1556"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-1557"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1558"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1559"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-1560"></a>      <span class="k">procedure</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-1561"></a>
<a name="ln-1562"></a>
<a name="ln-1563"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DIREZIONI</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOLD</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOTT</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">fglob</span>
<a name="ln-1564"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="nb">GAMMA</span><span class="p">,</span><span class="n">RHO</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">FF</span><span class="p">,</span><span class="n">FZ</span><span class="p">,</span><span class="n">FTAR</span><span class="p">,</span><span class="n">F0</span><span class="p">,</span><span class="n">DSTOP</span><span class="p">,</span><span class="n">ALFAOTT</span>    
<a name="ln-1565"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FFSTOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAMAX</span>
<a name="ln-1566"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DCONV</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">FINIT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 
<a name="ln-1567"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FSTOP</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XINF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XSUP</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">ALFA_MIN</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1568"></a>	<span class="k">TYPE</span><span class="p">(</span><span class="n">COMP_WKS_TYP</span><span class="p">)</span>	<span class="kd">::</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-1569"></a>	<span class="kt">LOGICAL </span><span class="n">MASCH</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-1570"></a>
<a name="ln-1571"></a>
<a name="ln-1572"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">F</span>
<a name="ln-1573"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW2</span><span class="o">/</span><span class="n">NUM_FUNCT</span>
<a name="ln-1574"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NF</span>
<a name="ln-1575"></a>
<a name="ln-1576"></a>
<a name="ln-1577"></a>	<span class="n">F</span> <span class="o">=</span> <span class="n">FF</span>
<a name="ln-1578"></a>
<a name="ln-1579"></a>	<span class="n">IPRINT</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a><span class="c">!	CALL MAINBOX2(N,X,D,DIREZIONI,Z,Z1,XOLD,NUM_ITER,DOLDALFA,ALFA,IPRINT,DCONV,FSTOP,XFSTOP,FINIT,XINF,XSUP,ALFA_MIN,FFSTOP,FFSTOPTOL,FOTT,ALFAMAX)</span>
<a name="ln-1582"></a>	<span class="k">CALL </span><span class="n">MAINBOX2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">DIREZIONI</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XOLD</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">IPRINT</span><span class="p">,</span><span class="n">DCONV</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XFSTOP</span><span class="p">,</span><span class="n">FINIT</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span><span class="p">,&amp;</span>
<a name="ln-1583"></a>					<span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,&amp;</span>
<a name="ln-1584"></a>					<span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1585"></a>	<span class="n">ALFA</span> <span class="o">=</span> <span class="nb">MAXVAL</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">)</span>
<a name="ln-1586"></a>
<a name="ln-1587"></a>	<span class="n">num_funct</span> <span class="o">=</span> <span class="n">num_funct</span> <span class="o">+</span> <span class="n">nf</span>
<a name="ln-1588"></a>
<a name="ln-1589"></a>	<span class="c">!call funct(x,n,ff)</span>
<a name="ln-1590"></a>	<span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1591"></a>                                <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-1592"></a>
<a name="ln-1593"></a><span class="c">!	write(*,*) &#39;ric.alfa: ff = &#39;,ff,&#39; f = &#39;,f</span>
<a name="ln-1594"></a>	
<a name="ln-1595"></a>	<span class="n">FF</span> <span class="o">=</span> <span class="n">F</span>
<a name="ln-1596"></a>
<a name="ln-1597"></a>	<span class="n">IPRINT</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1598"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1599"></a><span class="k">		WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">X</span>
<a name="ln-1600"></a>	<span class="n">ENDIF</span>
<a name="ln-1601"></a>		
<a name="ln-1602"></a>
<a name="ln-1603"></a>	<span class="k">RETURN</span>
<a name="ln-1604"></a>
<a name="ln-1605"></a><span class="k">END SUBROUTINE </span><span class="n">INTERFACCIA</span>
<a name="ln-1606"></a>
<a name="ln-1607"></a><span class="c">!==============================================================================================</span>
<a name="ln-1608"></a><span class="c">!==============================================================================================</span>
<a name="ln-1609"></a><span class="c">!==============================================================================================</span>
<a name="ln-1610"></a><span class="k">SUBROUTINE </span><span class="n">GENERA_PUNTO_SA</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">XPROP</span><span class="p">,</span><span class="n">FPROP</span><span class="p">,</span><span class="n">XINF</span><span class="p">,</span><span class="n">XSUP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">TCOEFF</span><span class="p">,</span><span class="n">IVAR</span><span class="p">,</span><span class="n">IVAR2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1611"></a>			   <span class="n">VAR2</span><span class="p">,</span><span class="n">RMED</span><span class="p">,</span><span class="n">RMED2</span><span class="p">,</span><span class="n">NLM</span><span class="p">,</span><span class="n">NUMFAL</span><span class="p">,</span><span class="n">RFAL</span><span class="p">,</span><span class="n">RNUMFAL</span><span class="p">,</span><span class="n">ICONTFAL</span><span class="p">,</span><span class="n">IDFAL</span><span class="p">,</span><span class="n">NPC</span><span class="p">,</span><span class="n">NF</span><span class="p">,&amp;</span>
<a name="ln-1612"></a>                           <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,&amp;</span>
<a name="ln-1613"></a>                           <span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1614"></a>	<span class="k">IMPLICIT NONE</span>
<a name="ln-1615"></a><span class="k">	</span>
<a name="ln-1616"></a><span class="k">	</span><span class="kt">INTEGER</span>					<span class="kd">::</span> <span class="n">N</span><span class="p">,</span> <span class="n">NLM</span><span class="p">,</span> <span class="n">NUMFAL</span><span class="p">,</span> <span class="n">ICONTFAL</span><span class="p">,</span> <span class="n">IDFAL</span>
<a name="ln-1617"></a>	<span class="kt">INTEGER</span>					<span class="kd">::</span> <span class="n">NPC</span><span class="p">,</span> <span class="n">NF</span>
<a name="ln-1618"></a>	<span class="kt">INTEGER</span><span class="o">*</span><span class="mi">4</span>				<span class="kd">::</span> <span class="n">IVAR</span><span class="p">,</span> <span class="n">IVAR2</span>
<a name="ln-1619"></a>	<span class="kt">DOUBLE PRECISION</span>			<span class="kd">::</span> <span class="n">XPROP</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">XINF</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">XSUP</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">FPROP</span><span class="p">,</span> <span class="n">FOTT</span><span class="p">,</span> <span class="n">TCOEFF</span>
<a name="ln-1620"></a>	<span class="kt">DOUBLE PRECISION</span>			<span class="kd">::</span> <span class="n">VAR2</span><span class="p">,</span> <span class="n">RMED</span><span class="p">,</span> <span class="n">RMED2</span><span class="p">,</span> <span class="n">RFAL</span><span class="p">,</span> <span class="n">RNUMFAL</span>
<a name="ln-1621"></a>	<span class="kt">DOUBLE PRECISION</span>			<span class="kd">::</span> <span class="n">ZETA</span><span class="p">,</span> <span class="n">TRES</span><span class="p">,</span> <span class="n">DIFF</span>
<a name="ln-1622"></a>	<span class="kt">DOUBLE PRECISION</span>			<span class="kd">::</span> <span class="n">VETT</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1623"></a>	<span class="kt">LOGICAL</span>					<span class="kd">::</span> <span class="n">TROVATO</span>
<a name="ln-1624"></a>	<span class="kt">INTEGER</span>					<span class="kd">::</span> <span class="n">I</span>
<a name="ln-1625"></a>	<span class="kt">REAL</span>					<span class="kd">::</span> <span class="n">RRAND</span>
<a name="ln-1626"></a>        <span class="k">PROCEDURE</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-1627"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-1628"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-1629"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-1630"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-1631"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-1632"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-1633"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1634"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-1635"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1636"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1637"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-1638"></a>
<a name="ln-1639"></a>	<span class="n">TROVATO</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-1640"></a>
<a name="ln-1641"></a>	<span class="k">DO WHILE</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">TROVATO</span><span class="p">)</span>
<a name="ln-1642"></a>		<span class="k">CALL </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span>
<a name="ln-1643"></a>		<span class="n">ZETA</span><span class="o">=</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span> <span class="c">!RAN(IVAR)</span>
<a name="ln-1644"></a>		<span class="c">!ZETA=RAN(IVAR)</span>
<a name="ln-1645"></a>
<a name="ln-1646"></a><span class="mi">100</span>		<span class="k">CONTINUE</span>
<a name="ln-1647"></a><span class="k">		DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1648"></a>			<span class="k">CALL </span><span class="nb">RANDOM_NUMBER</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span>
<a name="ln-1649"></a>			<span class="n">VETT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">RRAND</span><span class="p">)</span> <span class="c">!RAN(IVAR2)</span>
<a name="ln-1650"></a>			<span class="c">!VETT(I)=RAN(IVAR2)</span>
<a name="ln-1651"></a>			<span class="n">XPROP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XINF</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">VETT</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">XSUP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">XINF</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<a name="ln-1652"></a>		<span class="n">ENDDO</span>	
<a name="ln-1653"></a>
<a name="ln-1654"></a>		<span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1655"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">XPROP</span><span class="p">,</span> <span class="n">FPROP</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-1656"></a>		<span class="n">NPC</span> <span class="o">=</span> <span class="n">NPC</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1657"></a>		<span class="n">NF</span>  <span class="o">=</span> <span class="n">NF</span>  <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1658"></a>
<a name="ln-1659"></a><span class="c">!	----------------------------</span>
<a name="ln-1660"></a><span class="c">!	  Calcolo media e varianza</span>
<a name="ln-1661"></a><span class="c">!	----------------------------</span>
<a name="ln-1662"></a>
<a name="ln-1663"></a>		<span class="n">RMED</span>  <span class="o">=</span> <span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">RMED</span><span class="o">+</span><span class="n">FPROP</span><span class="p">)</span><span class="o">/</span><span class="n">NPC</span>
<a name="ln-1664"></a>		<span class="n">RMED2</span> <span class="o">=</span> <span class="p">((</span><span class="n">NPC</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">RMED2</span><span class="o">+</span><span class="n">FPROP</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<a name="ln-1665"></a>		<span class="n">VAR2</span>  <span class="o">=</span> <span class="n">RMED2</span><span class="o">-</span><span class="p">(</span><span class="n">RMED</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NPC</span><span class="o">/</span><span class="p">(</span><span class="n">NPC</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
<a name="ln-1666"></a>
<a name="ln-1667"></a>		<span class="n">DIFF</span>  <span class="o">=</span> <span class="n">RMED</span><span class="o">-</span><span class="n">FOTT</span>
<a name="ln-1668"></a>
<a name="ln-1669"></a>		<span class="n">TRES</span>  <span class="o">=</span> <span class="nb">DEXP</span><span class="p">(</span><span class="o">-</span><span class="n">TCOEFF</span><span class="o">*</span><span class="p">(</span><span class="n">RFAL</span><span class="o">/</span><span class="n">DIFF</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FPROP</span><span class="o">-</span><span class="n">FOTT</span><span class="p">))</span>
<a name="ln-1670"></a>
<a name="ln-1671"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">FPROP</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">FOTT</span><span class="p">)</span> <span class="n">TRES</span><span class="o">=</span><span class="mf">1.</span>
<a name="ln-1672"></a>
<a name="ln-1673"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">ZETA</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">TRES</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1674"></a>
<a name="ln-1675"></a><span class="k">			</span><span class="n">NUMFAL</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1676"></a>			<span class="n">NLM</span>    <span class="o">=</span> <span class="n">NLM</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1677"></a>			<span class="n">TROVATO</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-1678"></a>
<a name="ln-1679"></a>		<span class="k">ELSE</span>
<a name="ln-1680"></a><span class="k">			</span><span class="n">NUMFAL</span> <span class="o">=</span> <span class="n">NUMFAL</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1681"></a>			<span class="n">RNUMFAL</span>  <span class="o">=</span> <span class="n">RNUMFAL</span><span class="o">+</span><span class="mf">1.</span>
<a name="ln-1682"></a>			<span class="n">ICONTFAL</span> <span class="o">=</span> <span class="n">ICONTFAL</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1683"></a>			<span class="n">RFAL</span>     <span class="o">=</span> <span class="n">RFAL</span><span class="o">+</span><span class="mf">1.</span><span class="o">/</span><span class="n">RNUMFAL</span>
<a name="ln-1684"></a>			<span class="n">IDFAL</span>    <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1685"></a>		<span class="n">ENDIF</span>
<a name="ln-1686"></a>
<a name="ln-1687"></a>	<span class="n">ENDDO</span>
<a name="ln-1688"></a>
<a name="ln-1689"></a>	<span class="k">RETURN</span>
<a name="ln-1690"></a>
<a name="ln-1691"></a><span class="k">END SUBROUTINE </span><span class="n">GENERA_PUNTO_SA</span>
<a name="ln-1692"></a>
<a name="ln-1693"></a><span class="c">!============================================================================================</span>
<a name="ln-1694"></a><span class="c">!    DDFSA - A Distributed Derivative-free Simulated Annealing Method for</span>
<a name="ln-1695"></a><span class="c">!    bound constrained global optimization</span>
<a name="ln-1696"></a><span class="c">!    Copyright (C) 2011  G.Liuzzi, S.Lucidi, V.Piccialli</span>
<a name="ln-1697"></a><span class="c">!</span>
<a name="ln-1698"></a><span class="c">!    This program is free software: you can redistribute it and/or modify</span>
<a name="ln-1699"></a><span class="c">!    it under the terms of the GNU General Public License as published by</span>
<a name="ln-1700"></a><span class="c">!    the Free Software Foundation, either version 3 of the License, or</span>
<a name="ln-1701"></a><span class="c">!    (at your option) any later version.</span>
<a name="ln-1702"></a><span class="c">!</span>
<a name="ln-1703"></a><span class="c">!    This program is distributed in the hope that it will be useful,</span>
<a name="ln-1704"></a><span class="c">!    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="ln-1705"></a><span class="c">!    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="ln-1706"></a><span class="c">!    GNU General Public License for more details.</span>
<a name="ln-1707"></a><span class="c">!</span>
<a name="ln-1708"></a><span class="c">!    You should have received a copy of the GNU General Public License</span>
<a name="ln-1709"></a><span class="c">!    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="ln-1710"></a><span class="c">!</span>
<a name="ln-1711"></a><span class="c">!    G. Liuzzi, S. Lucidi, V. Piccialli, A. Sotgiu. A magnetic resonance device designed via </span>
<a name="ln-1712"></a><span class="c">!    global optimization techniques, Mathematical Programming, 101: 339-364 (2004)</span>
<a name="ln-1713"></a><span class="c">!</span>
<a name="ln-1714"></a><span class="c">!============================================================================================</span>
<a name="ln-1715"></a><span class="c">!************************************************************</span>
<a name="ln-1716"></a><span class="c">!*</span>
<a name="ln-1717"></a><span class="c">!***********************************************************</span>
<a name="ln-1718"></a>      <span class="k">SUBROUTINE </span><span class="n">MAINBOX1</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">D1</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XOLD</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,&amp;</span>
<a name="ln-1719"></a>      <span class="n">DOLDALFA</span><span class="p">,</span><span class="n">IPRINT</span><span class="p">,</span><span class="n">DCONV</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XFSTOP</span><span class="p">,</span><span class="n">FINIT</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">BL</span><span class="p">,</span><span class="n">BU</span><span class="p">,&amp;</span>
<a name="ln-1720"></a>      <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,&amp;</span>
<a name="ln-1721"></a>      <span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1722"></a>
<a name="ln-1723"></a>      <span class="k">IMPLICIT NONE</span>
<a name="ln-1724"></a><span class="k">      </span><span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">I_CORR</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">NUM_ITER</span>
<a name="ln-1725"></a>      <span class="kt">INTEGER </span><span class="n">NUM_FAL</span><span class="p">,</span><span class="n">NUM_SUCC</span><span class="p">,</span><span class="n">ISTOP</span>
<a name="ln-1726"></a>      <span class="kt">INTEGER </span><span class="n">IPRINT</span>
<a name="ln-1727"></a>      <span class="kt">INTEGER </span><span class="n">IMIN</span><span class="p">,</span><span class="n">IMAX</span><span class="p">,</span><span class="n">IMINALFA</span><span class="p">,</span><span class="n">IMAXALFA</span>
<a name="ln-1728"></a>
<a name="ln-1729"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DCONV</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DNR</span><span class="p">,</span><span class="n">FFM</span>
<a name="ln-1730"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOLD</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1731"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">ALFA</span><span class="p">,</span><span class="n">BL</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">BU</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1732"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">F</span><span class="p">,</span><span class="n">FZ</span> 
<a name="ln-1733"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFAMEDIO</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-1734"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FMIN</span><span class="p">,</span><span class="n">FMAX</span><span class="p">,</span><span class="n">ALFA0</span><span class="p">,</span><span class="n">DOLDALFAMIN</span><span class="p">,</span><span class="n">DOLDALFAMAX</span>
<a name="ln-1735"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">RAPALFA</span><span class="p">,</span><span class="n">FINIT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1736"></a>
<a name="ln-1737"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-1738"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-1739"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-1740"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-1741"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-1742"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-1743"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1744"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-1745"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1746"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1747"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-1748"></a>      <span class="k">procedure</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-1749"></a>
<a name="ln-1750"></a>
<a name="ln-1751"></a><span class="c">!     VETTORE DEI VALORI DI F SUI PUNTI DI UN SIMPLESSO N+1 DIM.</span>
<a name="ln-1752"></a>
<a name="ln-1753"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FSTOP</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FMM</span>
<a name="ln-1754"></a>
<a name="ln-1755"></a><span class="c">!    num_fal rappresenta il numero di fallimenti consecutivi</span>
<a name="ln-1756"></a>
<a name="ln-1757"></a><span class="c">!     i_corr rappresenta l&#39;indice della direzione corrente</span>
<a name="ln-1758"></a>
<a name="ln-1759"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">F</span>
<a name="ln-1760"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NUM_FUNCT</span>
<a name="ln-1761"></a>
<a name="ln-1762"></a><span class="c">!     inizializzazione</span>
<a name="ln-1763"></a>
<a name="ln-1764"></a>      <span class="n">NUM_SUCC</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1765"></a>
<a name="ln-1766"></a>      <span class="n">NUM_FUNCT</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1767"></a>      <span class="n">NUM_ITER</span> <span class="o">=</span> <span class="mi">0</span> 
<a name="ln-1768"></a>      <span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1769"></a>      <span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1770"></a>
<a name="ln-1771"></a>      <span class="n">I_CORR</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1772"></a>
<a name="ln-1773"></a>      <span class="n">ALFA0</span><span class="o">=</span><span class="mf">1.D0</span>
<a name="ln-1774"></a>
<a name="ln-1775"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1776"></a>
<a name="ln-1777"></a><span class="c">!      </span>
<a name="ln-1778"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1779"></a><span class="k">          WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ALFAiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1780"></a>          <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ALFAiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1781"></a>        <span class="n">ENDIF</span>
<a name="ln-1782"></a><span class="c">!</span>
<a name="ln-1783"></a>      <span class="k">END DO</span>
<a name="ln-1784"></a>
<a name="ln-1785"></a><span class="c">!     scelta iniziale delle direzioni</span>
<a name="ln-1786"></a>
<a name="ln-1787"></a>      
<a name="ln-1788"></a>      <span class="c">!CALL FUNCT(X,N,F)</span>
<a name="ln-1789"></a>      <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1790"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-1791"></a><span class="c">!	WRITE(*,*)&#39;MAINBOX1: &#39;,X,F</span>
<a name="ln-1792"></a><span class="c">!	WRITE(1,*)&#39;MAINBOX1: &#39;,X,F</span>
<a name="ln-1793"></a>	<span class="n">NUM_FUNCT</span><span class="o">=</span><span class="n">NUM_FUNCT</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1794"></a>
<a name="ln-1795"></a>      <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">F</span>
<a name="ln-1796"></a>
<a name="ln-1797"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1798"></a>        <span class="n">XFSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1799"></a>	  <span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1800"></a>      <span class="k">END DO</span>
<a name="ln-1801"></a>
<a name="ln-1802"></a><span class="k">      IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1803"></a><span class="k">        WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ----------------------------------&#39;</span>
<a name="ln-1804"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ----------------------------------&#39;</span>
<a name="ln-1805"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Finiz =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-1806"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Finiz =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-1807"></a>        <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1808"></a>          <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Xiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1809"></a>          <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Xiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1810"></a>        <span class="n">ENDDO</span>
<a name="ln-1811"></a>      <span class="n">ENDIF</span>
<a name="ln-1812"></a> 
<a name="ln-1813"></a>      <span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1814"></a>
<a name="ln-1815"></a>
<a name="ln-1816"></a><span class="c">!---------------------------</span>
<a name="ln-1817"></a><span class="c">!     CICLO PRINCIPALE</span>
<a name="ln-1818"></a><span class="c">!---------------------------</span>
<a name="ln-1819"></a>
<a name="ln-1820"></a>  <span class="mi">1</span>   <span class="k">CONTINUE</span>
<a name="ln-1821"></a>
<a name="ln-1822"></a><span class="k">      IF</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1823"></a><span class="k">           DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1824"></a>                <span class="n">DCONV</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1825"></a>           <span class="k">END DO</span>
<a name="ln-1826"></a><span class="k">      </span><span class="n">ENDIF</span>
<a name="ln-1827"></a>
<a name="ln-1828"></a>	<span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1829"></a>
<a name="ln-1830"></a>      <span class="n">DALFAMAX</span><span class="o">=</span><span class="nb">MAXVAL</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">)</span>
<a name="ln-1831"></a>
<a name="ln-1832"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1833"></a><span class="k">        WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
<a name="ln-1834"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
<a name="ln-1835"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;NF=&#39;</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="s1">&#39;   F=&#39;</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="s1">&#39;   ALFAmax=&#39;</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-1836"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;NF=&#39;</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="s1">&#39;   F=&#39;</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="s1">&#39;   ALFAmax=&#39;</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-1837"></a>      <span class="n">ENDIF</span>
<a name="ln-1838"></a>
<a name="ln-1839"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">ISTOP</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1840"></a><span class="c">!        WRITE(2,50)&#39;&amp;&#39;,N,&#39;&amp;&#39;,NUM_FUNCT,&#39;&amp;&#39;,F,&#39;\\&#39;  </span>
<a name="ln-1841"></a>   <span class="mi">50</span>   <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">i5</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">i5</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">d13</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="n">a6</span><span class="p">)</span>
<a name="ln-1842"></a><span class="c">!        WRITE(*,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-1843"></a><span class="c">!        WRITE(1,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-1844"></a><span class="c">!        WRITE(*,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-1845"></a><span class="c">!        WRITE(1,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-1846"></a>        <span class="k">RETURN</span>
<a name="ln-1847"></a><span class="k">      END IF</span>
<a name="ln-1848"></a>
<a name="ln-1849"></a><span class="c">!-------------------------------------</span>
<a name="ln-1850"></a><span class="c">!    CAMPIONAMENTO LUNGO ASSE I_CORR</span>
<a name="ln-1851"></a><span class="c">!-------------------------------------</span>
<a name="ln-1852"></a> 
<a name="ln-1853"></a><span class="c">!      CALL LINESEARCH_INVERTI(N,X,F,D,ALFA,DOLDALFA,Z,FZ,</span>
<a name="ln-1854"></a><span class="c">!     *I_CORR,NUM_FAL,DALFAMAX,IPRINT)</span>
<a name="ln-1855"></a>      <span class="k">CALL </span><span class="n">linesearchbox_cont</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="n">doldalfa</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">fz</span><span class="p">,&amp;</span>
<a name="ln-1856"></a>      <span class="n">i_corr</span><span class="p">,</span><span class="n">num_fal</span><span class="p">,</span><span class="n">dalfamax</span><span class="p">,</span><span class="n">iprint</span><span class="p">,</span><span class="n">bl</span><span class="p">,</span><span class="n">bu</span><span class="p">,&amp;</span>
<a name="ln-1857"></a>      <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1858"></a>
<a name="ln-1859"></a>
<a name="ln-1860"></a>      <span class="k">IF</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">ALFA</span><span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="mf">1.D-24</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1861"></a>
<a name="ln-1862"></a><span class="k">          </span><span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span><span class="o">+</span><span class="n">ALFA</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-1863"></a>          <span class="n">Z</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-1864"></a>
<a name="ln-1865"></a>          <span class="n">F</span><span class="o">=</span><span class="n">FZ</span>
<a name="ln-1866"></a>          <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1867"></a>             <span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1868"></a>             <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1869"></a>                <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1870"></a>             <span class="k">END DO</span>
<a name="ln-1871"></a><span class="k">          </span><span class="n">ENDDO</span>
<a name="ln-1872"></a>          <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">F</span>
<a name="ln-1873"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1874"></a>             <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-1875"></a>          <span class="k">END DO            </span>
<a name="ln-1876"></a><span class="k">          </span><span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1877"></a>          <span class="n">NUM_ITER</span><span class="o">=</span><span class="n">NUM_ITER</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1878"></a>          <span class="n">NUM_SUCC</span><span class="o">=</span><span class="n">NUM_SUCC</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1879"></a>    
<a name="ln-1880"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1881"></a><span class="k">             WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; F =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-1882"></a>             <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; F =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-1883"></a>          <span class="n">ENDIF</span>
<a name="ln-1884"></a>
<a name="ln-1885"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1886"></a><span class="k">	       DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1887"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; X(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1888"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; X(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1889"></a>             <span class="n">ENDDO</span>
<a name="ln-1890"></a>          <span class="n">ENDIF</span>
<a name="ln-1891"></a>      
<a name="ln-1892"></a>	<span class="k">ELSE</span>
<a name="ln-1893"></a><span class="k">      </span>
<a name="ln-1894"></a><span class="k">	    DO </span><span class="n">I</span><span class="o">=</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1895"></a>             <span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1896"></a>             <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1897"></a>                <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1898"></a>             <span class="k">END DO</span>
<a name="ln-1899"></a><span class="k">          </span><span class="n">ENDDO</span>
<a name="ln-1900"></a>          <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">FZ</span>
<a name="ln-1901"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-1902"></a>             <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>  
<a name="ln-1903"></a>          <span class="k">END DO       </span>
<a name="ln-1904"></a><span class="k">          </span><span class="n">NUM_FAL</span><span class="o">=</span><span class="n">NUM_FAL</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1905"></a>          <span class="n">NUM_ITER</span><span class="o">=</span><span class="n">NUM_ITER</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1906"></a>          <span class="n">Z</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-1907"></a>		      
<a name="ln-1908"></a>	<span class="k">END IF</span>
<a name="ln-1909"></a>
<a name="ln-1910"></a><span class="k">      IF</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">N</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1911"></a>
<a name="ln-1912"></a><span class="k">          </span><span class="n">I_CORR</span><span class="o">=</span><span class="n">I_CORR</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1913"></a>
<a name="ln-1914"></a>      <span class="k">ELSE</span>
<a name="ln-1915"></a>
<a name="ln-1916"></a><span class="k">          </span><span class="n">I_CORR</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1917"></a>	  <span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1918"></a>
<a name="ln-1919"></a>	    <span class="k">IF</span> <span class="p">(</span><span class="n">ISTOP</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-1920"></a><span class="c">!             WRITE(2,50)&#39;&amp;&#39;,N,&#39;&amp;&#39;,NUM_FUNCT,&#39;&amp;&#39;,F,&#39;\\&#39;  </span>
<a name="ln-1921"></a><span class="c">!             WRITE(*,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-1922"></a><span class="c">!             WRITE(1,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-1923"></a><span class="c">!             WRITE(*,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-1924"></a><span class="c">!             WRITE(1,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-1925"></a>              <span class="n">FFM</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-1926"></a>		    <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1927"></a>			  <span class="n">FFM</span><span class="o">=</span><span class="n">FFM</span><span class="o">+</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-1928"></a>			<span class="n">ENDDO</span>
<a name="ln-1929"></a>			<span class="n">FFM</span><span class="o">=</span><span class="n">FFM</span><span class="o">/</span><span class="n">DFLOAT</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1930"></a>
<a name="ln-1931"></a>			<span class="n">FFSTOP</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-1932"></a>			<span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1933"></a>			  <span class="n">FFSTOP</span><span class="o">=</span><span class="n">FFSTOP</span><span class="o">+</span><span class="p">(</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">FFM</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">FFM</span><span class="p">)</span>
<a name="ln-1934"></a>			<span class="n">ENDDO</span>
<a name="ln-1935"></a>		<span class="c">!	write(*,*) &#39; ffstop =&#39;,ffstop,  &#39; dfloat =&#39;,dfloat(n+1),&#39; ffm =&#39;,ffm</span>
<a name="ln-1936"></a>			<span class="n">FFSTOP</span><span class="o">=</span><span class="nb">DSQRT</span><span class="p">(</span><span class="n">FFSTOP</span><span class="o">/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1937"></a>
<a name="ln-1938"></a>             <span class="k">RETURN</span>
<a name="ln-1939"></a><span class="k">          END IF</span>
<a name="ln-1940"></a>
<a name="ln-1941"></a><span class="k">      END IF </span>
<a name="ln-1942"></a>
<a name="ln-1943"></a><span class="k">      </span><span class="n">GO</span> <span class="n">TO</span> <span class="mi">1</span>
<a name="ln-1944"></a>
<a name="ln-1945"></a>      <span class="k">END</span>
<a name="ln-1946"></a>        
<a name="ln-1947"></a><span class="c">!************************************************************</span>
<a name="ln-1948"></a><span class="c">!*</span>
<a name="ln-1949"></a><span class="c">!***********************************************************</span>
<a name="ln-1950"></a>      <span class="k">SUBROUTINE </span><span class="n">MAINBOX2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">D1</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XOLD</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,&amp;</span>
<a name="ln-1951"></a>     <span class="n">ALFA_STOP</span><span class="p">,</span><span class="n">IPRINT</span><span class="p">,</span><span class="n">DCONV</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,</span><span class="n">XFSTOP</span><span class="p">,</span><span class="n">FINIT</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,&amp;</span>
<a name="ln-1952"></a>     <span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">,</span><span class="n">BL</span><span class="p">,</span><span class="n">BU</span><span class="p">,&amp;</span>
<a name="ln-1953"></a>     <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,&amp;</span>
<a name="ln-1954"></a>     <span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-1955"></a>	<span class="k">use </span><span class="n">typedefs</span>
<a name="ln-1956"></a>      <span class="k">IMPLICIT NONE</span>
<a name="ln-1957"></a><span class="c">!	INCLUDE &#39;TYPEDECL.FI&#39;</span>
<a name="ln-1958"></a>
<a name="ln-1959"></a>      <span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">I_CORR</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">NUM_ITER</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">MAXNF</span>
<a name="ln-1960"></a>      <span class="kt">INTEGER </span><span class="n">NUM_FAL</span><span class="p">,</span><span class="n">NUM_SUCC</span><span class="p">,</span><span class="n">ISTOP</span>
<a name="ln-1961"></a>      <span class="kt">INTEGER </span><span class="n">IPRINT</span>
<a name="ln-1962"></a>	<span class="kt">INTEGER </span><span class="n">IMIN</span><span class="p">,</span><span class="n">IMAX</span><span class="p">,</span><span class="n">IMINALFA</span><span class="p">,</span><span class="n">IMAXALFA</span>
<a name="ln-1963"></a>
<a name="ln-1964"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DCONV</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DNR</span><span class="p">,</span><span class="n">ALFA_STOP</span><span class="p">,</span><span class="n">fglob</span><span class="p">,</span><span class="n">BL</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">BU</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1965"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOLD</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">XOTT</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-1966"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">ALFA</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAOTT</span>
<a name="ln-1967"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">F</span><span class="p">,</span><span class="n">FZ</span> 
<a name="ln-1968"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFAMEDIO</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-1969"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FMIN</span><span class="p">,</span><span class="n">FMAX</span><span class="p">,</span><span class="n">ALFA0</span><span class="p">,</span><span class="n">DOLDALFAMIN</span><span class="p">,</span><span class="n">DOLDALFAMAX</span>
<a name="ln-1970"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">RAPALFA</span><span class="p">,</span><span class="n">FINIT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1971"></a>	<span class="k">TYPE</span><span class="p">(</span><span class="n">COMP_WKS_TYP</span><span class="p">)</span>	<span class="kd">::</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-1972"></a>
<a name="ln-1973"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-1974"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-1975"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-1976"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-1977"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-1978"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-1979"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-1980"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-1981"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1982"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-1983"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-1984"></a>      <span class="k">procedure</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-1985"></a> 
<a name="ln-1986"></a>
<a name="ln-1987"></a><span class="c">!     VETTORE DEI VALORI DI F SUI PUNTI DI UN SIMPLESSO N+1 DIM.</span>
<a name="ln-1988"></a>
<a name="ln-1989"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FSTOP</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span>
<a name="ln-1990"></a>	<span class="kt">LOGICAL </span><span class="n">MASCH</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-1991"></a>
<a name="ln-1992"></a><span class="c">!     num_fal rappresenta il numero di fallimenti consecutivi</span>
<a name="ln-1993"></a>
<a name="ln-1994"></a><span class="c">!     i_corr rappresenta l&#39;indice della direzione corrente</span>
<a name="ln-1995"></a>
<a name="ln-1996"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">F</span>
<a name="ln-1997"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NUM_FUNCT</span>
<a name="ln-1998"></a>
<a name="ln-1999"></a><span class="c">!     inizializzazione</span>
<a name="ln-2000"></a>
<a name="ln-2001"></a>      <span class="n">NUM_SUCC</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-2002"></a>
<a name="ln-2003"></a>      <span class="n">NUM_FUNCT</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2004"></a>      <span class="n">NUM_ITER</span> <span class="o">=</span> <span class="mi">0</span> 
<a name="ln-2005"></a>      <span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-2006"></a>      <span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2007"></a>
<a name="ln-2008"></a>      <span class="n">I_CORR</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-2009"></a>
<a name="ln-2010"></a>      <span class="n">ALFA0</span><span class="o">=</span><span class="mf">1.D0</span>
<a name="ln-2011"></a>
<a name="ln-2012"></a><span class="c">!      DO I=1,N</span>
<a name="ln-2013"></a>
<a name="ln-2014"></a><span class="c">!        DOLDALFA(I)=1.D0</span>
<a name="ln-2015"></a>
<a name="ln-2016"></a><span class="c">!        DOLDALFA(I)=DMAX1(5.D-1,DMIN1(2.D+0,5.D-1*DABS(X(I))))</span>
<a name="ln-2017"></a><span class="c">!        DOLDALFA(I)=1.0D0*DMAX1(1.D-3,DMIN1(1.D+3,0.5D0*DABS(X(I))))</span>
<a name="ln-2018"></a>      
<a name="ln-2019"></a><span class="c">!        IF(IPRINT.GE.2) THEN</span>
<a name="ln-2020"></a><span class="c">!          WRITE(*,*) &#39; ALFAiniz(&#39;,I,&#39;)=&#39;,DOLDALFA(I)</span>
<a name="ln-2021"></a><span class="c">!          WRITE(1,*) &#39; ALFAiniz(&#39;,I,&#39;)=&#39;,DOLDALFA(I)</span>
<a name="ln-2022"></a><span class="c">!        ENDIF</span>
<a name="ln-2023"></a>
<a name="ln-2024"></a><span class="c">!      END DO</span>
<a name="ln-2025"></a>
<a name="ln-2026"></a><span class="c">!     scelta iniziale delle direzioni</span>
<a name="ln-2027"></a>
<a name="ln-2028"></a>	<span class="n">DALFAMAX</span> <span class="o">=</span> <span class="nb">MAXVAL</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">)</span>
<a name="ln-2029"></a>
<a name="ln-2030"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>      
<a name="ln-2031"></a>        <span class="n">D</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="mf">1.D0</span> 
<a name="ln-2032"></a>      <span class="k">END DO</span>
<a name="ln-2033"></a>       
<a name="ln-2034"></a>      <span class="c">!CALL FUNCT(X,N,F)</span>
<a name="ln-2035"></a>      <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2036"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-2037"></a>	<span class="n">NUM_FUNCT</span><span class="o">=</span><span class="n">NUM_FUNCT</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2038"></a>
<a name="ln-2039"></a>      <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">F</span>
<a name="ln-2040"></a>
<a name="ln-2041"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2042"></a>        <span class="n">XFSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2043"></a>	  <span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2044"></a>      <span class="k">END DO</span>
<a name="ln-2045"></a>
<a name="ln-2046"></a><span class="k">      IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2047"></a><span class="k">        WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ----------------------------------&#39;</span>
<a name="ln-2048"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; ----------------------------------&#39;</span>
<a name="ln-2049"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Finiz =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-2050"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Finiz =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-2051"></a>        <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2052"></a>          <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Xiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2053"></a>          <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Xiniz(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2054"></a>        <span class="n">ENDDO</span>
<a name="ln-2055"></a>      <span class="n">ENDIF</span>
<a name="ln-2056"></a> 
<a name="ln-2057"></a>      <span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-2058"></a>
<a name="ln-2059"></a><span class="c">!---------------------------</span>
<a name="ln-2060"></a><span class="c">!     CICLO PRINCIPALE</span>
<a name="ln-2061"></a><span class="c">!---------------------------</span>
<a name="ln-2062"></a>
<a name="ln-2063"></a>  <span class="mi">1</span>   <span class="k">CONTINUE</span>
<a name="ln-2064"></a>
<a name="ln-2065"></a><span class="k">      IF</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2066"></a><span class="k">           DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2067"></a>                <span class="n">DCONV</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2068"></a>           <span class="k">END DO</span>
<a name="ln-2069"></a><span class="k">      </span><span class="n">ENDIF</span>
<a name="ln-2070"></a>
<a name="ln-2071"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">NUM_ITER</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="n">N</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2072"></a><span class="k">        CALL STOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">DALFAMAX</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,&amp;</span>
<a name="ln-2073"></a>     			    <span class="n">ALFA_STOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">XOTT</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,&amp;</span>
<a name="ln-2074"></a>     				<span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">)</span>
<a name="ln-2075"></a>      <span class="n">ENDIF</span>
<a name="ln-2076"></a>
<a name="ln-2077"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2078"></a><span class="k">        WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
<a name="ln-2079"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;----------------------------------------------&#39;</span>
<a name="ln-2080"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;NF=&#39;</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="s1">&#39;   F=&#39;</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="s1">&#39;   ALFAmax=&#39;</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-2081"></a>        <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;NF=&#39;</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="s1">&#39;   F=&#39;</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="s1">&#39;   ALFAmax=&#39;</span><span class="p">,</span><span class="n">DALFAMAX</span>
<a name="ln-2082"></a>      <span class="n">ENDIF</span>
<a name="ln-2083"></a>
<a name="ln-2084"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">ISTOP</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2085"></a><span class="c">!        WRITE(2,50)&#39;&amp;&#39;,N,&#39;&amp;&#39;,NUM_FUNCT,&#39;&amp;&#39;,F,&#39;\\&#39;  </span>
<a name="ln-2086"></a>   <span class="mi">50</span>   <span class="k">FORMAT</span><span class="p">(</span><span class="mi">1</span><span class="n">X</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">i5</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">i5</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">d13</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="n">a6</span><span class="p">)</span>
<a name="ln-2087"></a><span class="c">!        WRITE(*,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-2088"></a><span class="c">!        WRITE(1,*) &#39;----------------------------------------------&#39;</span>
<a name="ln-2089"></a><span class="c">!        WRITE(*,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-2090"></a><span class="c">!        WRITE(1,*) &#39;NF=&#39;,NUM_FUNCT,&#39;   F=&#39;,F,&#39;   ALFAmax=&#39;,DALFAMAX</span>
<a name="ln-2091"></a>        <span class="k">RETURN</span>
<a name="ln-2092"></a><span class="k">      END IF</span>
<a name="ln-2093"></a>
<a name="ln-2094"></a><span class="c">!-------------------------------------</span>
<a name="ln-2095"></a><span class="c">!    CAMPIONAMENTO LUNGO ASSE I_CORR</span>
<a name="ln-2096"></a><span class="c">!-------------------------------------</span>
<a name="ln-2097"></a> 
<a name="ln-2098"></a>
<a name="ln-2099"></a><span class="c">!      CALL LINESEARCH_INVERTI(N,X,F,D,ALFA,DOLDALFA,Z,FZ,</span>
<a name="ln-2100"></a><span class="c">!     *I_CORR,NUM_FAL,DALFAMAX,IPRINT)</span>
<a name="ln-2101"></a>      <span class="k">CALL </span><span class="n">linesearchbox_cont</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">alfa</span><span class="p">,</span><span class="n">doldalfa</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">fz</span><span class="p">,&amp;</span>
<a name="ln-2102"></a>     <span class="n">i_corr</span><span class="p">,</span><span class="n">num_fal</span><span class="p">,</span><span class="n">dalfamax</span><span class="p">,</span><span class="n">iprint</span><span class="p">,</span><span class="n">bl</span><span class="p">,</span><span class="n">bu</span><span class="p">,&amp;</span>
<a name="ln-2103"></a>     <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,</span><span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-2104"></a>
<a name="ln-2105"></a>
<a name="ln-2106"></a>      <span class="k">IF</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">ALFA</span><span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="mf">1.D-24</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2107"></a>
<a name="ln-2108"></a><span class="k">          </span><span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span><span class="o">+</span><span class="n">ALFA</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-2109"></a>          <span class="n">Z</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-2110"></a>
<a name="ln-2111"></a>          <span class="n">F</span><span class="o">=</span><span class="n">FZ</span>
<a name="ln-2112"></a>          <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-2113"></a>             <span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2114"></a>             <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2115"></a>                <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2116"></a>             <span class="k">END DO</span>
<a name="ln-2117"></a><span class="k">          </span><span class="n">ENDDO</span>
<a name="ln-2118"></a>          <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">F</span>
<a name="ln-2119"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2120"></a>             <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2121"></a>          <span class="k">END DO            </span>
<a name="ln-2122"></a><span class="k">          </span><span class="n">NUM_FAL</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-2123"></a>          <span class="n">NUM_ITER</span><span class="o">=</span><span class="n">NUM_ITER</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2124"></a>          <span class="n">NUM_SUCC</span><span class="o">=</span><span class="n">NUM_SUCC</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2125"></a>    
<a name="ln-2126"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2127"></a><span class="k">             WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; F =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-2128"></a>             <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; F =&#39;</span><span class="p">,</span><span class="n">F</span>
<a name="ln-2129"></a>          <span class="n">ENDIF</span>
<a name="ln-2130"></a>
<a name="ln-2131"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2132"></a><span class="k">	       DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2133"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; X(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2134"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; X(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2135"></a>             <span class="n">ENDDO</span>
<a name="ln-2136"></a>          <span class="n">ENDIF</span>
<a name="ln-2137"></a>      
<a name="ln-2138"></a>	<span class="k">ELSE</span>
<a name="ln-2139"></a><span class="k">      </span>
<a name="ln-2140"></a><span class="k">	    DO </span><span class="n">I</span><span class="o">=</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-2141"></a>             <span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2142"></a>             <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2143"></a>                <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2144"></a>             <span class="k">END DO</span>
<a name="ln-2145"></a><span class="k">          </span><span class="n">ENDDO</span>
<a name="ln-2146"></a>          <span class="n">FSTOP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">FZ</span>
<a name="ln-2147"></a>          <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2148"></a>             <span class="n">XFSTOP</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>  
<a name="ln-2149"></a>          <span class="k">END DO       </span>
<a name="ln-2150"></a><span class="k">          </span><span class="n">NUM_FAL</span><span class="o">=</span><span class="n">NUM_FAL</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2151"></a>          <span class="n">NUM_ITER</span><span class="o">=</span><span class="n">NUM_ITER</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2152"></a>          <span class="n">Z</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">)</span>
<a name="ln-2153"></a>		      
<a name="ln-2154"></a>	<span class="k">END IF</span>
<a name="ln-2155"></a>
<a name="ln-2156"></a><span class="k">      IF</span><span class="p">(</span><span class="n">I_CORR</span><span class="p">.</span><span class="n">LT</span><span class="p">.</span><span class="n">N</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2157"></a>
<a name="ln-2158"></a><span class="k">          </span><span class="n">I_CORR</span><span class="o">=</span><span class="n">I_CORR</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2159"></a>
<a name="ln-2160"></a>      <span class="k">ELSE</span>
<a name="ln-2161"></a>
<a name="ln-2162"></a><span class="k">          </span><span class="n">I_CORR</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-2163"></a>
<a name="ln-2164"></a>      <span class="k">END IF </span>
<a name="ln-2165"></a>
<a name="ln-2166"></a><span class="k">      </span><span class="n">GO</span> <span class="n">TO</span> <span class="mi">1</span>
<a name="ln-2167"></a>
<a name="ln-2168"></a>      <span class="k">END</span>
<a name="ln-2169"></a>
<a name="ln-2170"></a>
<a name="ln-2171"></a><span class="c">!     #######################################################</span>
<a name="ln-2172"></a>
<a name="ln-2173"></a>      <span class="k">SUBROUTINE STOP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">DALFAMAX</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">,&amp;</span>
<a name="ln-2174"></a>     			    <span class="n">ALFA_STOP</span><span class="p">,</span><span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">X</span><span class="p">,&amp;</span>
<a name="ln-2175"></a>     		      <span class="n">XOTT</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">WKS</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">MASCH</span><span class="p">,</span><span class="n">MAXNF</span><span class="p">,</span><span class="n">fglob</span><span class="p">)</span>
<a name="ln-2176"></a><span class="c">!	USE IMSLF90</span>
<a name="ln-2177"></a>        <span class="k">use </span><span class="n">typedefs</span>
<a name="ln-2178"></a>      <span class="k">IMPLICIT NONE</span>
<a name="ln-2179"></a>
<a name="ln-2180"></a><span class="c">!	INCLUDE &#39;TYPEDECL.FI&#39;</span>
<a name="ln-2181"></a>      
<a name="ln-2182"></a>      <span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span><span class="n">ISTOP</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">NUM_FUNCT</span><span class="p">,</span><span class="n">IDIMWKS</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">IMAX</span><span class="p">,</span><span class="n">MAXNF</span>
<a name="ln-2183"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DALFAMAX</span><span class="p">,</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">FFSTOP</span><span class="p">,</span><span class="n">FFM</span><span class="p">,</span><span class="n">ALFA_STOP</span><span class="p">,</span><span class="n">F</span> <span class="p">&amp;</span>
<a name="ln-2184"></a>     	<span class="p">,</span><span class="n">XOTT</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2185"></a>	<span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">FFSTOPTOL</span><span class="p">,</span><span class="n">FOTT</span><span class="p">,</span><span class="n">ALFAOTT</span><span class="p">,</span><span class="n">fglob</span>
<a name="ln-2186"></a>	<span class="k">TYPE</span><span class="p">(</span><span class="n">COMP_WKS_TYP</span><span class="p">)</span>	<span class="kd">::</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-2187"></a>
<a name="ln-2188"></a>	<span class="kt">LOGICAL </span><span class="n">NORMADUE</span><span class="p">,</span><span class="n">L_F_DISTANTI</span><span class="p">,</span><span class="n">NON_MINIMIZZ</span><span class="p">,</span><span class="n">L_F_VICINI</span>
<a name="ln-2189"></a>        <span class="kt">LOGICAL </span><span class="n">MASCH</span><span class="p">(</span><span class="n">IDIMWKS</span><span class="p">)</span>
<a name="ln-2190"></a>
<a name="ln-2191"></a>	<span class="k">COMMON</span><span class="o">/</span><span class="n">CALFANR2</span><span class="o">/</span><span class="n">NORMADUE</span>
<a name="ln-2192"></a>      <span class="k">COMMON</span><span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">F</span>
<a name="ln-2193"></a>
<a name="ln-2194"></a>      <span class="n">ISTOP</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-2195"></a>	<span class="n">NON_MINIMIZZ</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2196"></a>
<a name="ln-2197"></a><span class="c">!	WRITE(*,*)&#39;STO DENTRO STOP ! ALFA_STOP = &#39;,ALFA_STOP</span>
<a name="ln-2198"></a><span class="c">!	WRITE(1,*)&#39;STO DENTRO STOP ! ALFA_STOP = &#39;,ALFA_STOP</span>
<a name="ln-2199"></a><span class="c">!	PAUSE</span>
<a name="ln-2200"></a>      <span class="n">DALFAMAX</span><span class="o">=</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2201"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2202"></a>        <span class="k">IF</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">I</span><span class="p">).</span><span class="n">GT</span><span class="p">.</span><span class="n">DALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2203"></a><span class="k">          </span><span class="n">DALFAMAX</span><span class="o">=</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2204"></a>        <span class="k">END IF</span>
<a name="ln-2205"></a><span class="k">      END DO</span>
<a name="ln-2206"></a>     
<a name="ln-2207"></a><span class="c">!      FFM=1.D+30</span>
<a name="ln-2208"></a><span class="c">!      DO I=1,N+1</span>
<a name="ln-2209"></a><span class="c">!        IF(FSTOP(I).LT.FFM) FFM=FSTOP(I)</span>
<a name="ln-2210"></a><span class="c">!      ENDDO</span>
<a name="ln-2211"></a>
<a name="ln-2212"></a>      <span class="n">FFM</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-2213"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2214"></a>        <span class="n">FFM</span><span class="o">=</span><span class="n">FFM</span><span class="o">+</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2215"></a>      <span class="n">ENDDO</span>
<a name="ln-2216"></a>      <span class="n">FFM</span><span class="o">=</span><span class="n">FFM</span><span class="o">/</span><span class="n">DFLOAT</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2217"></a>
<a name="ln-2218"></a>      <span class="n">FFSTOP</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-2219"></a>      <span class="k">DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2220"></a>        <span class="n">FFSTOP</span><span class="o">=</span><span class="n">FFSTOP</span><span class="o">+</span><span class="p">(</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">FFM</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FSTOP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">-</span><span class="n">FFM</span><span class="p">)</span>
<a name="ln-2221"></a>      <span class="n">ENDDO</span>
<a name="ln-2222"></a><span class="c">!	write(*,*) &#39; ffstop =&#39;,ffstop,  &#39; dfloat =&#39;,dfloat(n+1),&#39; ffm =&#39;,ffm</span>
<a name="ln-2223"></a>      <span class="n">FFSTOP</span><span class="o">=</span><span class="nb">DSQRT</span><span class="p">(</span><span class="n">FFSTOP</span><span class="o">/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-2224"></a>
<a name="ln-2225"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">NORMADUE</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2226"></a><span class="k">		IF</span><span class="p">(</span><span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">)).</span><span class="n">LE</span><span class="p">.</span><span class="n">ALFA_STOP</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2227"></a><span class="k">		  </span><span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2228"></a>		<span class="k">END IF</span>
<a name="ln-2229"></a><span class="k">	ELSE</span>
<a name="ln-2230"></a><span class="k">		IF</span><span class="p">(</span><span class="n">DALFAMAX</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">ALFA_STOP</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2231"></a><span class="k">		  </span><span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2232"></a>		<span class="k">END IF</span>
<a name="ln-2233"></a><span class="k">	</span><span class="n">ENDIF</span>
<a name="ln-2234"></a>
<a name="ln-2235"></a><span class="c">!--------------------------------------</span>
<a name="ln-2236"></a><span class="c">!		calcola l&#39;indice imax della</span>
<a name="ln-2237"></a><span class="c">!		componente di wks contenente</span>
<a name="ln-2238"></a><span class="c">!		il valore di fob piu&#39; alto</span>
<a name="ln-2239"></a><span class="c">!--------------------------------------</span>
<a name="ln-2240"></a>		<span class="n">IMAX</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2241"></a>		<span class="k">DO </span><span class="n">I</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-2242"></a>			<span class="k">IF</span><span class="p">((</span><span class="n">WKS</span><span class="p">(</span><span class="n">I</span><span class="p">)%</span><span class="n">FOB</span> <span class="o">&gt;</span> <span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span><span class="p">).</span><span class="nb">AND</span><span class="p">.(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">MASCH</span><span class="p">(</span><span class="n">I</span><span class="p">)))</span> <span class="k">THEN</span>
<a name="ln-2243"></a><span class="k">				</span><span class="n">IMAX</span> <span class="o">=</span> <span class="n">I</span>
<a name="ln-2244"></a>			<span class="n">ENDIF</span>
<a name="ln-2245"></a>		<span class="n">ENDDO</span>
<a name="ln-2246"></a>
<a name="ln-2247"></a>	<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="p">((</span><span class="n">F</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-8</span><span class="p">,&amp;</span>
<a name="ln-2248"></a>     					<span class="n">DMIN1</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="nb">DABS</span><span class="p">(</span><span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">FOB</span><span class="p">)))</span> <span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="mf">1.D-6</span>
<a name="ln-2249"></a>	<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="n">L_F_DISTANTI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2250"></a>     			   <span class="p">(</span><span class="n">DALFAMAX</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D+0</span><span class="o">*</span><span class="n">WKS</span><span class="p">(</span><span class="n">IMAX</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">)</span>
<a name="ln-2251"></a>
<a name="ln-2252"></a>	<span class="k">IF</span> <span class="p">(</span><span class="n">L_F_DISTANTI</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2253"></a><span class="k">		</span><span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2254"></a>		<span class="k">RETURN</span>
<a name="ln-2255"></a><span class="k">	</span><span class="n">ENDIF</span>
<a name="ln-2256"></a>
<a name="ln-2257"></a>	<span class="k">DO </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">IDIMWKS</span>
<a name="ln-2258"></a>
<a name="ln-2259"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">F</span> <span class="o">&gt;</span> <span class="n">FOTT</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2260"></a>
<a name="ln-2261"></a><span class="k">			</span><span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-8</span><span class="p">,&amp;</span>
<a name="ln-2262"></a>     			<span class="nb">DABS</span><span class="p">(</span><span class="n">DMAX1</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">FOB</span><span class="p">)</span> <span class="p">)))</span> <span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D-1</span>
<a name="ln-2263"></a>			<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="n">L_F_VICINI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.((</span><span class="nb">DSQRT</span><span class="p">(&amp;</span>													
<a name="ln-2264"></a>     			<span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="o">-</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">X</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mf">1.D-1</span><span class="p">)&amp;</span>
<a name="ln-2265"></a>     			<span class="p">.</span><span class="nb">OR</span><span class="p">.(</span><span class="n">DALFAMAX</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D+1</span><span class="o">*</span><span class="n">WKS</span><span class="p">(</span><span class="n">J</span><span class="p">)%</span><span class="n">ALFAMAX</span><span class="p">))</span>
<a name="ln-2266"></a><span class="c">!			L_F_VICINI = L_F_VICINI.AND.(DSQRT(													</span>
<a name="ln-2267"></a><span class="c">!     *			DOT_PRODUCT(X-WKS(J)%X,X-WKS(J)%X)) &lt;= 1.D-1)</span>
<a name="ln-2268"></a>
<a name="ln-2269"></a>			<span class="k">IF</span> <span class="p">(</span><span class="n">L_F_VICINI</span><span class="p">)</span> <span class="k">THEN</span> 
<a name="ln-2270"></a>			
<a name="ln-2271"></a><span class="c">!				ISTOP=1</span>
<a name="ln-2272"></a><span class="c">!				RETURN</span>
<a name="ln-2273"></a>
<a name="ln-2274"></a>			<span class="n">ENDIF</span>
<a name="ln-2275"></a>		<span class="n">ENDIF</span>
<a name="ln-2276"></a>	<span class="n">ENDDO</span>
<a name="ln-2277"></a>
<a name="ln-2278"></a>	<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="p">((</span><span class="n">F</span><span class="o">-</span><span class="n">FOTT</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-3</span><span class="p">,</span><span class="n">DMIN1</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="nb">DABS</span><span class="p">(</span><span class="n">FOTT</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-2279"></a>     										  <span class="p">)</span> <span class="p">).</span><span class="n">GE</span><span class="p">.</span><span class="mf">1.D+1</span>
<a name="ln-2280"></a>	<span class="n">L_F_DISTANTI</span> <span class="o">=</span> <span class="n">L_F_DISTANTI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2281"></a>     			   <span class="p">(</span><span class="n">DALFAMAX</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D+1</span><span class="o">*</span><span class="n">ALFA_STOP</span><span class="p">)</span>
<a name="ln-2282"></a>
<a name="ln-2283"></a>	<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="p">((</span><span class="n">F</span><span class="o">-</span><span class="n">FOTT</span><span class="p">)</span><span class="o">/</span><span class="n">DMAX1</span><span class="p">(</span><span class="mf">1.D-8</span><span class="p">,</span><span class="nb">DABS</span><span class="p">(</span><span class="n">DMAX1</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">FOTT</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-2284"></a>     										  <span class="p">)</span> <span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D-1</span>
<a name="ln-2285"></a>
<a name="ln-2286"></a><span class="c">!	L_F_VICINI = L_F_VICINI.AND.((DSQRT(DOT_PRODUCT(X-XOTT,X-XOTT))</span>
<a name="ln-2287"></a><span class="c">!     *			&lt;= 1.D-1))</span>
<a name="ln-2288"></a>
<a name="ln-2289"></a>	<span class="n">L_F_VICINI</span> <span class="o">=</span> <span class="n">L_F_VICINI</span><span class="p">.</span><span class="nb">AND</span><span class="p">.((</span><span class="nb">DSQRT</span><span class="p">(</span><span class="nb">DOT_PRODUCT</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">,</span><span class="n">X</span><span class="o">-</span><span class="n">XOTT</span><span class="p">))&amp;</span>
<a name="ln-2290"></a>     			<span class="o">&lt;=</span> <span class="mf">1.D-1</span><span class="p">)</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="p">(</span><span class="n">DALFAMAX</span> <span class="o">&lt;=</span> <span class="mf">0.5D+0</span><span class="o">*</span><span class="n">ALFAOTT</span><span class="p">))</span>
<a name="ln-2291"></a>
<a name="ln-2292"></a><span class="c">!	L_F_DISTANTI = ((F-FOTT)/DMAX1(1.D-16,DMAX1( DABS(FOTT),</span>
<a name="ln-2293"></a><span class="c">!     *										DABS(F) ) ) ).GE.5.D-1</span>
<a name="ln-2294"></a><span class="c">!	NON_MINIMIZZ = L_F_DISTANTI.AND.</span>
<a name="ln-2295"></a><span class="c">!     *			   (DALFAMAX.LE.DMIN1(1.0D-0,1.D+2*ALFA_STOP))</span>
<a name="ln-2296"></a>
<a name="ln-2297"></a><span class="c">!	NON_MINIMIZZ = L_F_DISTANTI.AND.(DALFAMAX.LE.1.D-3)</span>
<a name="ln-2298"></a>	
<a name="ln-2299"></a>	<span class="n">NON_MINIMIZZ</span> <span class="o">=</span> <span class="n">L_F_DISTANTI</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">L_F_VICINI</span>
<a name="ln-2300"></a>
<a name="ln-2301"></a>	<span class="k">IF</span><span class="p">(</span><span class="n">NON_MINIMIZZ</span><span class="p">)</span> <span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2302"></a>
<a name="ln-2303"></a><span class="c">!      IF(FFSTOP.LE.FFSTOPTOL) THEN</span>
<a name="ln-2304"></a><span class="c">!        ISTOP = 1</span>
<a name="ln-2305"></a><span class="c">!      END IF</span>
<a name="ln-2306"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">NUM_FUNCT</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="n">MAXNF</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2307"></a><span class="k">        </span><span class="n">ISTOP</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2308"></a>      <span class="k">END IF</span>
<a name="ln-2309"></a><span class="k">	</span>
<a name="ln-2310"></a><span class="k">	if</span><span class="p">((</span><span class="n">f</span><span class="o">-</span><span class="n">fglob</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="mf">1.0d0</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">fglob</span><span class="p">))</span><span class="o">&lt;</span><span class="mf">1.0d-4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2311"></a><span class="k">		</span><span class="n">istop</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2312"></a>	<span class="n">endif</span>
<a name="ln-2313"></a>	<span class="k">if</span><span class="p">((</span><span class="n">fott</span><span class="o">-</span><span class="n">fglob</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="mf">1.0d0</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">fglob</span><span class="p">))</span><span class="o">&lt;</span><span class="mf">1.0d-4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2314"></a><span class="k">		</span><span class="n">istop</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-2315"></a>	<span class="n">endif</span>
<a name="ln-2316"></a>
<a name="ln-2317"></a>      <span class="k">RETURN</span>
<a name="ln-2318"></a>
<a name="ln-2319"></a><span class="k">      END</span>
<a name="ln-2320"></a>
<a name="ln-2321"></a><span class="c">! *****************************************************************</span>
<a name="ln-2322"></a><span class="c">! *****************************************************************</span>
<a name="ln-2323"></a><span class="c">! *****************************************************************</span>
<a name="ln-2324"></a>
<a name="ln-2325"></a>      <span class="k">SUBROUTINE </span><span class="n">LINESEARCH_INVERTI</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">FZ</span><span class="p">,&amp;</span>
<a name="ln-2326"></a>      <span class="n">I_CORR</span><span class="p">,</span><span class="n">NUM_FAL</span><span class="p">,</span><span class="n">DALFAMAX</span><span class="p">,</span><span class="n">IPRINT</span><span class="p">,&amp;</span>
<a name="ln-2327"></a>      <span class="n">ipar</span><span class="p">,</span><span class="n">fparebsd</span><span class="p">,</span><span class="n">initmeanval</span><span class="p">,</span><span class="n">ninit</span><span class="p">,</span><span class="n">nipar</span><span class="p">,</span><span class="n">nfpar</span><span class="p">,</span><span class="n">expt</span><span class="p">,</span><span class="n">accum_e</span><span class="p">,&amp;</span>
<a name="ln-2328"></a>      <span class="n">mLPNH</span><span class="p">,</span><span class="n">mLPSH</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">calfun</span><span class="p">)</span>
<a name="ln-2329"></a>     
<a name="ln-2330"></a>      <span class="k">IMPLICIT NONE</span>
<a name="ln-2331"></a>
<a name="ln-2332"></a><span class="k">      </span><span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span><span class="n">I_CORR</span><span class="p">,</span><span class="n">NUM_FUNCT</span>
<a name="ln-2333"></a>      <span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">LL</span>
<a name="ln-2334"></a>      <span class="kt">INTEGER </span><span class="n">NUM_FAL</span>
<a name="ln-2335"></a>      <span class="kt">INTEGER </span><span class="n">IPRINT</span>
<a name="ln-2336"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">X</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2337"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">F</span><span class="p">,</span><span class="n">ALFA</span><span class="p">,</span><span class="n">FZ</span><span class="p">,</span><span class="nb">GAMMA</span><span class="p">,</span><span class="n">DNR</span>
<a name="ln-2338"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DELTA</span><span class="p">,</span><span class="n">DELTA1</span><span class="p">,</span><span class="n">FPAR</span><span class="p">,</span><span class="n">FZDELTA</span>
<a name="ln-2339"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">ALFAEX</span><span class="p">,</span><span class="n">FMIN</span><span class="p">,</span><span class="n">ALFAMIN</span> 
<a name="ln-2340"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">DALFAMAX</span><span class="p">,</span><span class="n">FCOMMON</span>
<a name="ln-2341"></a>      <span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span> <span class="n">ALFAOLD</span><span class="p">,</span><span class="n">FZOLD</span>
<a name="ln-2342"></a>      <span class="kt">LOGICAL </span><span class="n">PRIMA_VOLTA</span>
<a name="ln-2343"></a>      <span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">ipar</span><span class="p">(</span><span class="n">nipar</span><span class="p">)</span>
<a name="ln-2344"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">fparebsd</span><span class="p">(</span><span class="n">nfpar</span><span class="p">)</span>
<a name="ln-2345"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">initmeanval</span><span class="p">(</span><span class="n">ninit</span><span class="p">)</span>
<a name="ln-2346"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ninit</span>
<a name="ln-2347"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nipar</span>
<a name="ln-2348"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">irg</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">nfpar</span>
<a name="ln-2349"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">expt</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ipar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a name="ln-2350"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">accum_e</span><span class="p">(</span><span class="n">ipar</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<a name="ln-2351"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPNH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-2352"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">sgl</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">mLPSH</span><span class="p">(</span><span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="o">-</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span><span class="n">ipar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ipar</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<a name="ln-2353"></a>      <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>          <span class="kd">::</span> <span class="n">verbose</span>
<a name="ln-2354"></a>      <span class="k">procedure</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">calfun</span>
<a name="ln-2355"></a>      <span class="k">COMMON</span> <span class="o">/</span><span class="n">NUM</span><span class="o">/</span><span class="n">FCOMMON</span>
<a name="ln-2356"></a>	<span class="k">COMMON</span> <span class="o">/</span><span class="n">NUMNEW</span><span class="o">/</span><span class="n">NUM_FUNCT</span>
<a name="ln-2357"></a>
<a name="ln-2358"></a>	<span class="n">PRIMA_VOLTA</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2359"></a>      <span class="nb">GAMMA</span> <span class="o">=</span> <span class="mf">1.d-6</span>
<a name="ln-2360"></a>      <span class="n">DELTA</span> <span class="o">=</span><span class="mf">0.5D0</span>
<a name="ln-2361"></a>      <span class="n">DELTA1</span> <span class="o">=</span><span class="mf">0.5D0</span>
<a name="ln-2362"></a>      <span class="n">DNR</span><span class="o">=</span><span class="mf">1.D0</span>
<a name="ln-2363"></a>
<a name="ln-2364"></a>
<a name="ln-2365"></a><span class="c">!     indice della direzione corrente</span>
<a name="ln-2366"></a>
<a name="ln-2367"></a>      <span class="n">J</span><span class="o">=</span><span class="n">I_CORR</span>
<a name="ln-2368"></a>
<a name="ln-2369"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2370"></a><span class="k">         WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; J=&#39;</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="s1">&#39;  D(J)=&#39;</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="s1">&#39;  DOLDALFA=&#39;</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2371"></a>         <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; J=&#39;</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="s1">&#39;  D(J)=&#39;</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="s1">&#39;  DOLDALFA=&#39;</span><span class="p">,</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2372"></a>      <span class="n">ENDIF</span>
<a name="ln-2373"></a>
<a name="ln-2374"></a> <span class="mi">10</span>   <span class="k">CONTINUE</span>
<a name="ln-2375"></a>
<a name="ln-2376"></a><span class="k">      </span><span class="n">ALFA</span><span class="o">=</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2377"></a>
<a name="ln-2378"></a>      <span class="k">IF</span><span class="p">(</span><span class="nb">DABS</span><span class="p">(</span><span class="n">ALFA</span><span class="p">).</span><span class="n">LE</span><span class="p">.</span><span class="mf">1.D-3</span><span class="o">*</span><span class="n">DALFAMAX</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2379"></a><span class="k">	   </span>
<a name="ln-2380"></a><span class="k">	   </span><span class="n">ALFA</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-2381"></a>         <span class="k">RETURN</span>
<a name="ln-2382"></a><span class="k">      </span>
<a name="ln-2383"></a><span class="k">      END IF</span>
<a name="ln-2384"></a>
<a name="ln-2385"></a><span class="mi">20</span>	<span class="k">CONTINUE</span>
<a name="ln-2386"></a>
<a name="ln-2387"></a><span class="k">      </span><span class="n">Z</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">ALFA</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2388"></a>
<a name="ln-2389"></a>      <span class="n">ALFAEX</span><span class="o">=</span><span class="n">ALFA</span>
<a name="ln-2390"></a>       
<a name="ln-2391"></a>      <span class="c">!CALL FUNCT(Z,N,FZ)</span>
<a name="ln-2392"></a>      <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2393"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">FZ</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-2394"></a>      <span class="n">NUM_FUNCT</span><span class="o">=</span><span class="n">NUM_FUNCT</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2395"></a>
<a name="ln-2396"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2397"></a><span class="k">         WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; FZ =&#39;</span><span class="p">,</span><span class="n">FZ</span><span class="p">,</span><span class="s1">&#39;   ALFA =&#39;</span><span class="p">,</span><span class="n">ALFA</span>
<a name="ln-2398"></a>         <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; FZ =&#39;</span><span class="p">,</span><span class="n">FZ</span><span class="p">,</span><span class="s1">&#39;   ALFA =&#39;</span><span class="p">,</span><span class="n">ALFA</span>
<a name="ln-2399"></a>      <span class="n">ENDIF</span>
<a name="ln-2400"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2401"></a><span class="k">         DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2402"></a>            <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Z(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2403"></a>            <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Z(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2404"></a>         <span class="n">ENDDO</span>
<a name="ln-2405"></a>      <span class="n">ENDIF</span>
<a name="ln-2406"></a>
<a name="ln-2407"></a>        
<a name="ln-2408"></a>      <span class="n">FPAR</span><span class="o">=</span> <span class="n">F</span><span class="o">-</span><span class="nb">GAMMA</span><span class="o">*</span><span class="n">ALFA</span><span class="o">*</span><span class="n">ALFA</span>
<a name="ln-2409"></a>
<a name="ln-2410"></a>      <span class="k">IF</span><span class="p">(</span><span class="n">FZ</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">FPAR</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2411"></a><span class="k">         </span><span class="n">FMIN</span><span class="o">=</span><span class="n">FZ</span>
<a name="ln-2412"></a>         <span class="n">ALFAMIN</span><span class="o">=</span><span class="n">ALFA</span> 
<a name="ln-2413"></a>
<a name="ln-2414"></a><span class="c">!       controllo sull&#39;espansione</span>
<a name="ln-2415"></a>
<a name="ln-2416"></a>   <span class="mi">11</span>    <span class="k">CONTINUE</span>
<a name="ln-2417"></a>
<a name="ln-2418"></a><span class="k">         </span><span class="n">ALFAEX</span><span class="o">=</span><span class="n">ALFA</span><span class="o">/</span><span class="n">DELTA1</span>
<a name="ln-2419"></a>
<a name="ln-2420"></a>         <span class="n">Z</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">ALFAEX</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2421"></a>               
<a name="ln-2422"></a>         <span class="c">!CALL FUNCT(Z,N,FZDELTA)</span>
<a name="ln-2423"></a>         <span class="k">call  </span><span class="n">calfun</span><span class="p">(</span><span class="n">nipar</span><span class="p">,</span> <span class="n">nfpar</span><span class="p">,</span> <span class="n">ninit</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">fparebsd</span><span class="p">,</span> <span class="n">initmeanval</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">accum_e</span><span class="p">,</span> <span class="n">mLPNH</span><span class="p">,</span> <span class="n">mLPSH</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2424"></a>                                <span class="n">N</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">FZDELTA</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<a name="ln-2425"></a>         <span class="n">NUM_FUNCT</span><span class="o">=</span><span class="n">NUM_FUNCT</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2426"></a>
<a name="ln-2427"></a>         <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2428"></a><span class="k">            WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; FZex=&#39;</span><span class="p">,</span><span class="n">FZDELTA</span><span class="p">,</span><span class="s1">&#39;  ALFAEX=&#39;</span><span class="p">,</span><span class="n">ALFAEX</span>  
<a name="ln-2429"></a>            <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; FZex=&#39;</span><span class="p">,</span><span class="n">FZDELTA</span><span class="p">,</span><span class="s1">&#39;  ALFAEX=&#39;</span><span class="p">,</span><span class="n">ALFAEX</span>
<a name="ln-2430"></a>         <span class="n">ENDIF</span>
<a name="ln-2431"></a>         <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2432"></a><span class="k">             DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<a name="ln-2433"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Z(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2434"></a>                <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; Z(&#39;</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;)=&#39;</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a name="ln-2435"></a>             <span class="n">ENDDO</span>
<a name="ln-2436"></a>         <span class="n">ENDIF</span>
<a name="ln-2437"></a>
<a name="ln-2438"></a>         <span class="n">FPAR</span><span class="o">=</span> <span class="n">F</span><span class="o">-</span><span class="nb">GAMMA</span><span class="o">*</span><span class="n">ALFAEX</span><span class="o">*</span><span class="n">ALFAEX</span>
<a name="ln-2439"></a>         <span class="k">IF</span><span class="p">(</span><span class="n">FZDELTA</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">FPAR</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2440"></a><span class="k">                </span><span class="n">FZ</span><span class="o">=</span><span class="n">FZDELTA</span>
<a name="ln-2441"></a>                <span class="n">ALFA</span><span class="o">=</span><span class="n">ALFAEX</span>
<a name="ln-2442"></a>                <span class="n">GO</span> <span class="n">TO</span> <span class="mi">11</span>
<a name="ln-2443"></a>         <span class="k">ELSE</span>
<a name="ln-2444"></a><span class="k">                  </span>
<a name="ln-2445"></a><span class="k">              </span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DELTA</span><span class="o">*</span><span class="n">ALFA</span>
<a name="ln-2446"></a>
<a name="ln-2447"></a>              <span class="k">RETURN</span>
<a name="ln-2448"></a><span class="k">         END IF</span>
<a name="ln-2449"></a>
<a name="ln-2450"></a><span class="k">      ELSE </span>
<a name="ln-2451"></a>
<a name="ln-2452"></a><span class="k">          </span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=-</span><span class="n">D</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2453"></a>		<span class="k">IF</span><span class="p">(</span><span class="n">PRIMA_VOLTA</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2454"></a><span class="k">			</span><span class="n">PRIMA_VOLTA</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2455"></a>			<span class="n">GO</span> <span class="n">TO</span> <span class="mi">20</span>
<a name="ln-2456"></a>		<span class="n">ENDIF</span>
<a name="ln-2457"></a>
<a name="ln-2458"></a>          <span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DELTA</span><span class="o">*</span><span class="n">DOLDALFA</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
<a name="ln-2459"></a>
<a name="ln-2460"></a>
<a name="ln-2461"></a>          <span class="k">IF</span><span class="p">(</span><span class="n">IPRINT</span><span class="p">.</span><span class="n">GE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2462"></a><span class="k">              WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta&#39;</span>
<a name="ln-2463"></a>              <span class="k">WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39; direzione opposta&#39;</span>
<a name="ln-2464"></a>          <span class="n">ENDIF</span>
<a name="ln-2465"></a>
<a name="ln-2466"></a>          <span class="n">ALFA</span><span class="o">=</span><span class="mf">0.D0</span>
<a name="ln-2467"></a>          <span class="k">RETURN</span>
<a name="ln-2468"></a>
<a name="ln-2469"></a><span class="k">      END IF</span>
<a name="ln-2470"></a>
<a name="ln-2471"></a><span class="k">      END</span>
<a name="ln-2472"></a>
<a name="ln-2473"></a><span class="k">end module </span><span class="n">SimAnn</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/apb.f90.html">apb.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa.f90.html">bobyqa.f90</a>
      
      <a class="list-group-item" href="../sourcefile/bobyqa_refinement.f90.html">bobyqa_refinement.f90</a>
      
      <a class="list-group-item" href="../sourcefile/clsupport.f90.html">CLsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/constants.f90.html">constants.f90</a>
      
      <a class="list-group-item" href="../sourcefile/defectmodule.f90.html">defectmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dictmod.f90.html">dictmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/dispfield.f90.html">dispfield.f90</a>
      
      <a class="list-group-item" href="../sourcefile/distortion.f90.html">distortion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eccimod.f90.html">ECCImod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/eispack.f90.html">eispack.f90</a>
      
      <a class="list-group-item" href="../sourcefile/emdymod.f90.html">EMdymod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/filters.f90.html">filters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/hdftest.f90.html">hdftest.f90</a>
      
      <a class="list-group-item" href="../sourcefile/indexingmod.f90.html">Indexingmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/initializers.f90.html">initializers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/jsonsupport.f90.html">JSONsupport.f90</a>
      
      <a class="list-group-item" href="../sourcefile/muellercalculus.f90.html">MuellerCalculus.f90</a>
      
      <a class="list-group-item" href="../sourcefile/multibeams.f90.html">multibeams.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisthandlers.f90.html">NameListHandlers.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelistjsonwriters.f90.html">NameListJSONwriters.f90</a>
      
      <a class="list-group-item" href="../sourcefile/namelisttypedefs.f90.html">NameListTypedefs.f90</a>
      
      <a class="list-group-item" href="../sourcefile/noise.f90.html">noise.f90</a>
      
      <a class="list-group-item" href="../sourcefile/others.f90.html">others.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pedmod.f90.html">PEDmod.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pfinversion.f90.html">PFInversion.f90</a>
      
      <a class="list-group-item" href="../sourcefile/pgm.f90.html">pgm.f90</a>
      
      <a class="list-group-item" href="../sourcefile/povray.f90.html">povray.f90</a>
      
      <a class="list-group-item" href="../sourcefile/rng.f90.html">rng.f90</a>
      
      <a class="list-group-item" href="../sourcefile/simulated_annealing.f90.html">simulated_annealing.f90</a>
      
      <a class="list-group-item" href="../sourcefile/so3.f90.html">so3.f90</a>
      
      <a class="list-group-item" href="../sourcefile/stemmodule.f90.html">STEMmodule.f90</a>
      
      <a class="list-group-item" href="../sourcefile/timing.f90.html">timing.f90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a></p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Fortran Program was developed by Marc De Graef Research Group/Carnegie Mellon University</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>