! ###################################################################
! Copyright (c) 2017-2019, Marc De Graef Research Group/Carnegie Mellon University
! All rights reserved.
!
! Redistribution and use in source and binary forms, with or without modification, are 
! permitted provided that the following conditions are met:
!
!     - Redistributions of source code must retain the above copyright notice, this list 
!        of conditions and the following disclaimer.
!     - Redistributions in binary form must reproduce the above copyright notice, this 
!        list of conditions and the following disclaimer in the documentation and/or 
!        other materials provided with the distribution.
!     - Neither the names of Marc De Graef, Carnegie Mellon University nor the names 
!        of its contributors may be used to endorse or promote products derived from 
!        this software without specific prior written permission.
!
! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
! ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
! LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
! DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR 
! SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER 
! CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, 
! OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE 
! USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
! ###################################################################

!--------------------------------------------------------------------------
! EMsoft:MODRotationsTest.f90
!--------------------------------------------------------------------------
!
!> @author Marc De Graef, Carnegie Mellon University
!
!> @brief extensive testing of pair and triplet rotation transformations for 75 rotations
!
!> @details  
!> This file was generated by an IDL routine (mkRotationsTest.pro); do not edit by hand!!! 
!> The current source code was generated on Fri Oct 27 12:32:32 2017
! 
!> @date 10/27/17 MDG 1.0 original
!> @date 10/29/19 SS  1.1 added tests for exponential map
!--------------------------------------------------------------------------
module MODRotationsTest

contains 

subroutine MODRotationsExecuteTest(res) &
           bind(c, name='MODRotationsExecuteTest')    ! this routine is callable from a C/C++ program
!DEC$ ATTRIBUTES DLLEXPORT :: MODRotationsExecuteTest

use local
use constants
use math
use rotations
use Lambert
use typedefs
use quaternions
use,INTRINSIC :: ISO_C_BINDING

IMPLICIT NONE

integer(C_INT32_T),INTENT(OUT)  :: res

real(kind=dbl)        :: ieu(3), oeu(3), iro(4), oro(4), iho(3), oho(3), icu(3), ocu(3), ist(3)
real(kind=dbl)        :: iax(4), oax(4), iqu(4), oqu(4), ivec(3), ovec(3), ost(3), iex(3), oex(3)
real(kind=dbl)        :: iom(3,3), oom(3,3), omm(3,3), diff, diffmax, dtor, aux
real(kind=dbl),parameter :: maxerr = 5.0D-8
integer(kind=irg)     :: tcnt, i,  numarg, testcounter, testsfailed
integer(kind=irg),parameter :: rcnt = 75
character(fnlen)      :: arg
type(orientationtyped):: ot
logical               :: verbose
! list of 75 rotations that provide a good workout for the rotations module (lots of special cases) 
real(kind=dbl)        :: rots(3,rcnt) = reshape( (/ 0.D0,  0.D0, 0.0D0, &
                                                   90.D0,  0.D0, 0.0D0, &
                                                   180.D0,  0.D0, 0.0D0, &
                                                   270.D0,  0.D0, 0.0D0, &
                                                   360.D0,  0.D0, 0.0D0, &
                                                   0.D0, 90.D0, 0.0D0, &
                                                   90.D0, 90.D0, 0.0D0, &
                                                   180.D0, 90.D0, 0.0D0, &
                                                   270.D0, 90.D0, 0.0D0, &
                                                   0.D0,180.D0, 0.0D0, &
                                                   90.D0,180.D0, 0.0D0, &
                                                   180.D0,180.D0, 0.0D0, &
                                                   270.D0,180.D0, 0.0D0, &
                                                   360.D0,180.D0, 0.0D0, &
                                                   0.D0,  0.D0,90.0D0, &
                                                   90.D0,  0.D0,90.0D0, &
                                                   180.D0,  0.D0,90.0D0, &
                                                   270.D0,  0.D0,90.0D0, &
                                                   360.D0,  0.D0,90.0D0, &
                                                   0.D0, 90.D0,90.0D0, &
                                                   90.D0, 90.D0,90.0D0, &
                                                   180.D0, 90.D0,90.0D0, &
                                                   270.D0, 90.D0,90.0D0, &
                                                   360.D0, 90.D0,90.0D0, &
                                                   0.D0,180.D0,90.0D0, &
                                                   90.D0,180.D0,90.0D0, &
                                                   180.D0,180.D0,90.0D0, &
                                                   270.D0,180.D0,90.0D0, &
                                                   360.D0,180.D0,90.0D0, &
                                                   0.D0,  0.D0,180.0D0, &
                                                   90.D0,  0.D0,180.0D0, &
                                                   180.D0,  0.D0,180.0D0, &
                                                   270.D0,  0.D0,180.0D0, &
                                                   360.D0,  0.D0,180.0D0, &
                                                   0.D0, 90.D0,180.0D0, &
                                                   90.D0, 90.D0,180.0D0, &
                                                   180.D0, 90.D0,180.0D0, &
                                                   270.D0, 90.D0,180.0D0, &
                                                   360.D0, 90.D0,180.0D0, &
                                                   0.D0,180.D0,180.0D0, &
                                                   90.D0,180.D0,180.0D0, &
                                                   180.D0,180.D0,180.0D0, &
                                                   270.D0,180.D0,180.0D0, &
                                                   360.D0,180.D0,180.0D0, &
                                                   0.D0,  0.D0,270.0D0, &
                                                   90.D0,  0.D0,270.0D0, &
                                                   180.D0,  0.D0,270.0D0, &
                                                   270.D0,  0.D0,270.0D0, &
                                                   360.D0,  0.D0,270.0D0, &
                                                   0.D0, 90.D0,270.0D0, &
                                                   90.D0, 90.D0,270.0D0, &
                                                   180.D0, 90.D0,270.0D0, &
                                                   270.D0, 90.D0,270.0D0, &
                                                   360.D0, 90.D0,270.0D0, &
                                                   0.D0,180.D0,270.0D0, &
                                                   90.D0,180.D0,270.0D0, &
                                                   180.D0,180.D0,270.0D0, &
                                                   270.D0,180.D0,270.0D0, &
                                                   360.D0,180.D0,270.0D0, &
                                                   0.D0,  0.D0,360.0D0, &
                                                   90.D0,  0.D0,360.0D0, &
                                                   180.D0,  0.D0,360.0D0, &
                                                   270.D0,  0.D0,360.0D0, &
                                                   360.D0,  0.D0,360.0D0, &
                                                   0.D0, 90.D0,360.0D0, &
                                                   90.D0, 90.D0,360.0D0, &
                                                   180.D0, 90.D0,360.0D0, &
                                                   270.D0, 90.D0,360.0D0, &
                                                   360.D0, 90.D0,360.0D0, &
                                                   0.D0,180.D0,360.0D0, &
                                                   90.D0,180.D0,360.0D0, &
                                                   180.D0,180.D0,360.0D0, &
                                                   270.D0,180.D0,360.0D0, &
                                                   360.D0,180.D0,360.0D0, &
                                                   360.D0, 90.D0, 0.0D0 /), (/ 3, rcnt /) )



verbose = .FALSE.
ivec = (/ 1.D0, 1.D0, 0.D0 /)
dtor = cPi/180.D0
testcounter = 0
testsfailed = 0
do i=1,rcnt
! create the orientation type for a given Euler triplet
 ieu = rots(1:3,i) * dtor
 ot = init_orientation(ieu, 'eu')
 if (verbose) write(*,*) '  '
 if (verbose) write(*,*) '----------------------------------------------------'
 if (verbose) call print_orientation(ot)
 
! individual tests  x = Oinv [ O [x] ]
 
  diffmax = 0.D0
tcnt = 0
if (verbose)  write (*,*) 'eu test'
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(eu2om(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(eu2ax(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(eu2ro(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(eu2qu(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(eu2ho(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(eu2cu(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(eu2st(ieu))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'om test'
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(om2eu(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(om2ax(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(om2ro(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(om2qu(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(om2ho(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(om2cu(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(om2st(iom))
  diff = maxval(abs(oom-iom))
  if (verbose)   write (*,*) 'om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'ax test'
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(ax2eu(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(ax2om(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(ax2ro(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(ax2qu(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(ax2ho(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(ax2cu(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(ax2st(iax))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)   write (*,*) 'ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'ro test'
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(ro2eu(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(ro2om(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(ro2ax(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(ro2qu(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(ro2ho(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(ro2cu(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(ro2st(iro))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)   write (*,*) 'ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'qu test'
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(qu2eu(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(qu2om(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(qu2ax(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(qu2ro(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(qu2ho(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(qu2cu(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(qu2st(iqu))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)   write (*,*) 'qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'ho test'
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(ho2eu(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(ho2om(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(ho2ax(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(ho2ro(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(ho2qu(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(ho2cu(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(ho2st(iho))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)   write (*,*) 'ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'cu test'
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(cu2eu(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(cu2om(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(cu2ax(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(cu2ro(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(cu2qu(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(cu2ho(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(cu2st(icu))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)   write (*,*) 'cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose)  write (*,*) 'st test'
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(st2eu(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(st2om(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(st2ax(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(st2ro(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(st2qu(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(st2ho(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(st2cu(ist))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)   write (*,*) 'st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
! adding all ex2xx-xx2ex tests where xx are all the other rotation representations 
! already implemented [added 10/29/2019 by SS]

if(verbose) write(6,*) 'ex test'
testcounter = testcounter + 1
  iex = ot%expomap
  oex = eu2ex(ex2eu(iex))

  omm = ex2om(oex)
  diff = maxval(abs(omm-ot%om))
  if (verbose)   write (*,*) 'ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = om2ex(ex2om(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = ro2ex(ex2ro(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = qu2ex(ex2qu(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = ax2ex(ex2ax(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = ho2ex(ex2ho(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = st2ex(ex2st(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  iex = ot%expomap
  oex = cu2ex(ex2cu(iex))

  iom = ex2om(oex)
  diff = maxval(abs(iom-ot%om))
  if (verbose)   write (*,*) 'ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

 if (verbose) write (*,*) ' Maximum difference in pairwise tests  : ', diffmax
 
 
! triple tests 
 
  diffmax = 0.D0
  tcnt = 0
if (verbose) write (*,*) 'triple eu test'
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(om2ax(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-om2ax-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-om2ax-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(om2ro(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-om2ro-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-om2ro-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(om2qu(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-om2qu-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-om2qu-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(om2ho(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-om2ho-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-om2ho-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(om2cu(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-om2cu-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-om2cu-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(om2st(eu2om(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-om2st-eu2om max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-om2st-eu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(ax2om(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-ax2om-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-ax2om-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(ax2ro(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-ax2ro-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-ax2ro-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(ax2qu(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-ax2qu-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-ax2qu-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(ax2ho(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-ax2ho-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-ax2ho-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(ax2cu(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-ax2cu-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-ax2cu-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(ax2st(eu2ax(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-ax2st-eu2ax max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-ax2st-eu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(ro2om(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-ro2om-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-ro2om-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(ro2ax(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-ro2ax-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-ro2ax-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(ro2qu(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-ro2qu-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-ro2qu-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(ro2ho(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-ro2ho-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-ro2ho-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(ro2cu(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-ro2cu-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-ro2cu-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(ro2st(eu2ro(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-ro2st-eu2ro max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-ro2st-eu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(qu2om(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-qu2om-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-qu2om-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(qu2ax(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-qu2ax-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-qu2ax-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(qu2ro(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-qu2ro-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-qu2ro-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(qu2ho(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-qu2ho-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-qu2ho-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(qu2cu(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-qu2cu-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-qu2cu-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(qu2st(eu2qu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-qu2st-eu2qu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-qu2st-eu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(ho2om(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-ho2om-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-ho2om-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(ho2ax(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-ho2ax-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-ho2ax-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(ho2ro(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-ho2ro-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-ho2ro-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(ho2qu(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-ho2qu-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-ho2qu-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(ho2cu(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-ho2cu-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-ho2cu-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(ho2st(eu2ho(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-ho2st-eu2ho max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-ho2st-eu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(cu2om(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-cu2om-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-cu2om-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(cu2ax(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-cu2ax-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-cu2ax-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(cu2ro(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-cu2ro-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-cu2ro-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(cu2qu(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-cu2qu-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-cu2qu-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(cu2ho(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-cu2ho-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-cu2ho-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = st2eu(cu2st(eu2cu(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'st2eu-cu2st-eu2cu max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2eu-cu2st-eu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = om2eu(st2om(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'om2eu-st2om-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2eu-st2om-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ax2eu(st2ax(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ax2eu-st2ax-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2eu-st2ax-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ro2eu(st2ro(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ro2eu-st2ro-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2eu-st2ro-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = qu2eu(st2qu(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'qu2eu-st2qu-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2eu-st2qu-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = ho2eu(st2ho(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'ho2eu-st2ho-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2eu-st2ho-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ieu = ot%eulang
  oeu = cu2eu(st2cu(eu2st(ieu)))
  omm = eu2om(oeu)
  diff = maxval(abs(omm-ot%om))
  if (verbose)  write (*,*) 'cu2eu-st2cu-eu2st max om difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2eu-st2cu-eu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple om test'
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(eu2ax(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-eu2ax-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-eu2ax-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(eu2ro(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-eu2ro-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-eu2ro-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(eu2qu(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-eu2qu-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-eu2qu-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(eu2ho(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-eu2ho-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-eu2ho-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(eu2cu(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-eu2cu-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-eu2cu-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(eu2st(om2eu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-eu2st-om2eu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-eu2st-om2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(ax2eu(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-ax2eu-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-ax2eu-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(ax2ro(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-ax2ro-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-ax2ro-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(ax2qu(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-ax2qu-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-ax2qu-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(ax2ho(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-ax2ho-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-ax2ho-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(ax2cu(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-ax2cu-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-ax2cu-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(ax2st(om2ax(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-ax2st-om2ax max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-ax2st-om2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(ro2eu(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-ro2eu-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-ro2eu-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(ro2ax(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-ro2ax-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-ro2ax-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(ro2qu(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-ro2qu-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-ro2qu-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(ro2ho(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-ro2ho-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-ro2ho-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(ro2cu(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-ro2cu-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-ro2cu-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(ro2st(om2ro(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-ro2st-om2ro max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-ro2st-om2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(qu2eu(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-qu2eu-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-qu2eu-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(qu2ax(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-qu2ax-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-qu2ax-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(qu2ro(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-qu2ro-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-qu2ro-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(qu2ho(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-qu2ho-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-qu2ho-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(qu2cu(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-qu2cu-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-qu2cu-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(qu2st(om2qu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-qu2st-om2qu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-qu2st-om2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(ho2eu(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-ho2eu-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-ho2eu-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(ho2ax(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-ho2ax-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-ho2ax-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(ho2ro(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-ho2ro-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-ho2ro-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(ho2qu(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-ho2qu-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-ho2qu-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(ho2cu(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-ho2cu-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-ho2cu-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(ho2st(om2ho(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-ho2st-om2ho max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-ho2st-om2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(cu2eu(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-cu2eu-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-cu2eu-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(cu2ax(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-cu2ax-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-cu2ax-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(cu2ro(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-cu2ro-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-cu2ro-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(cu2qu(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-cu2qu-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-cu2qu-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(cu2ho(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-cu2ho-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-cu2ho-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = st2om(cu2st(om2cu(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'st2om-cu2st-om2cu max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2om-cu2st-om2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = eu2om(st2eu(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'eu2om-st2eu-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2om-st2eu-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ax2om(st2ax(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ax2om-st2ax-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2om-st2ax-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ro2om(st2ro(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ro2om-st2ro-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2om-st2ro-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = qu2om(st2qu(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'qu2om-st2qu-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2om-st2qu-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = ho2om(st2ho(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'ho2om-st2ho-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2om-st2ho-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iom = ot%om
  oom = cu2om(st2cu(om2st(iom)))
  diff = maxval(abs(oom-iom))
  if (verbose)  write (*,*) 'cu2om-st2cu-om2st max difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2om-st2cu-om2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple ax test'
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(eu2om(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-eu2om-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-eu2om-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(eu2ro(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-eu2ro-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-eu2ro-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(eu2qu(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-eu2qu-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-eu2qu-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(eu2ho(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-eu2ho-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-eu2ho-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(eu2cu(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-eu2cu-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-eu2cu-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(eu2st(ax2eu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-eu2st-ax2eu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-eu2st-ax2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(om2eu(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-om2eu-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-om2eu-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(om2ro(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-om2ro-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-om2ro-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(om2qu(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-om2qu-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-om2qu-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(om2ho(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-om2ho-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-om2ho-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(om2cu(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-om2cu-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-om2cu-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(om2st(ax2om(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-om2st-ax2om max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-om2st-ax2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(ro2eu(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-ro2eu-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-ro2eu-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(ro2om(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-ro2om-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-ro2om-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(ro2qu(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-ro2qu-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-ro2qu-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(ro2ho(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-ro2ho-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-ro2ho-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(ro2cu(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-ro2cu-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-ro2cu-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(ro2st(ax2ro(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-ro2st-ax2ro max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-ro2st-ax2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(qu2eu(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-qu2eu-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-qu2eu-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(qu2om(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-qu2om-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-qu2om-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(qu2ro(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-qu2ro-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-qu2ro-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(qu2ho(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-qu2ho-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-qu2ho-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(qu2cu(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-qu2cu-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-qu2cu-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(qu2st(ax2qu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-qu2st-ax2qu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-qu2st-ax2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(ho2eu(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-ho2eu-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-ho2eu-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(ho2om(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-ho2om-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-ho2om-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(ho2ro(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-ho2ro-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-ho2ro-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(ho2qu(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-ho2qu-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-ho2qu-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(ho2cu(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-ho2cu-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-ho2cu-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(ho2st(ax2ho(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-ho2st-ax2ho max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-ho2st-ax2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(cu2eu(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-cu2eu-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-cu2eu-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(cu2om(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-cu2om-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-cu2om-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(cu2ro(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-cu2ro-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-cu2ro-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(cu2qu(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-cu2qu-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-cu2qu-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(cu2ho(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-cu2ho-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-cu2ho-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = st2ax(cu2st(ax2cu(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'st2ax-cu2st-ax2cu max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ax-cu2st-ax2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = eu2ax(st2eu(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'eu2ax-st2eu-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ax-st2eu-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = om2ax(st2om(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'om2ax-st2om-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ax-st2om-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ro2ax(st2ro(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ro2ax-st2ro-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ax-st2ro-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = qu2ax(st2qu(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'qu2ax-st2qu-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ax-st2qu-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = ho2ax(st2ho(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'ho2ax-st2ho-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ax-st2ho-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iax = ot%axang
  oax = cu2ax(st2cu(ax2st(iax)))
  if ((oax(4)-cPi).lt.1.D-08) then
    diff = maxval(abs(oax(1:3))-abs(ot%axang(1:3)))
  else
    diff = maxval(abs(oax-ot%axang))
  end if 
  if (verbose)  write (*,*) 'cu2ax-st2cu-ax2st max ax difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ax-st2cu-ax2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple ro test'
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(eu2om(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-eu2om-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-eu2om-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(eu2ax(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-eu2ax-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-eu2ax-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(eu2qu(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-eu2qu-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-eu2qu-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(eu2ho(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-eu2ho-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-eu2ho-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(eu2cu(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-eu2cu-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-eu2cu-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(eu2st(ro2eu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-eu2st-ro2eu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-eu2st-ro2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(om2eu(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-om2eu-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-om2eu-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(om2ax(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-om2ax-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-om2ax-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(om2qu(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-om2qu-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-om2qu-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(om2ho(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-om2ho-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-om2ho-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(om2cu(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-om2cu-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-om2cu-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(om2st(ro2om(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-om2st-ro2om max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-om2st-ro2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(ax2eu(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-ax2eu-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-ax2eu-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(ax2om(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-ax2om-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-ax2om-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(ax2qu(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-ax2qu-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-ax2qu-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(ax2ho(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-ax2ho-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-ax2ho-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(ax2cu(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-ax2cu-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-ax2cu-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(ax2st(ro2ax(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-ax2st-ro2ax max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-ax2st-ro2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(qu2eu(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-qu2eu-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-qu2eu-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(qu2om(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-qu2om-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-qu2om-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(qu2ax(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-qu2ax-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-qu2ax-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(qu2ho(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-qu2ho-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-qu2ho-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(qu2cu(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-qu2cu-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-qu2cu-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(qu2st(ro2qu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-qu2st-ro2qu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-qu2st-ro2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(ho2eu(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-ho2eu-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-ho2eu-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(ho2om(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-ho2om-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-ho2om-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(ho2ax(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-ho2ax-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-ho2ax-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(ho2qu(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-ho2qu-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-ho2qu-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(ho2cu(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-ho2cu-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-ho2cu-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(ho2st(ro2ho(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-ho2st-ro2ho max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-ho2st-ro2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(cu2eu(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-cu2eu-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-cu2eu-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(cu2om(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-cu2om-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-cu2om-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(cu2ax(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-cu2ax-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-cu2ax-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(cu2qu(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-cu2qu-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-cu2qu-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(cu2ho(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-cu2ho-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-cu2ho-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = st2ro(cu2st(ro2cu(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'st2ro-cu2st-ro2cu max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ro-cu2st-ro2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = eu2ro(st2eu(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'eu2ro-st2eu-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ro-st2eu-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = om2ro(st2om(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'om2ro-st2om-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ro-st2om-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ax2ro(st2ax(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ax2ro-st2ax-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ro-st2ax-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = qu2ro(st2qu(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'qu2ro-st2qu-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ro-st2qu-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = ho2ro(st2ho(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'ho2ro-st2ho-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ro-st2ho-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iro = ot%rodrigues
  oro = cu2ro(st2cu(ro2st(iro)))
  if (oro(4).eq.inftyd()) then
    diff = maxval(abs(oro(1:3))-abs(ot%rodrigues(1:3)))
  else
    if (oro(4).eq.0.D0) then
      diff = abs(oro(4)-ot%rodrigues(4))
    else
      diff = maxval(abs(oro-ot%rodrigues))
    end if 
  end if 
  if (verbose)  write (*,*) 'cu2ro-st2cu-ro2st max ro difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ro-st2cu-ro2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple qu test'
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(eu2om(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-eu2om-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-eu2om-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(eu2ax(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-eu2ax-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-eu2ax-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(eu2ro(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-eu2ro-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-eu2ro-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(eu2ho(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-eu2ho-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-eu2ho-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(eu2cu(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-eu2cu-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-eu2cu-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(eu2st(qu2eu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-eu2st-qu2eu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-eu2st-qu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(om2eu(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-om2eu-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-om2eu-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(om2ax(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-om2ax-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-om2ax-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(om2ro(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-om2ro-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-om2ro-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(om2ho(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-om2ho-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-om2ho-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(om2cu(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-om2cu-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-om2cu-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(om2st(qu2om(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-om2st-qu2om max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-om2st-qu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(ax2eu(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-ax2eu-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-ax2eu-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(ax2om(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-ax2om-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-ax2om-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(ax2ro(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-ax2ro-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-ax2ro-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(ax2ho(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-ax2ho-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-ax2ho-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(ax2cu(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-ax2cu-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-ax2cu-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(ax2st(qu2ax(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-ax2st-qu2ax max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-ax2st-qu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(ro2eu(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-ro2eu-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-ro2eu-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(ro2om(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-ro2om-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-ro2om-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(ro2ax(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-ro2ax-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-ro2ax-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(ro2ho(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-ro2ho-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-ro2ho-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(ro2cu(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-ro2cu-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-ro2cu-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(ro2st(qu2ro(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-ro2st-qu2ro max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-ro2st-qu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(ho2eu(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-ho2eu-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-ho2eu-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(ho2om(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-ho2om-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-ho2om-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(ho2ax(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-ho2ax-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-ho2ax-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(ho2ro(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-ho2ro-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-ho2ro-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(ho2cu(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-ho2cu-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-ho2cu-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(ho2st(qu2ho(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-ho2st-qu2ho max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-ho2st-qu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(cu2eu(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-cu2eu-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-cu2eu-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(cu2om(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-cu2om-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-cu2om-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(cu2ax(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-cu2ax-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-cu2ax-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(cu2ro(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-cu2ro-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-cu2ro-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(cu2ho(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-cu2ho-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-cu2ho-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = st2qu(cu2st(qu2cu(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'st2qu-cu2st-qu2cu max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2qu-cu2st-qu2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = eu2qu(st2eu(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'eu2qu-st2eu-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2qu-st2eu-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = om2qu(st2om(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'om2qu-st2om-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2qu-st2om-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ax2qu(st2ax(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ax2qu-st2ax-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2qu-st2ax-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ro2qu(st2ro(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ro2qu-st2ro-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2qu-st2ro-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = ho2qu(st2ho(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'ho2qu-st2ho-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2qu-st2ho-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iqu = ot%quat
  oqu = cu2qu(st2cu(qu2st(iqu)))
  if (abs(oqu(1)).lt.1.D-08) then
    diff = maxval(abs(oqu(2:4))-abs(ot%quat(2:4)))
  else
    diff = maxval(abs(oqu-ot%quat))
  end if 
  if (verbose)  write (*,*) 'cu2qu-st2cu-qu2st max qu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2qu-st2cu-qu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple ho test'
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(eu2om(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-eu2om-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-eu2om-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(eu2ax(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-eu2ax-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-eu2ax-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(eu2ro(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-eu2ro-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-eu2ro-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(eu2qu(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-eu2qu-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-eu2qu-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(eu2cu(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-eu2cu-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-eu2cu-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(eu2st(ho2eu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-eu2st-ho2eu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-eu2st-ho2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(om2eu(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-om2eu-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-om2eu-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(om2ax(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-om2ax-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-om2ax-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(om2ro(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-om2ro-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-om2ro-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(om2qu(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-om2qu-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-om2qu-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(om2cu(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-om2cu-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-om2cu-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(om2st(ho2om(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-om2st-ho2om max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-om2st-ho2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(ax2eu(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-ax2eu-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-ax2eu-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(ax2om(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-ax2om-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-ax2om-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(ax2ro(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-ax2ro-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-ax2ro-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(ax2qu(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-ax2qu-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-ax2qu-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(ax2cu(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-ax2cu-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-ax2cu-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(ax2st(ho2ax(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-ax2st-ho2ax max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-ax2st-ho2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(ro2eu(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-ro2eu-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-ro2eu-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(ro2om(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-ro2om-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-ro2om-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(ro2ax(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-ro2ax-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-ro2ax-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(ro2qu(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-ro2qu-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-ro2qu-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(ro2cu(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-ro2cu-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-ro2cu-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(ro2st(ho2ro(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-ro2st-ho2ro max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-ro2st-ho2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(qu2eu(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-qu2eu-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-qu2eu-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(qu2om(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-qu2om-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-qu2om-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(qu2ax(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-qu2ax-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-qu2ax-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(qu2ro(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-qu2ro-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-qu2ro-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(qu2cu(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-qu2cu-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-qu2cu-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(qu2st(ho2qu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-qu2st-ho2qu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-qu2st-ho2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(cu2eu(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-cu2eu-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-cu2eu-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(cu2om(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-cu2om-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-cu2om-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(cu2ax(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-cu2ax-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-cu2ax-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(cu2ro(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-cu2ro-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-cu2ro-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(cu2qu(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-cu2qu-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-cu2qu-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = st2ho(cu2st(ho2cu(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'st2ho-cu2st-ho2cu max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ho-cu2st-ho2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = eu2ho(st2eu(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'eu2ho-st2eu-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ho-st2eu-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = om2ho(st2om(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'om2ho-st2om-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ho-st2om-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ax2ho(st2ax(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ax2ho-st2ax-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ho-st2ax-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = ro2ho(st2ro(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'ro2ho-st2ro-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ho-st2ro-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = qu2ho(st2qu(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'qu2ho-st2qu-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ho-st2qu-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  iho = ot%homochoric
  oho = cu2ho(st2cu(ho2st(iho)))
  aux = sqrt(sum(oho*oho))
  if (abs(aux-LPs%R1).lt.1.D-08) then
    diff = maxval(abs(oho)-abs(ot%homochoric))
  else
    diff = maxval(abs(oho-ot%homochoric))
  end if 
  if (verbose)  write (*,*) 'cu2ho-st2cu-ho2st max ho difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ho-st2cu-ho2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple cu test'
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(eu2om(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-eu2om-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-eu2om-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(eu2ax(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-eu2ax-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-eu2ax-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(eu2ro(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-eu2ro-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-eu2ro-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(eu2qu(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-eu2qu-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-eu2qu-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(eu2ho(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-eu2ho-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-eu2ho-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(eu2st(cu2eu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-eu2st-cu2eu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-eu2st-cu2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(om2eu(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-om2eu-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-om2eu-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(om2ax(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-om2ax-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-om2ax-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(om2ro(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-om2ro-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-om2ro-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(om2qu(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-om2qu-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-om2qu-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(om2ho(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-om2ho-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-om2ho-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(om2st(cu2om(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-om2st-cu2om max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-om2st-cu2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(ax2eu(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-ax2eu-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-ax2eu-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(ax2om(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-ax2om-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-ax2om-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(ax2ro(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-ax2ro-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-ax2ro-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(ax2qu(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-ax2qu-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-ax2qu-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(ax2ho(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-ax2ho-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-ax2ho-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(ax2st(cu2ax(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-ax2st-cu2ax max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-ax2st-cu2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(ro2eu(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-ro2eu-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-ro2eu-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(ro2om(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-ro2om-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-ro2om-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(ro2ax(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-ro2ax-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-ro2ax-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(ro2qu(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-ro2qu-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-ro2qu-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(ro2ho(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-ro2ho-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-ro2ho-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(ro2st(cu2ro(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-ro2st-cu2ro max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-ro2st-cu2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(qu2eu(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-qu2eu-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-qu2eu-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(qu2om(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-qu2om-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-qu2om-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(qu2ax(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-qu2ax-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-qu2ax-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(qu2ro(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-qu2ro-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-qu2ro-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(qu2ho(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-qu2ho-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-qu2ho-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(qu2st(cu2qu(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-qu2st-cu2qu max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-qu2st-cu2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(ho2eu(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-ho2eu-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-ho2eu-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(ho2om(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-ho2om-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-ho2om-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(ho2ax(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-ho2ax-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-ho2ax-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(ho2ro(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-ho2ro-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-ho2ro-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(ho2qu(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-ho2qu-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-ho2qu-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = st2cu(ho2st(cu2ho(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'st2cu-ho2st-cu2ho max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2cu-ho2st-cu2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = eu2cu(st2eu(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'eu2cu-st2eu-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2cu-st2eu-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = om2cu(st2om(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'om2cu-st2om-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2cu-st2om-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ax2cu(st2ax(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ax2cu-st2ax-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2cu-st2ax-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ro2cu(st2ro(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ro2cu-st2ro-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2cu-st2ro-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = qu2cu(st2qu(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'qu2cu-st2qu-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2cu-st2qu-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  icu = ot%cubochoric
  ocu = ho2cu(st2ho(cu2st(icu)))
  aux = maxval(abs(ocu))
  if (abs(aux-LPs%ap*0.5).lt.1.D-08) then
    diff = maxval(abs(ocu)-abs(ot%cubochoric))
  else
    diff = maxval(abs(ocu-ot%cubochoric))
  end if 
  if (verbose)  write (*,*) 'ho2cu-st2ho-cu2st max cu difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2cu-st2ho-cu2st ',rots(1:3,i)
     res = testcounter
     return
  end if
 
 
if (verbose) write (*,*) 'triple st test'
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(eu2om(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-eu2om-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-eu2om-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(eu2ax(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-eu2ax-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-eu2ax-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(eu2ro(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-eu2ro-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-eu2ro-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(eu2qu(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-eu2qu-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-eu2qu-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(eu2ho(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-eu2ho-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-eu2ho-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(eu2cu(st2eu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-eu2cu-st2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-eu2cu-st2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(om2eu(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-om2eu-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-om2eu-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(om2ax(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-om2ax-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-om2ax-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(om2ro(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-om2ro-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-om2ro-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(om2qu(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-om2qu-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-om2qu-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(om2ho(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-om2ho-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-om2ho-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(om2cu(st2om(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-om2cu-st2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-om2cu-st2om ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(ax2eu(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-ax2eu-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-ax2eu-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(ax2om(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-ax2om-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-ax2om-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(ax2ro(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-ax2ro-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-ax2ro-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(ax2qu(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-ax2qu-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-ax2qu-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(ax2ho(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-ax2ho-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-ax2ho-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(ax2cu(st2ax(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-ax2cu-st2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-ax2cu-st2ax ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(ro2eu(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-ro2eu-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-ro2eu-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(ro2om(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-ro2om-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-ro2om-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(ro2ax(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-ro2ax-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-ro2ax-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(ro2qu(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-ro2qu-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-ro2qu-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(ro2ho(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-ro2ho-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-ro2ho-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(ro2cu(st2ro(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-ro2cu-st2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-ro2cu-st2ro ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(qu2eu(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-qu2eu-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-qu2eu-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(qu2om(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-qu2om-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-qu2om-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(qu2ax(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-qu2ax-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-qu2ax-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(qu2ro(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-qu2ro-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-qu2ro-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(qu2ho(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-qu2ho-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-qu2ho-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(qu2cu(st2qu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-qu2cu-st2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-qu2cu-st2qu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(ho2eu(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-ho2eu-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-ho2eu-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(ho2om(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-ho2om-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-ho2om-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(ho2ax(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-ho2ax-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-ho2ax-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(ho2ro(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-ho2ro-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-ho2ro-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(ho2qu(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-ho2qu-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-ho2qu-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = cu2st(ho2cu(st2ho(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'cu2st-ho2cu-st2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2st-ho2cu-st2ho ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = eu2st(cu2eu(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'eu2st-cu2eu-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2st-cu2eu-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = om2st(cu2om(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'om2st-cu2om-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2st-cu2om-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ax2st(cu2ax(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ax2st-cu2ax-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2st-cu2ax-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ro2st(cu2ro(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ro2st-cu2ro-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2st-cu2ro-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = qu2st(cu2qu(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'qu2st-cu2qu-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2st-cu2qu-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%stereographic
  ost = ho2st(cu2ho(st2cu(ist)))
  aux = sqrt(sum(ost*ost))
  if (abs(aux-1.D0).lt.1.D-08) then
    diff = maxval(abs(ost)-abs(ot%stereographic))
  else
    diff = maxval(abs(ost-ot%stereographic))
  end if 
  if (verbose)  write (*,*) 'ho2st-cu2ho-st2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2st-cu2ho-st2cu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
! adding all triple tests for exponential map
! [added 10/29/19 by SS]

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(eu2om(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-eu2om-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-eu2om-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(eu2ro(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-eu2ro-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-eu2ro-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if
 
testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(eu2qu(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-eu2qu-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-eu2qu-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(eu2ax(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-eu2ax-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-eu2ax-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(eu2ho(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-eu2ho-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-eu2ho-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(eu2st(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-eu2st-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-eu2st-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(eu2cu(ex2eu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-eu2cu-ex2eu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-eu2cu-ex2eu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(om2ro(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-om2ro-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-om2ro-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(om2qu(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-om2qu-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-om2qu-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(om2ax(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-om2ax-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     print*,'iex = ',ist
     print*,'oex = ',oex
     print*,'om = ',iom
     print*,'om2 = ',ot%om
     print*,'diff = ',diff
     print*,'diffmax = ',diffmax
     write (*,*) 'test # ',testcounter,' failed : ax2ex-om2ax-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(om2ho(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-om2ho-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-om2ho-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(om2st(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-om2st-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-om2st-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(om2cu(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-om2cu-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-om2cu-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(ro2qu(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-ro2qu-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-ro2qu-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(ro2ax(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-ro2ax-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-ro2ax-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(ro2ho(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-ro2ho-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-ro2ho-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(ro2st(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-ro2st-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-ro2st-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(ro2cu(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-ro2cu-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-ro2cu-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(qu2ax(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-qu2ax-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-qu2ax-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(qu2ho(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-qu2ho-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-qu2ho-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(qu2st(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-qu2st-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-qu2st-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(qu2cu(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-qu2cu-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-qu2cu-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(ax2ho(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-ax2ho-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-ax2ho-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(ax2st(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-ax2st-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-ax2st-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(ax2cu(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-ax2cu-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-ax2cu-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(ho2st(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-ho2st-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-ho2st-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(ho2cu(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-ho2cu-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-ho2cu-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = cu2ex(st2cu(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'cu2ex-st2cu-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : cu2ex-st2cu-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(om2eu(ex2om(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-om2eu-ex2om max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-om2eu-ex2om ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(ro2eu(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-ro2eu-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-ro2eu-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(ro2om(ex2ro(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-ro2om-ex2ro max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-ro2om-ex2ro ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(qu2eu(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-qu2eu-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-qu2eu-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(qu2om(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-qu2om-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-qu2om-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(qu2ro(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-qu2ro-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-qu2ro-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(qu2ro(ex2qu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-qu2ro-ex2qu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-qu2ro-ex2qu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(ax2eu(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-ax2eu-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-ax2eu-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(ax2om(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-ax2om-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-ax2om-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(ax2ro(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-ax2ro-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-ax2ro-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(ax2qu(ex2ax(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-ax2qu-ex2ax max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-ax2qu-ex2ax ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(ho2eu(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-ho2eu-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-ho2eu-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(ho2om(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-ho2om-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-ho2om-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(ho2ro(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-ho2ro-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-ho2ro-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(ho2qu(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-ho2qu-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-ho2qu-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(ho2ax(ex2ho(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-ho2ax-ex2ho max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-ho2ax-ex2ho ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(st2eu(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-st2eu-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-st2eu-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(st2om(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-st2om-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-st2om-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(st2ro(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-st2ro-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-st2ro-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(st2qu(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-st2qu-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-st2qu-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(st2ax(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-st2ax-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-st2ax-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(st2ho(ex2st(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-st2ho-ex2st max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-st2ho-ex2st ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = eu2ex(cu2eu(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'eu2ex-cu2eu-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : eu2ex-cu2eu-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = om2ex(cu2om(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'om2ex-cu2om-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : om2ex-cu2om-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ro2ex(cu2ro(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ro2ex-cu2ro-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ro2ex-cu2ro-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = qu2ex(cu2qu(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'qu2ex-cu2qu-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : qu2ex-cu2qu-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ax2ex(cu2ax(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ax2ex-cu2ax-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ax2ex-cu2ax-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = ho2ex(cu2ho(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'ho2ex-cu2ho-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : ho2ex-cu2ho-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

testcounter = testcounter + 1
  ist = ot%expomap
  ost = st2ex(cu2st(ex2cu(iex)))
  iom = ex2om(ost)
  diff = maxval(abs(iom-ot%om))
  if (verbose)  write (*,*) 'st2ex-cu2st-ex2cu max st difference = ', diff
  diffmax = maxval( (/ diffmax,diff /) )
 
  if (diffmax.gt.maxerr) then 
     testsfailed = testsfailed+1
     write (*,*) 'test # ',testcounter,' failed : st2ex-cu2st-ex2cu ',rots(1:3,i)
     res = testcounter
     return
  end if

 if (verbose) write (*,*) ' Maximum difference in triplet tests  : ', diffmax
end do
write (*,*) ' Total number of rotations tests executed = ',testcounter
write (*,*) ' Total number of rotations tests failed = ',testsfailed

end subroutine MODRotationsExecuteTest

end module MODRotationsTest
